import{c as q,j as e,g as K,a as Q,s as L,aM as ie,aA as A,m as V,aB as Z,r as x,b as D,e as T,f as ee,bW as le,n as w,l as ce,G as h,H as S,D as I,aU as U,B as re,aR as de,aV as pe,au as ue,N as te,W as me,X as fe,_ as he,Y as xe,Z as ge}from"./index-f0602fa3.js";import{d as ve}from"./Memory-0caa84b3.js";import{S as be,d as Ce,a as je}from"./SensorsOffRounded-fdc456ba.js";import{D as W}from"./Divider-84c6206e.js";import{C as we}from"./CameraIcon2-d8c82132.js";import{C as Me}from"./CardHeader-777faafc.js";import{d as X}from"./CloseRounded-245fc785.js";import{B as N}from"./Button-3abb1eb0.js";import{u as Se,f as ke,P as ye}from"./Popover-35ca4dea.js";import{S as _e}from"./SwitchBase-fb99b934.js";import{C as Re}from"./Chip-5ed62098.js";const Ae=q(e.jsx("path",{d:"M19 5v14H5V5h14m0-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z"}),"CheckBoxOutlineBlank"),Ie=q(e.jsx("path",{d:"M19 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.11 0 2-.9 2-2V5c0-1.1-.89-2-2-2zm-9 14l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"}),"CheckBox"),Pe=q(e.jsx("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-2 10H7v-2h10v2z"}),"IndeterminateCheckBox");function ze(r){return Q("MuiCheckbox",r)}const $e=K("MuiCheckbox",["root","checked","disabled","indeterminate","colorPrimary","colorSecondary","sizeSmall","sizeMedium"]),O=$e,Fe=r=>{const{classes:a,indeterminate:c,color:u,size:f}=r,v={root:["root",c&&"indeterminate",`color${A(u)}`,`size${A(f)}`]},C=ee(v,ze,a);return{...a,...C}},Le=L(_e,{shouldForwardProp:r=>ie(r)||r==="classes",name:"MuiCheckbox",slot:"Root",overridesResolver:(r,a)=>{const{ownerState:c}=r;return[a.root,c.indeterminate&&a.indeterminate,a[`size${A(c.size)}`],c.color!=="default"&&a[`color${A(c.color)}`]]}})(V(({theme:r})=>({color:(r.vars||r).palette.text.secondary,variants:[{props:{color:"default",disableRipple:!1},style:{"&:hover":{backgroundColor:r.vars?`rgba(${r.vars.palette.action.activeChannel} / ${r.vars.palette.action.hoverOpacity})`:Z(r.palette.action.active,r.palette.action.hoverOpacity)}}},...Object.entries(r.palette).filter(([,a])=>a&&a.main).map(([a])=>({props:{color:a,disableRipple:!1},style:{"&:hover":{backgroundColor:r.vars?`rgba(${r.vars.palette[a].mainChannel} / ${r.vars.palette.action.hoverOpacity})`:Z(r.palette[a].main,r.palette.action.hoverOpacity)}}})),...Object.entries(r.palette).filter(([,a])=>a&&a.main).map(([a])=>({props:{color:a},style:{[`&.${O.checked}, &.${O.indeterminate}`]:{color:(r.vars||r).palette[a].main},[`&.${O.disabled}`]:{color:(r.vars||r).palette.action.disabled}}})),{props:{disableRipple:!1},style:{"&:hover":{"@media (hover: none)":{backgroundColor:"transparent"}}}}]}))),Be=e.jsx(Ie,{}),He=e.jsx(Ae,{}),Ne=e.jsx(Pe,{}),Oe=x.forwardRef(function(a,c){const u=D({props:a,name:"MuiCheckbox"}),{checkedIcon:f=Be,color:v="primary",icon:C=He,indeterminate:g=!1,indeterminateIcon:b=Ne,inputProps:j,size:i="medium",disableRipple:o=!1,className:d,...p}=u,t=g?b:C,s=g?b:f,n={...u,disableRipple:o,color:v,indeterminate:g,size:i},l=Fe(n);return e.jsx(Le,{type:"checkbox",inputProps:{"data-indeterminate":g,...j},icon:x.cloneElement(t,{fontSize:t.props.fontSize??i}),checkedIcon:x.cloneElement(s,{fontSize:s.props.fontSize??i}),ownerState:n,ref:c,className:T(l.root,d),...p,classes:l})}),Y=Oe;function Te(r){return Q("MuiFormControlLabel",r)}const Ue=K("MuiFormControlLabel",["root","labelPlacementStart","labelPlacementTop","labelPlacementBottom","disabled","label","error","required","asterisk"]),P=Ue,qe=r=>{const{classes:a,disabled:c,labelPlacement:u,error:f,required:v}=r,C={root:["root",c&&"disabled",`labelPlacement${A(u)}`,f&&"error",v&&"required"],label:["label",c&&"disabled"],asterisk:["asterisk",f&&"error"]};return ee(C,Te,a)},Ve=L("label",{name:"MuiFormControlLabel",slot:"Root",overridesResolver:(r,a)=>{const{ownerState:c}=r;return[{[`& .${P.label}`]:a.label},a.root,a[`labelPlacement${A(c.labelPlacement)}`]]}})(V(({theme:r})=>({display:"inline-flex",alignItems:"center",cursor:"pointer",verticalAlign:"middle",WebkitTapHighlightColor:"transparent",marginLeft:-11,marginRight:16,[`&.${P.disabled}`]:{cursor:"default"},[`& .${P.label}`]:{[`&.${P.disabled}`]:{color:(r.vars||r).palette.text.disabled}},variants:[{props:{labelPlacement:"start"},style:{flexDirection:"row-reverse",marginRight:-11}},{props:{labelPlacement:"top"},style:{flexDirection:"column-reverse"}},{props:{labelPlacement:"bottom"},style:{flexDirection:"column"}},{props:({labelPlacement:a})=>a==="start"||a==="top"||a==="bottom",style:{marginLeft:16}}]}))),We=L("span",{name:"MuiFormControlLabel",slot:"Asterisk",overridesResolver:(r,a)=>a.asterisk})(V(({theme:r})=>({[`&.${P.error}`]:{color:(r.vars||r).palette.error.main}}))),Ee=x.forwardRef(function(a,c){const u=D({props:a,name:"MuiFormControlLabel"}),{checked:f,className:v,componentsProps:C={},control:g,disabled:b,disableTypography:j,inputRef:i,label:o,labelPlacement:d="end",name:p,onChange:t,required:s,slots:n={},slotProps:l={},value:m,...k}=u,y=Se(),M=b??g.props.disabled??(y==null?void 0:y.disabled),B=s??g.props.required,G={disabled:M,required:B};["checked","name","onChange","value","inputRef"].forEach(F=>{typeof g.props[F]>"u"&&typeof u[F]<"u"&&(G[F]=u[F])});const ae=ke({props:u,muiFormControl:y,states:["error"]}),z={...u,disabled:M,labelPlacement:d,required:B,error:ae.error},H=qe(z),oe={slots:n,slotProps:{...C,...l}},[se,$]=le("typography",{elementType:w,externalForwardedProps:oe,ownerState:z});let R=o;return R!=null&&R.type!==w&&!j&&(R=e.jsx(se,{component:"span",...$,className:T(H.label,$==null?void 0:$.className),children:R})),e.jsxs(Ve,{className:T(H.root,v),ownerState:z,ref:c,...k,children:[x.cloneElement(g,G),B?e.jsxs("div",{children:[R,e.jsxs(We,{ownerState:z,"aria-hidden":!0,className:H.asterisk,children:["â€‰","*"]})]}):R]})}),J=Ee,Ge=()=>{const r=ce();return e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M24 14.2502H18.9459L14.7299 9.74974H8.96587C8.32766 7.95996 6.63191 6.66656 4.62476 6.66656C2.07498 6.66656 0 8.74154 0 11.2913C0 13.8411 2.07498 15.9161 4.62476 15.9161C6.63191 15.9161 8.32766 14.6227 8.96587 12.8329H13.0203L17.2363 17.3334H24V14.2502ZM4.62477 9.74978C3.77382 9.74978 3.08319 10.4404 3.08319 11.2914C3.08319 12.1423 3.77382 12.833 4.62477 12.833C5.47573 12.833 6.16636 12.1423 6.16636 11.2914C6.16636 10.4404 5.47573 9.74978 4.62477 9.74978Z",fill:r.palette.text.primary})})},Ze=({modo:r,pines:a})=>e.jsxs(h,{container:!0,rowSpacing:1,columnSpacing:2,width:"100%",children:[e.jsxs(h,{size:{xs:12},children:[e.jsx(w,{variant:"subtitle1",component:"h4",children:"Pin Entrada"}),e.jsx(W,{})]}),Array.from(a).map(([c,u])=>e.jsx(h,{size:{xs:12,lg:6},children:e.jsxs(S,{direction:"row",spacing:1,alignItems:"center",justifyContent:"space-between",children:[e.jsxs(S,{direction:"row",spacing:2,alignItems:"center",children:[e.jsx(Ge,{}),e.jsxs(S,{children:[e.jsx(w,{variant:"h6",children:I(u.descripcion,15,!0)}),e.jsx(w,{variant:"caption",children:I(`Pin: ${u.pin}`,15,!0)})]})]}),e.jsx(be,{state:r===U.Seguridad?u.estado===1?"warning":"active":u.estado===1?"active":"disable"})]})},c))]}),Xe=({camaras:r})=>e.jsxs(h,{container:!0,rowSpacing:1,columnSpacing:2,width:"100%",marginTop:1,children:[e.jsxs(h,{size:{xs:12},children:[e.jsx(w,{variant:"subtitle1",component:"h4",children:"Camaras"}),e.jsx(W,{})]}),Array.from(r).map(([a,c])=>e.jsx(h,{size:{xs:12,lg:6},children:e.jsxs(S,{direction:"row",alignItems:"center",justifyContent:"space-between",children:[e.jsxs(S,{direction:"row",spacing:2,alignItems:"center",children:[e.jsx(we,{isSelected:!1}),e.jsxs(S,{children:[e.jsx(w,{variant:"h6",children:I(c.descripcion,15,!0)}),e.jsx(w,{variant:"caption",children:I(c.ip,15,!0)})]})]}),e.jsx(Ye,{conectado:c.conectado})]})},a))]}),Ye=({conectado:r})=>e.jsx(re,{sx:{width:25,height:25,backgroundColor:r===0?"#f74c48":r===1?"#04c584":"#bfbfbf",borderRadius:"50%"}}),Je=L(de)(({theme:r,modo:a,seguridad:c})=>({display:"flex",flexDirection:"column",height:"100%",width:"100%",borderStyle:"solid",borderWidth:a===U.Seguridad?2:1,borderRadius:8,backgroundImage:"inherit",borderColor:a===U.Seguridad?c===pe.Armado?"green":"darkgray":r.palette.mode==="dark"?r.palette.divider:r.palette.grey.A800,boxShadow:"inherit",":hover":{boxShadow:"inherit"},"& pre":{m:0,p:"16px !important",fontFamily:r.typography.fontFamily,fontSize:"0.75rem"}})),Ke=({data:{camara:r,controlador:a,pin_entrada:c}})=>e.jsx(e.Fragment,{children:e.jsxs(Je,{modo:a.modo,seguridad:a.seguridad,children:[e.jsx(Me,{title:e.jsx(Qe,{controller:a}),sx:{p:.5,"& .MuiCardHeader-action":{m:"auto auto",display:"flex"},margin:0},action:e.jsx(De,{conectado:a.conectado})}),e.jsx(W,{}),e.jsx(ue,{sx:{flex:1,padding:.5,"&:last-child":{paddingBottom:.5},overflow:"hidden"},children:e.jsxs(te,{sx:{width:"100%",height:"100%"},children:[e.jsx(Ze,{modo:a.modo,pines:c}),e.jsx(Xe,{camaras:r})]})})]})}),Qe=({controller:r})=>e.jsxs(S,{direction:"row",spacing:2,alignItems:"center",children:[e.jsx(ve,{fontSize:"large"}),e.jsxs(S,{children:[e.jsx(w,{variant:"h6",children:I(r.nodo,20,!0)}),e.jsx(w,{variant:"caption",children:I(r.descripcion,25,!0)})]})]}),De=({conectado:r})=>e.jsx(e.Fragment,{children:r===1?e.jsx(Ce,{color:"success",fontSize:"large"}):e.jsx(je,{color:"error",fontSize:"large"})});var _=(r=>(r[r.Activo=1]="Activo",r[r.Desactivado=0]="Desactivado",r))(_||{}),E={},er=fe;Object.defineProperty(E,"__esModule",{value:!0});var ne=E.default=void 0,rr=er(me()),tr=e;ne=E.default=(0,rr.default)((0,tr.jsx)("path",{d:"M11 18h2c.55 0 1-.45 1-1s-.45-1-1-1h-2c-.55 0-1 .45-1 1s.45 1 1 1M3 7c0 .55.45 1 1 1h16c.55 0 1-.45 1-1s-.45-1-1-1H4c-.55 0-1 .45-1 1m4 6h10c.55 0 1-.45 1-1s-.45-1-1-1H7c-.55 0-1 .45-1 1s.45 1 1 1"}),"FilterListRounded");const nr=({regiones:r,handleChangeFilter:a})=>{const[c,u]=x.useState(null),f=t=>{u(t.currentTarget)},v=()=>{u(null)},C=!!c,g=C?"filter-region-alarm-popover":void 0,[b,j]=x.useState(new Map([["all",!0]])),i=x.useMemo(()=>Array.from(b).filter(([n,l])=>l&&n!=="all").reduce((n,l)=>{const m=n,[k]=l,y=r.find(M=>String(M.rgn_id)===k);return y!==void 0&&m.push([k,y]),m},[]),[b]),o=t=>{t.target.name==="all"&&t.target.checked&&j(s=>{const n=new Map(s);n.set(t.target.name,t.target.checked);for(const l of n.keys())l!=="all"&&n.set(l,!1);return n}),t.target.name!=="all"&&t.target.checked&&j(s=>{const n=new Map(s);return n.set(t.target.name,t.target.checked),n.set("all",!1),n}),t.target.name!=="all"&&!t.target.checked&&j(s=>{const n=new Map(s);n.set(t.target.name,t.target.checked);let l=!0;for(const m of n.values())l=l&&!m;return l&&n.set("all",!0),n})},d=()=>{j(t=>{const s=new Map(t);for(const n of s.keys())n!=="all"&&s.set(n,!1);return s.set("all",!0),s})},p=t=>{j(s=>{const n=new Map(s);n.set(t,!1);let l=!0;for(const m of n.values())l=l&&!m;return l&&n.set("all",!0),n})};return x.useEffect(()=>{j(t=>{const s=new Map(t);return r.forEach(n=>{s.has(String(n.rgn_id))||s.set(String(n.rgn_id),!1)}),s})},[r]),x.useEffect(()=>{a(i)},[i]),e.jsxs(h,{container:!0,px:2,pt:2,rowSpacing:1,children:[e.jsx(h,{size:{xs:12},children:e.jsxs(S,{direction:"row",justifyContent:"space-between",alignItems:"center",spacing:1,children:[e.jsx(w,{variant:"h5",children:"Alarmas"}),e.jsxs("div",{children:[e.jsx(N,{"aria-describedby":g,variant:"contained",onClick:f,startIcon:e.jsx(ne,{}),children:"Filtro"}),e.jsx(ye,{id:g,open:C,anchorEl:c,onClose:v,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},children:e.jsxs(h,{container:!0,rowSpacing:.5,columnSpacing:1,p:1,children:[e.jsx(h,{size:{xs:6},children:e.jsx(J,{control:e.jsx(Y,{checked:b.get("all"),onChange:o,disabled:b.get("all")===void 0,name:"all"}),label:"Todos"})}),e.jsx(h,{size:{xs:6},display:"flex",justifyContent:"end",children:e.jsx(N,{variant:"outlined",onClick:d,startIcon:e.jsx(X,{}),color:"error",size:"small",children:"Reset"})}),r.map(t=>e.jsx(h,{size:{xs:12,md:6,xl:4},children:e.jsx(J,{control:e.jsx(Y,{checked:b.get(String(t.rgn_id)),onChange:o,name:String(t.rgn_id),disabled:b.get(String(t.rgn_id))===void 0}),label:t.region})},t.rgn_id))]})})]})]})}),i.length>0&&e.jsx(h,{container:!0,children:e.jsxs(S,{direction:"row",alignItems:"center",flexWrap:"wrap",rowGap:1,spacing:1,children:[e.jsx(he,{variant:"outlined",sx:{p:1},children:e.jsxs(h,{container:!0,wrap:"wrap",columnSpacing:1,rowSpacing:1,alignItems:"center",children:[e.jsx(h,{children:e.jsx(w,{component:"span",variant:"subtitle1",children:"Regiones"})}),i.map(([t,s])=>e.jsx(h,{children:e.jsx(Re,{label:s.region,onDelete:()=>{p(t)}})},t))]})}),e.jsx(N,{variant:"outlined",onClick:d,startIcon:e.jsx(X,{}),color:"error",sx:{alignSelf:"center"},children:"Reset"})]})})]})},hr=()=>{const[r,a]=x.useState(new Map),[c,u]=x.useState(new Map),f=x.useRef(null),[v,C]=x.useState([]),g=x.useMemo(()=>v.length===0?Array.from(r.values()):Array.from(r.values()).reduce((o,d)=>{const p=o,t=d;return v.find(([,n])=>n.rgn_id===t.controlador.rgn_id)!==void 0&&p.push(t),p},[]),[r,v]),b=x.useMemo(()=>Array.from(r).reduce((o,d)=>{const p=o,[,t]=d,s=c.get(t.controlador.rgn_id);return s!==void 0&&p.find(l=>l.rgn_id===t.controlador.rgn_id)===void 0&&p.push(s),p},[]),[c,r]),j=i=>{C(i)};return x.useEffect(()=>(f.current||(f.current=xe(`${ge}/alarm_notification`)),f.current.on("initial_data",(i,o)=>{const d=new Map;o.forEach(t=>{d.set(t.rgn_id,t)}),u(d);const p=new Map;Object.values(i).forEach(t=>{const{camara:s,controlador:n,pin_entrada:l}=t,m=s.map(M=>[M.cmr_id,M]),k=l.map(M=>[M.pe_id,M]),y={controlador:n,camara:new Map(m),pin_entrada:new Map(k)};p.set(n.ctrl_id,y)}),a(p)}),f.current.on("region",(i,o)=>{u(d=>{const p=new Map(d);return p.set(i,o),p})}),f.current.on("camera",(i,o,d)=>{a(p=>{const t=new Map(p),s=t.get(i);if(s!==void 0){const n={controlador:s.controlador,camara:new Map(s.camara),pin_entrada:new Map(s.pin_entrada)},l=n.camara.get(o.cmr_id);let m=!1;return d==="update"?l!==void 0&&(o.activo===_.Desactivado?n.camara.delete(o.cmr_id):o.activo===_.Activo&&(m=l.conectado!==o.conectado,n.camara.set(o.cmr_id,o))):d==="add"?l===void 0&&o.activo===_.Activo&&(m=o.conectado===1,n.camara.set(o.cmr_id,o)):d==="delete"&&n.camara.delete(o.cmr_id),m?(t.delete(i),new Map([[i,n],...t])):(t.set(i,n),t)}return p})}),f.current.on("controller",(i,o,d)=>{console.log("Data recevido"),console.log(i,o,d),a(p=>{const t=new Map([...p]),s=t.get(i);if(s!==void 0){const n=s.controlador;let l=!1;if(d==="update"){l=n.conectado!==o.conectado;const m={controlador:o,camara:new Map(s.camara),pin_entrada:new Map(s.pin_entrada)};t.set(i,m)}else d==="delete"&&t.delete(i);if(l){t.delete(i);const m={controlador:o,camara:new Map(s.camara),pin_entrada:new Map(s.pin_entrada)};return new Map([[i,m],...t])}return t}else if(d==="add"&&o.activo===1){const n={camara:new Map,controlador:o,pin_entrada:new Map};return new Map([[i,n],...t])}return p})}),f.current.on("pin_entrada",(i,o,d)=>{a(p=>{const t=new Map(p),s=t.get(i);if(s!==void 0){const n={controlador:s.controlador,camara:new Map(s.camara),pin_entrada:new Map(s.pin_entrada)},l=n.pin_entrada.get(o.pe_id);let m=!1;return d==="update"?l!==void 0&&(o.activo===_.Desactivado?n.pin_entrada.delete(o.pe_id):o.activo===_.Activo&&(m=l.estado!==o.estado,n.pin_entrada.set(o.pe_id,o))):d==="add"?l===void 0&&o.activo===_.Activo&&(m=o.estado===1,n.pin_entrada.set(o.pe_id,o)):d==="delete"&&n.pin_entrada.delete(o.pe_id),m?(t.delete(i),new Map([[i,n],...t])):(t.set(i,n),t)}return p})}),()=>{f.current&&(f.current.disconnect(),f.current=null)}),[]),e.jsx(e.Fragment,{children:e.jsxs(re,{sx:{width:"100%",height:"100%",display:"flex",flexDirection:"column",gap:2},children:[e.jsx(nr,{regiones:b,handleChangeFilter:j}),e.jsx(te,{sx:{width:"100%",height:"100%",flex:1,"& .simplebar-content":{width:"100%",height:"100%",display:"grid",placeItems:"center"}},children:e.jsx(h,{container:!0,rowSpacing:2,columnSpacing:2,padding:2,justifyContent:"center",sx:{width:"100%"},children:g.map(i=>e.jsx(h,{component:"div",height:250,size:{xs:12,sm:6,md:4},children:e.jsx(Ke,{data:i})},i.controlador.ctrl_id))})})]})})};export{hr as default};
