import{K as te,L as oe,j as e,u as ge,r as y,bX as be,bY as fe,aj as w,B as R,m as r,ak as T,I as S,aI as ee,al as ye,G as t,S as E,as as A,E as a,W as I,bZ as ie,Y as U,Z as z,a3 as G}from"./index-ada4c4db.js";import{a as ke,P as Ce,b as Se,c as De,d as re,T as h,e as _e}from"./PaperTable-544c5933.js";import{g as B}from"./getFormattedDateTime-de75869e.js";import{d as we}from"./SaveAltRounded-36381fdb.js";import{d as N}from"./DownloadRounded-87fe9040.js";import{d as Re}from"./Close-179c157b.js";import{C as Te,d as Ee}from"./ChooseFiles-821c9671.js";import{D as Ae,a as Be,b as Fe}from"./DialogContent-61d6a3e8.js";import{D as Ie}from"./DialogTitle-bb2f3127.js";import{C as F}from"./CardHeader-746a63d2.js";import{D as u}from"./Divider-0676013f.js";import{B as H}from"./Button-dd480b88.js";import{P as Le}from"./Select-8cf8581e.js";import"./InputLabel-40350896.js";import"./MenuItem-012e34cd.js";var V={},Oe=oe;Object.defineProperty(V,"__esModule",{value:!0});var ne=V.default=void 0,Pe=Oe(te()),$e=e,Ue=(0,Pe.default)((0,$e.jsx)("path",{d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2zm4.3 14.3c-.39.39-1.02.39-1.41 0L12 13.41 9.11 16.3c-.39.39-1.02.39-1.41 0a.9959.9959 0 0 1 0-1.41L10.59 12 7.7 9.11a.9959.9959 0 0 1 0-1.41c.39-.39 1.02-.39 1.41 0L12 10.59l2.89-2.89c.39-.39 1.02-.39 1.41 0 .39.39.39 1.02 0 1.41L13.41 12l2.89 2.89c.38.38.38 1.02 0 1.41z"}),"CancelRounded");ne=V.default=Ue;var q={},ze=oe;Object.defineProperty(q,"__esModule",{value:!0});var se=q.default=void 0,Ge=ze(te()),Ne=e,We=(0,Ge.default)((0,Ne.jsx)("path",{d:"M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 14h-3v3h-2v-3H8v-2h3v-3h2v3h3v2zm-3-7V3.5L18.5 9H13z"}),"NoteAdd");se=q.default=We;const He=({foto:v})=>{const[g,b]=y.useState(null),j=k=>{b(k.currentTarget)},p=()=>{b(null)},i=!!g,o=i?"simple-popover":void 0;return e.jsxs("div",{children:[e.jsx(H,{"aria-describedby":o,variant:"contained",onClick:j,size:"small",children:"Ver Foto"}),e.jsx(Le,{id:o,open:i,anchorEl:g,onClose:p,anchorOrigin:{vertical:"top",horizontal:"right"},transformOrigin:{vertical:"bottom",horizontal:"right"},children:e.jsx("img",{src:`${I}/api/v1/ticket/fotoactividadpersonal?imgPath=${encodeURIComponent(v)}`,onError:k=>{k.currentTarget.src=ie},alt:"actividad_personal_foto_perfil",width:200,height:200,style:{objectFit:"cover",borderRadius:"50%"}})})]})};function W(v,g){return g=="docs"?v.reduce((j,p)=>{const i=j,{tipo:o}=p;return(o=="application/pdf"||o=="application/vnd.ms-powerpoint"||o=="application/vnd.openxmlformats-officedocument.presentationml.presentation"||o=="application/vnd.ms-excel"||o=="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"||o=="application/msword"||o=="application/vnd.openxmlformats-officedocument.wordprocessingml.document")&&i.push(p),i},[]):g=="imgs"?v.reduce((j,p)=>{const i=j,{tipo:o}=p;return(o=="image/jpeg"||o=="image/png"||o=="image/svg+xml"||o=="image/gif"||o=="image/avif"||o=="image/apng"||o=="image/webp")&&i.push(p),i},[]):g=="vids"?v.reduce((j,p)=>{const i=j,{tipo:o}=p;return(o=="video/x-msvideo"||o=="video/mp4"||o=="video/mpeg"||o=="video/ogg"||o=="video/webm"||o=="video/3gpp")&&i.push(p),i},[]):[]}const sr=({handleCloseDialog:v,isOpen:g,data:b})=>{const{ctrl_id:j,rt_id:p}=b,i=ge(),[o,k]=y.useState(null),[ae,{isError:M,isSuccess:J,data:D,error:Y,isLoading:ce}]=be(),{isSuccess:L,data:s,isLoading:de,isError:le}=fe({ctrl_id:j,rt_id:p}),O=async(n,c)=>{try{const x=JSON.stringify({path:n}),l=await fetch(`${I}/api/v1/ticket/download/archivo`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:x});if(!l.ok)throw new Error(`Error al descargar el archivo: ${l.statusText}`);const m=await l.blob(),$=window.URL.createObjectURL(m),f=document.createElement("a");f.href=$,f.setAttribute("download",c),document.body.appendChild(f),f.click(),document.body.removeChild(f)}catch(d){console.error("Error al descargar el archivo",d)}},pe=async()=>{try{const n=await fetch(`${I}/api/v1/ticket/download?rt_id=${p}&ctrl_id=${j}`,{method:"GET",credentials:"include"});if(!n.ok){w.error(()=>e.jsx(R,{children:e.jsx(r,{component:"p",variant:"body1",children:JSON.stringify(n)})}),{position:"bottom-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:i.palette.mode,transition:T,closeButton:!0,style:{backgroundColor:i.palette.background.paper,borderWidth:"1px",borderStyle:"solid",borderColor:i.palette.divider}});return}const c=`TicketDetalles_${Date.now()}.pdf`,d=await n.blob(),x=window.URL.createObjectURL(d),l=document.createElement("a");l.href=x,l.setAttribute("download",c),document.body.appendChild(l),l.click(),document.body.removeChild(l)}catch(n){console.error("Error al descargar archivo pdf de los detalles del ticket.",n)}},[C,Z]=y.useState(!1),he=()=>{C&&(_(null),P([])),Z(!C)},xe=["image/jpeg","image/jpg","image/png","application/pdf","video/mp4"],[K,_]=y.useState(null),[Q,P]=y.useState([]),me=n=>{w.warn(()=>e.jsx(R,{children:e.jsx(r,{component:"p",variant:"body1",children:n})}),{position:"bottom-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:i.palette.mode,transition:T,closeButton:!0,style:{backgroundColor:i.palette.background.paper,borderWidth:"1px",borderStyle:"solid",borderColor:i.palette.divider}})},je=n=>{const c=new FormData;n.forEach(d=>{c.append("archivos",d)}),_(c)},ue=n=>{const c=new FormData;n.forEach(d=>{c.append("archivos",d)}),_(c)},ve=()=>{if(K){let n=new FormData;const c=JSON.stringify({ctrl_id:j,rt_id:p});n.append("formvalues",c);for(const[d,x]of K.entries())n.append(d,x);ae(n)}};return y.useEffect(()=>{if(L&&s){const{archivos_respaldo:n}=s;k(n)}},[L,s]),y.useEffect(()=>{M&&Y&&w.error(()=>e.jsx(R,{children:e.jsx(r,{component:"p",variant:"body1",children:JSON.stringify(Y)})}),{position:"bottom-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:i.palette.mode,transition:T,closeButton:!0,style:{backgroundColor:i.palette.background.paper,borderWidth:"1px",borderStyle:"solid",borderColor:i.palette.divider}}),J&&D&&(w.success(()=>e.jsx(R,{children:e.jsx(r,{component:"p",variant:"body1",children:D.message})}),{position:"bottom-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:i.palette.mode,transition:T,closeButton:!0,style:{backgroundColor:i.palette.background.paper,borderWidth:"1px",borderStyle:"solid",borderColor:i.palette.divider}}),_(null),P([]),Z(!1),k(D.data))},[M,J,D]),e.jsxs(Ae,{open:g,onClose:v,fullWidth:!0,maxWidth:"xl",sx:{"& .MuiDialog-paper":{}},children:[e.jsx(Ie,{children:e.jsx(r,{component:"div",variant:"h5",children:"Detalles"})}),e.jsx(S,{"aria-label":"close",onClick:v,sx:{position:"absolute",right:16,top:8},children:e.jsx(Re,{})}),e.jsxs(Be,{dividers:!0,children:[de&&e.jsx(ee,{children:"Cargando detalles ..."}),le&&e.jsx(ye,{children:"Error al cargar detalles del ticket."}),L&&s&&e.jsxs(t,{container:!0,rowSpacing:1,columnSpacing:1,children:[e.jsx(t,{item:!0,xs:4,children:e.jsxs(E,{children:[e.jsx(F,{sx:{p:1},title:e.jsx(r,{component:"div",variant:"h5",children:"Solicitante"})}),e.jsx(u,{}),e.jsx(A,{children:e.jsxs(t,{container:!0,rowSpacing:1,columnSpacing:1,children:[e.jsx(t,{item:!0,xs:12,children:e.jsxs(a,{spacing:.5,alignItems:"center",children:[e.jsx("img",{src:`${I}/api/v1/ticket/fotoactividadpersonal?imgPath=${encodeURIComponent(s.solicitante.foto)}`,alt:"solicitante_foto_perfil",onError:n=>{n.currentTarget.src=ie},width:100,height:100,style:{objectFit:"cover",borderRadius:"50%"}}),e.jsx(r,{component:"p",variant:"h6",children:s.solicitante.nombre}),e.jsx(r,{component:"p",variant:"body1",children:s.solicitante.cargo})]})}),e.jsx(t,{item:!0,xs:12,children:e.jsx(u,{})}),e.jsx(t,{item:!0,xs:6,children:e.jsxs(a,{spacing:.5,children:[e.jsx(r,{component:"p",variant:"h6",children:"Nombre"}),e.jsx(r,{component:"p",variant:"body1",children:s.solicitante.nombre})]})}),e.jsx(t,{item:!0,xs:6,children:e.jsxs(a,{spacing:.5,children:[e.jsx(r,{component:"p",variant:"h6",children:"Telefono"}),e.jsx(r,{component:"p",variant:"body1",children:s.solicitante.telefono})]})}),e.jsx(t,{item:!0,xs:12,children:e.jsx(u,{})}),e.jsx(t,{item:!0,xs:6,children:e.jsxs(a,{spacing:.5,children:[e.jsx(r,{component:"p",variant:"h6",children:"Correo"}),e.jsx(r,{component:"p",variant:"body1",children:s.solicitante.correo})]})}),e.jsx(t,{item:!0,xs:6,children:e.jsxs(a,{spacing:.5,children:[e.jsx(r,{component:"p",variant:"h6",children:"DNI"}),e.jsx(r,{component:"p",variant:"body1",children:s.solicitante.dni})]})}),e.jsx(t,{item:!0,xs:12,children:e.jsx(u,{})}),e.jsx(t,{item:!0,xs:6,children:e.jsxs(a,{spacing:.5,children:[e.jsx(r,{component:"p",variant:"h6",children:"Cargo"}),e.jsx(r,{component:"p",variant:"body1",children:s.solicitante.cargo})]})}),e.jsx(t,{item:!0,xs:6,children:e.jsxs(a,{spacing:.5,children:[e.jsx(r,{component:"p",variant:"h6",children:"Contrata"}),e.jsx(r,{component:"p",variant:"body1",children:s.solicitante.contrata})]})})]})})]})}),e.jsx(t,{item:!0,xs:8,children:e.jsxs(E,{children:[e.jsx(F,{sx:{p:1},title:e.jsx(r,{component:"div",variant:"h5",children:"Ticket"})}),e.jsx(u,{}),e.jsx(A,{children:e.jsxs(t,{container:!0,rowSpacing:1.5,columnSpacing:1,children:[e.jsx(t,{item:!0,xs:4,children:e.jsxs(a,{spacing:.5,children:[e.jsx(r,{component:"p",variant:"h6",children:"Tipo Trabajo"}),e.jsx(r,{component:"p",variant:"body1",children:s.ticket.tipotrabajo})]})}),e.jsx(t,{item:!0,xs:4,children:e.jsxs(a,{spacing:.5,children:[e.jsx(r,{component:"p",variant:"h6",children:"Descripci√≥n"}),e.jsx(r,{component:"p",variant:"body1",children:s.ticket.descripcion})]})}),e.jsx(t,{item:!0,xs:4,children:e.jsxs(a,{spacing:.5,children:[e.jsx(r,{component:"p",variant:"h6",children:"Prioridad"}),e.jsx(r,{component:"p",variant:"body1",children:s.ticket.prioridad==1?"Alta":(s.ticket.prioridad==2?"Medio":"Bajo")||"Error_Prioridad"})]})}),e.jsx(t,{item:!0,xs:12,children:e.jsx(u,{})}),e.jsx(t,{item:!0,xs:4,children:e.jsxs(a,{spacing:.5,children:[e.jsx(r,{component:"p",variant:"h6",children:"Contrata"}),e.jsx(r,{component:"p",variant:"body1",children:s.ticket.contrata})]})}),e.jsx(t,{item:!0,xs:4,children:e.jsxs(a,{spacing:.5,children:[e.jsx(r,{component:"p",variant:"h6",children:"Estado"}),e.jsx(r,{component:"p",variant:"body1",children:s.ticket.estado})]})}),e.jsx(t,{item:!0,xs:4,children:e.jsxs(a,{spacing:.5,children:[e.jsx(r,{component:"p",variant:"h6",children:"Fecha Creaci√≥n"}),e.jsx(r,{component:"p",variant:"body1",children:B(s.ticket.fechacreacion)})]})}),e.jsx(t,{item:!0,xs:12,children:e.jsx(u,{})}),e.jsx(t,{item:!0,xs:4,children:e.jsxs(a,{spacing:.5,children:[e.jsx(r,{component:"p",variant:"h6",children:"Fecha Comienzo"}),e.jsx(r,{component:"p",variant:"body1",children:B(s.ticket.fechacomienzo)})]})}),e.jsx(t,{item:!0,xs:4,children:e.jsxs(a,{spacing:.5,children:[e.jsx(r,{component:"p",variant:"h6",children:"Fecha Termino"}),e.jsx(r,{component:"p",variant:"body1",children:B(s.ticket.fechatermino)})]})}),e.jsx(t,{item:!0,xs:4,children:e.jsxs(a,{spacing:.5,children:[e.jsx(r,{component:"p",variant:"h6",children:"Fecha Estado Final"}),e.jsx(r,{component:"p",variant:"body1",children:s.ticket.fechaestadofinal&&B(s.ticket.fechaestadofinal)})]})}),e.jsx(t,{item:!0,xs:12,children:e.jsx(u,{})}),e.jsx(t,{item:!0,xs:4,children:e.jsxs(a,{spacing:.5,children:[e.jsx(r,{component:"p",variant:"h6",children:"Telefono"}),e.jsx(r,{component:"p",variant:"body1",children:s.ticket.telefono})]})}),e.jsx(t,{item:!0,xs:4,children:e.jsxs(a,{spacing:.5,children:[e.jsx(r,{component:"p",variant:"h6",children:"Correo"}),e.jsx(r,{component:"p",variant:"body1",children:s.ticket.correo})]})}),e.jsx(t,{item:!0,xs:4,children:e.jsxs(a,{spacing:.5,children:[e.jsx(r,{component:"p",variant:"h6",children:"Numero Ticket:"}),e.jsx(r,{component:"p",variant:"body1",children:s.ticket.rt_id})]})})]})})]})}),e.jsx(t,{item:!0,xs:12,children:e.jsxs(E,{children:[e.jsx(F,{sx:{p:1},title:e.jsx(r,{component:"div",variant:"h5",children:"Personales"})}),e.jsx(u,{}),e.jsx(A,{children:e.jsx(ke,{component:Ce,children:e.jsxs(Se,{sx:{minWidth:650},"aria-label":"simple table",size:"small",children:[e.jsx(De,{children:e.jsxs(re,{children:[e.jsx(h,{children:"N¬∞"}),e.jsx(h,{children:"Nombre"}),e.jsx(h,{children:"Telefono"}),e.jsx(h,{children:"DNI"}),e.jsx(h,{children:"Cargo"}),e.jsx(h,{children:"Contrata"}),e.jsx(h,{children:"Foto"})]})}),e.jsx(_e,{children:s.personales.map((n,c)=>{const{ap_id:d,nombre:x,telefono:l,dni:m,cargo:$,contrata:f,foto:X}=n;return e.jsxs(re,{children:[e.jsx(h,{children:c+1}),e.jsx(h,{children:x}),e.jsx(h,{children:l}),e.jsx(h,{children:m}),e.jsx(h,{children:$}),e.jsx(h,{children:f}),e.jsx(h,{children:X&&e.jsx(He,{foto:X},d+m)})]},d)})})]})})})]})}),e.jsx(t,{item:!0,xs:12,children:e.jsxs(E,{children:[e.jsx(F,{sx:{pl:1,py:1,pr:2},title:e.jsx(r,{component:"div",variant:"h5",children:"Archivos de Respaldo"}),action:e.jsxs(S,{"aria-label":"editar_archivos_respaldo",size:"small",onClick:he,children:[!C&&e.jsx(se,{color:"warning"}),C&&e.jsx(ne,{color:"error"})]})}),e.jsx(u,{}),e.jsx(A,{children:e.jsxs(t,{container:!0,rowSpacing:1,columnSpacing:1,children:[C&&e.jsx(t,{item:!0,xs:12,sx:{marginBottom:1,borderBottomWidth:1,borderBottomStyle:"solid",borderBottomColor:i.palette.divider},children:e.jsxs(a,{spacing:1,pb:1,children:[e.jsx(Te,{supportedFormats:xe,handleError:me,onUpload:je,onDelete:ue,count:5,maxSize:10,files:Q,setFiles:P,buttonStyle:{maxWidth:300},children:"Nuevos archivos de respaldo:"}),ce&&e.jsx(ee,{children:"Enviando ..."}),Q.length>0&&e.jsx(a,{alignItems:"end",children:e.jsx(H,{sx:{maxWidth:300},onClick:ve,variant:"contained",type:"submit",startIcon:e.jsx(Ee,{}),children:"Guardar"})})]})}),e.jsx(t,{item:!0,xs:4,sx:{borderRightWidth:"2px",borderRightColor:i.palette.mode==="dark"?i.palette.divider:i.palette.grey.A800,borderRightStyle:"solid"},children:e.jsxs(a,{direction:"column",spacing:1,children:[e.jsx(r,{component:"div",variant:"body1",children:"Documentos:"}),e.jsx(U,{sx:{pr:1},children:o&&W(o,"docs").map((n,c,d)=>{const{at_id:x,ruta:l,nombreoriginal:m}=n;return e.jsx(z,{divider:c<d.length-1,secondaryAction:e.jsx(S,{edge:"end","aria-label":"download_doc",onClick:()=>{O(l,m)},children:e.jsx(N,{color:"info"})}),children:e.jsx(G,{primary:m})},x)})})]})}),e.jsx(t,{item:!0,xs:4,sx:{borderRightWidth:"2px",borderRightColor:i.palette.mode==="dark"?i.palette.divider:i.palette.grey.A800,borderRightStyle:"solid"},children:e.jsxs(a,{direction:"column",spacing:1,children:[e.jsx(r,{component:"div",variant:"body1",children:"Fotos:"}),e.jsx(U,{sx:{pr:1},children:o&&W(o,"imgs").map((n,c,d)=>{const{at_id:x,ruta:l,nombreoriginal:m}=n;return e.jsx(z,{divider:c<d.length-1,secondaryAction:e.jsx(S,{edge:"end","aria-label":"download_img",onClick:()=>{O(l,m)},children:e.jsx(N,{color:"info"})}),children:e.jsx(G,{primary:m})},x)})})]})}),e.jsx(t,{item:!0,xs:4,children:e.jsxs(a,{direction:"column",spacing:1,children:[e.jsx(r,{component:"div",variant:"body1",children:"Videos:"}),e.jsx(U,{sx:{pr:1},children:o&&W(o,"vids").map((n,c,d)=>{const{at_id:x,ruta:l,nombreoriginal:m}=n;return e.jsx(z,{divider:c<d.length-1,secondaryAction:e.jsx(S,{edge:"end","aria-label":"download_vids",onClick:()=>{O(l,m)},children:e.jsx(N,{color:"info"})}),children:e.jsx(G,{primary:m})},x)})})]})})]})})]})})]})]}),e.jsx(Fe,{children:e.jsx(H,{variant:"contained",startIcon:e.jsx(we,{}),onClick:pe,children:"Descargar"})})]})};export{sr as DialogDetallesTicket,sr as default};
