import{r as f,u as De,I as A,F as Be,L as Le,j as e,g as ze,a as Ae,s as k,m as ee,T as Ee,S as ye,M as Se,b as Fe,c as he,d as Z,e as He,i as Ne,f as $e,h as Y,k as We,l as N,B as C,G as m,n as y,o as R,p as Qe,q as te,t as W,v as Ue,w as se,x as ae,y as F,z as O,A as oe,C as P,D as ie,E,H as Ve,J as Ge,K as _,N as Ce,O as Ke,P as Xe,Q as qe,R as Je,U as Ze,V as Oe,W as xe,X as et,Y as tt,Z as st,_ as we,$ as at,a0 as ot,a1 as ue,a2 as ge,a3 as fe,a4 as de,a5 as it}from"./index-7f3888f4.js";import{_ as Q}from"./react-apexcharts.min-81c0cf6e.js";import{d as nt}from"./Close-379d1b80.js";import{u as lt,f as me,N as rt,g as ct,a as dt,b as xt,S as ht}from"./index-f0d4e2ae.js";import{T as ut,d as gt,a as ft}from"./KeyboardArrowUp-9efef379.js";import{T as w,a as Te,P as _e,b as Ie,c as Me,d as H,e as ve}from"./PaperTable-d3644a14.js";import{K as mt,a as pt,D as bt}from"./DateTimePicker-372b6a94.js";import{g as jt}from"./getFormattedDateTime-3bd4b06d.js";import{d as yt}from"./Memory-dbf74cfe.js";import{D as Pe}from"./Divider-6d6f4f47.js";import"./useMobilePicker-8618c87d.js";import"./InputAdornment-709639ba.js";import"./Chip-7a4f0a5e.js";import"./SwitchBase-3bb2982b.js";import"./LastPage-7f39ad88.js";import"./date-time-utils-35ca60ce.js";const St=f.forwardRef(function(a,c){const{backIconButtonProps:l,count:r,disabled:n=!1,getItemAriaLabel:o,nextIconButtonProps:g,onPageChange:d,page:i,rowsPerPage:x,showFirstButton:p,showLastButton:s,slots:u={},slotProps:b={},...D}=a,h=De(),j=L=>{d(L,0)},S=L=>{d(L,i-1)},T=L=>{d(L,i+1)},le=L=>{d(L,Math.max(0,Math.ceil(r/x)-1))},U=u.firstButton??A,V=u.lastButton??A,B=u.nextButton??A,G=u.previousButton??A,K=u.firstButtonIcon??Be,z=u.lastButtonIcon??Le,I=u.nextButtonIcon??mt,M=u.previousButtonIcon??pt,X=h?V:U,q=h?B:G,re=h?G:B,J=h?U:V,ce=h?b.lastButton:b.firstButton,v=h?b.nextButton:b.previousButton,Re=h?b.previousButton:b.nextButton,ke=h?b.firstButton:b.lastButton;return e.jsxs("div",{ref:c,...D,children:[p&&e.jsx(X,{onClick:j,disabled:n||i===0,"aria-label":o("first",i),title:o("first",i),...ce,children:h?e.jsx(z,{...b.lastButtonIcon}):e.jsx(K,{...b.firstButtonIcon})}),e.jsx(q,{onClick:S,disabled:n||i===0,color:"inherit","aria-label":o("previous",i),title:o("previous",i),...v??l,children:h?e.jsx(I,{...b.nextButtonIcon}):e.jsx(M,{...b.previousButtonIcon})}),e.jsx(re,{onClick:T,disabled:n||(r!==-1?i>=Math.ceil(r/x)-1:!1),color:"inherit","aria-label":o("next",i),title:o("next",i),...Re??g,children:h?e.jsx(M,{...b.previousButtonIcon}):e.jsx(I,{...b.nextButtonIcon})}),s&&e.jsx(J,{onClick:le,disabled:n||i>=Math.ceil(r/x)-1,"aria-label":o("last",i),title:o("last",i),...ke,children:h?e.jsx(K,{...b.firstButtonIcon}):e.jsx(z,{...b.lastButtonIcon})})]})}),Ct=St;function wt(t){return Ae("MuiTablePagination",t)}const Tt=ze("MuiTablePagination",["root","toolbar","spacer","selectLabel","selectRoot","select","selectIcon","input","menuItem","displayedRows","actions"]),$=Tt;var pe;const _t=k(w,{name:"MuiTablePagination",slot:"Root",overridesResolver:(t,a)=>a.root})(ee(({theme:t})=>({overflow:"auto",color:(t.vars||t).palette.text.primary,fontSize:t.typography.pxToRem(14),"&:last-child":{padding:0}}))),It=k(Ee,{name:"MuiTablePagination",slot:"Toolbar",overridesResolver:(t,a)=>({[`& .${$.actions}`]:a.actions,...a.toolbar})})(ee(({theme:t})=>({minHeight:52,paddingRight:2,[`${t.breakpoints.up("xs")} and (orientation: landscape)`]:{minHeight:52},[t.breakpoints.up("sm")]:{minHeight:52,paddingRight:2},[`& .${$.actions}`]:{flexShrink:0,marginLeft:20}}))),Mt=k("div",{name:"MuiTablePagination",slot:"Spacer",overridesResolver:(t,a)=>a.spacer})({flex:"1 1 100%"}),vt=k("p",{name:"MuiTablePagination",slot:"SelectLabel",overridesResolver:(t,a)=>a.selectLabel})(ee(({theme:t})=>({...t.typography.body2,flexShrink:0}))),Pt=k(ye,{name:"MuiTablePagination",slot:"Select",overridesResolver:(t,a)=>({[`& .${$.selectIcon}`]:a.selectIcon,[`& .${$.select}`]:a.select,...a.input,...a.selectRoot})})({color:"inherit",fontSize:"inherit",flexShrink:0,marginRight:32,marginLeft:8,[`& .${$.select}`]:{paddingLeft:8,paddingRight:24,textAlign:"right",textAlignLast:"right"}}),Yt=k(Se,{name:"MuiTablePagination",slot:"MenuItem",overridesResolver:(t,a)=>a.menuItem})({}),Rt=k("p",{name:"MuiTablePagination",slot:"DisplayedRows",overridesResolver:(t,a)=>a.displayedRows})(ee(({theme:t})=>({...t.typography.body2,flexShrink:0})));function kt({from:t,to:a,count:c}){return`${t}–${a} of ${c!==-1?c:`more than ${a}`}`}function Dt(t){return`Go to ${t} page`}const Bt=t=>{const{classes:a}=t;return $e({root:["root"],toolbar:["toolbar"],spacer:["spacer"],selectLabel:["selectLabel"],select:["select"],input:["input"],selectIcon:["selectIcon"],menuItem:["menuItem"],displayedRows:["displayedRows"],actions:["actions"]},wt,a)},Lt=f.forwardRef(function(a,c){const l=Fe({props:a,name:"MuiTablePagination"}),{ActionsComponent:r=Ct,backIconButtonProps:n,className:o,colSpan:g,component:d=w,count:i,disabled:x=!1,getItemAriaLabel:p=Dt,labelDisplayedRows:s=kt,labelRowsPerPage:u="Rows per page:",nextIconButtonProps:b,onPageChange:D,onRowsPerPageChange:h,page:j,rowsPerPage:S,rowsPerPageOptions:T=[10,25,50,100],SelectProps:le={},showFirstButton:U=!1,showLastButton:V=!1,slotProps:B={},slots:G={},...K}=l,z=l,I=Bt(z),M=(B==null?void 0:B.select)??le,X=M.native?"option":Yt;let q;(d===w||d==="td")&&(q=g||1e3);const re=he(M.id),J=he(M.labelId),ce=()=>i===-1?(j+1)*S:S===-1?i:Math.min(i,(j+1)*S);return e.jsx(_t,{colSpan:q,ref:c,as:d,ownerState:z,className:Z(I.root,o),...K,children:e.jsxs(It,{className:I.toolbar,children:[e.jsx(Mt,{className:I.spacer}),T.length>1&&e.jsx(vt,{className:I.selectLabel,id:J,children:u}),T.length>1&&e.jsx(Pt,{variant:"standard",...!M.variant&&{input:pe||(pe=e.jsx(He,{}))},value:S,onChange:h,id:re,labelId:J,...M,classes:{...M.classes,root:Z(I.input,I.selectRoot,(M.classes||{}).root),select:Z(I.select,(M.classes||{}).select),icon:Z(I.selectIcon,(M.classes||{}).icon)},disabled:x,children:T.map(v=>f.createElement(X,{...!Ne(X)&&{ownerState:z},className:I.menuItem,key:v.label?v.label:v,value:v.value?v.value:v},v.label?v.label:v))}),e.jsx(Rt,{className:I.displayedRows,children:s({from:i===0?0:j*S+1,to:ce(),count:i===-1?-1:i,page:j})}),e.jsx(r,{className:I.actions,backIconButtonProps:n,count:i,nextIconButtonProps:b,onPageChange:D,page:j,rowsPerPage:S,showFirstButton:U,showLastButton:V,slotProps:B.actions,slots:G.actions,getItemAriaLabel:p,disabled:x})]})})}),zt=Lt;function ne(t,a,c){const l=[],r=[];return t.length>0?(t.forEach(n=>{n[a]&&n[c]&&(l.push(n[a]),r.push(n[c]))}),{categories:l,series:r}):{categories:l,series:r}}const At=()=>{const[t,a]=f.useState({configs:{chart:{type:"bar",id:"bar_active_pin_entrada",height:365,toolbar:{show:!1},background:"#1e1e1e"},plotOptions:{bar:{columnWidth:"45%",borderRadius:4,borderRadiusApplication:"end",horizontal:!0,dataLabels:{position:"top"}}},dataLabels:{enabled:!0,offsetX:-6},xaxis:{categories:[],axisBorder:{show:!1},axisTicks:{show:!0},title:{text:"Numero de activaciones",style:{color:"#8c8c8c"}},labels:{style:{colors:"#8c8c8c",cssClass:"apexcharts-xaxis-label"}}},yaxis:{max:s=>s+2,labels:{style:{colors:"#8c8c8c",cssClass:"apexcharts-yaxis-label"}}},grid:{show:!0},tooltip:{enabled:!1},colors:["#1668dc","#65a9f3"]}}),[c,l]=f.useState([]),{filters:r}=Y(s=>s.dashboardSlice),[n,{isError:o,isLoading:g,isSuccess:d,data:i}]=We(),x=N(),p=x.palette.mode;return f.useEffect(()=>{a(s=>{const u=p=="dark"?x.palette.text.secondary:x.palette.text.primary;return{configs:{...s.configs,chart:{...s.configs.chart,background:x.palette.background.paper},xaxis:{...s.configs.xaxis,labels:{...s.configs.xaxis?s.configs.xaxis.labels:{},style:{...s.configs.xaxis&&s.configs.xaxis.labels?s.configs.xaxis.labels.style:{},colors:u,cssClass:"apexcharts-xaxis-label"}},title:{...s.configs.xaxis?s.configs.xaxis.title:{},style:{color:u}}},yaxis:{...s.configs.yaxis,labels:{style:{colors:u,cssClass:"apexcharts-yaxis-label"}}}}}})},[p]),f.useEffect(()=>{if(r.ctrl_id!=""&&r.date!=null){const{ctrl_id:s,date:u,is_monthly:b}=r;n({ctrl_id:Number(s),date:u,monthly:b?"true":"false"})}},[r]),f.useEffect(()=>{if(!g&&d&&i){const s=ne(i,"detector","total_activo");a(u=>({configs:{...u.configs,xaxis:{...u.configs.xaxis,categories:s.categories}}})),l([{data:s.series,name:"activaciones"}])}!g&&o&&(a(s=>({configs:{...s.configs,xaxis:{...s.configs.xaxis,categories:[]}}})),l([]))},[d,i,g,o]),e.jsx(e.Fragment,{children:e.jsxs(C,{children:[e.jsxs(m,{container:!0,alignItems:"center",justifyContent:"space-between",children:[e.jsx(m,{children:e.jsx(y,{variant:"h5",children:"Pines Entrada"})}),e.jsx(m,{})]}),e.jsx(R,{sx:{mt:2},children:e.jsx(Q,{options:t.configs,series:c,type:"bar",height:365})})]})})},Et=()=>{const[t,a]=f.useState({configs:{chart:{type:"bar",id:"bar_active_pin_salida",height:365,toolbar:{show:!1},background:"#1e1e1e"},plotOptions:{bar:{columnWidth:"45%",borderRadius:4,borderRadiusApplication:"end",horizontal:!0,dataLabels:{position:"top"}}},dataLabels:{enabled:!0,offsetX:-6},xaxis:{categories:[],axisBorder:{show:!1},axisTicks:{show:!0},title:{text:"Numero de activaciones",style:{color:"#8c8c8c"}},labels:{style:{colors:"#8c8c8c",cssClass:"apexcharts-xaxis-label"}}},yaxis:{max:s=>s+2,labels:{style:{colors:"#8c8c8c",cssClass:"apexcharts-yaxis-label"}}},grid:{show:!0},tooltip:{enabled:!1},colors:["#d89614"]}}),[c,l]=f.useState([]),{filters:r}=Y(s=>s.dashboardSlice),[n,{isError:o,isLoading:g,isSuccess:d,data:i}]=Qe(),x=N(),p=x.palette.mode;return f.useEffect(()=>{a(s=>{const u=p=="dark"?x.palette.text.secondary:x.palette.text.primary;return{configs:{...s.configs,chart:{...s.configs.chart,background:x.palette.background.paper},xaxis:{...s.configs.xaxis,labels:{...s.configs.xaxis?s.configs.xaxis.labels:{},style:{...s.configs.xaxis&&s.configs.xaxis.labels?s.configs.xaxis.labels.style:{},colors:u,cssClass:"apexcharts-xaxis-label"}},title:{...s.configs.xaxis?s.configs.xaxis.title:{},style:{color:u}}},yaxis:{...s.configs.yaxis,labels:{style:{colors:u,cssClass:"apexcharts-yaxis-label"}}}}}})},[p]),f.useEffect(()=>{if(r.ctrl_id!=""&&r.date!=null){const{ctrl_id:s,date:u,is_monthly:b}=r;n({ctrl_id:Number(s),date:u,monthly:b?"true":"false"})}},[r]),f.useEffect(()=>{if(!g&&d&&i){const s=ne(i,"actuador","total_activo");a(u=>({configs:{...u.configs,xaxis:{...u.configs.xaxis,categories:s.categories}}})),l([{data:s.series,name:"activaciones"}])}!g&&o&&(a(s=>({configs:{...s.configs,xaxis:{...s.configs.xaxis,categories:[]}}})),l([]))},[d,i,g,o]),e.jsx(e.Fragment,{children:e.jsxs(C,{children:[e.jsxs(m,{container:!0,alignItems:"center",justifyContent:"space-between",children:[e.jsx(m,{children:e.jsx(y,{variant:"h5",children:"Pines Salida"})}),e.jsx(m,{})]}),e.jsx(R,{sx:{mt:2},children:e.jsx(Q,{options:t.configs,series:c,type:"bar",height:365})})]})})},Ft=()=>{const{filters:t,other_filters:a}=Y(h=>h.dashboardSlice),c=te(),l=W(),[r,n]=f.useState({configs:{chart:{type:"donut",height:365},plotOptions:{pie:{donut:{labels:{show:!0,total:{showAlways:!0,show:!0,color:"#8c8c8c"},value:{color:"#8c8c8c"}}}}},labels:["Registrado","No registrado","Remoto"],dataLabels:{formatter(h,j){return j.w.globals.series[j.seriesIndex]}},legend:{labels:{colors:"#8c8c8c"}}}}),[o,g]=f.useState([0,0,0]),[d,{isError:i,isLoading:x,isSuccess:p,data:s}]=Ue(),u=N(),b=u.palette.mode,D=f.useCallback((h,j,S)=>{const T=S.dataPointIndex;T!=null&&T!=null&&T>-1&&t.is_monthly&&(l(se(a.region)),l(ae(t.ctrl_id)),T==0?(l(F("acceso")),l(O([{id:"autorizacion",value:"1"},{id:"tipo",value:"1"}]))):T==1?(l(F("acceso")),l(O([{id:"autorizacion",value:"0"},{id:"tipo",value:"1"},{id:"co_id",value:"0"}]))):T==2&&(l(F("salida")),l(O([{id:"es_id",value:"1"},{id:"estado",value:"1"}]))),l(oe(P(t.date,"YYYY-MM").startOf("month").format("YYYY-MM-DD HH:mm:ss"))),l(ie(P(t.date,"YYYY-MM").endOf("month").format("YYYY-MM-DD HH:mm:ss"))),c("/logs"))},[t.is_monthly]);return f.useEffect(()=>{n(h=>{const j=b=="dark"?u.palette.text.secondary:u.palette.text.primary;return{configs:{...h.configs,chart:{...h.configs.chart,background:u.palette.background.paper},plotOptions:{pie:{donut:{labels:{show:!0,total:{showAlways:!0,show:!0,color:j},value:{color:j}}}}},legend:{...h.configs.legend,labels:{colors:j}}}}})},[b]),f.useEffect(()=>{if(t.ctrl_id!=""&&t.date!=null){const{ctrl_id:h,date:j,is_monthly:S}=t;d({ctrl_id:Number(h),date:j,monthly:S?"true":"false"})}},[t]),f.useEffect(()=>{!x&&p&&s&&(g([s.data.tarjeta.total_registrado,s.data.tarjeta.total_noregistrado,s.data.remoto.total_remoto]),n(h=>({configs:{...h.configs,chart:{...h.configs.chart,events:{click:D}}}}))),!x&&i&&g([0,0,0])},[p,s,x,i,t.is_monthly]),e.jsx(e.Fragment,{children:e.jsxs(C,{children:[e.jsxs(m,{container:!0,alignItems:"center",justifyContent:"space-between",children:[e.jsx(m,{children:e.jsx(y,{variant:"h5",children:"Accesos"})}),e.jsx(m,{})]}),e.jsx(R,{sx:{mt:2,height:365},children:e.jsx(Q,{options:r.configs,series:o,type:"donut",height:365})})]})})},Ht=()=>{const[t,a]=f.useState({configs:{chart:{type:"bar",height:365,toolbar:{show:!1},background:"#1e1e1e"},plotOptions:{bar:{columnWidth:"45%",distributed:!0,borderRadius:8,borderRadiusApplication:"end",dataLabels:{position:"top"}}},dataLabels:{enabled:!0},legend:{show:!1},xaxis:{categories:[],labels:{style:{colors:"#8c8c8c",cssClass:"apexcharts-xaxis-label"},formatter(s,u,b){return E(String(s),15,!0)}}},yaxis:{stepSize:1,min:0,max:s=>s+1,title:{text:"Numero Tickets",style:{color:"#8c8c8c"}},labels:{style:{colors:"#8c8c8c",cssClass:"apexcharts-yaxis-label"}}},tooltip:{enabled:!1}}}),[c,l]=f.useState([]),{filters:r}=Y(s=>s.dashboardSlice),[n,{isError:o,isLoading:g,isSuccess:d,data:i}]=Ve(),x=N(),p=x.palette.mode;return f.useEffect(()=>{a(s=>{const u=p=="dark"?x.palette.text.secondary:x.palette.text.primary;return{configs:{...s.configs,chart:{...s.configs.chart,background:x.palette.background.paper},xaxis:{...s.configs.xaxis,labels:{...s.configs.xaxis?s.configs.xaxis.labels:{},style:{...s.configs.xaxis&&s.configs.xaxis.labels?s.configs.xaxis.labels.style:{},colors:u,cssClass:"apexcharts-xaxis-label"}},title:{...s.configs.xaxis?s.configs.xaxis.title:{},style:{color:u}}},yaxis:{...s.configs.yaxis,labels:{style:{colors:u,cssClass:"apexcharts-yaxis-label"}}}}}})},[p]),f.useEffect(()=>{if(r.ctrl_id!=""&&r.date!=null){const{ctrl_id:s,date:u,is_monthly:b}=r;n({ctrl_id:Number(s),date:u,monthly:b?"true":"false"})}},[r]),f.useEffect(()=>{if(!g&&d&&i){const s=ne(i.data,"contrata","total_ticket");a(u=>({configs:{...u.configs,xaxis:{...u.configs.xaxis,categories:s.categories}}})),l([{data:s.series,name:"tickets"}])}!g&&o&&(a(s=>({configs:{...s.configs,xaxis:{...s.configs.xaxis,categories:[]}}})),l([]))},[d,i,g,o]),e.jsx(e.Fragment,{children:e.jsxs(C,{children:[e.jsxs(m,{container:!0,alignItems:"center",justifyContent:"space-between",children:[e.jsx(m,{children:e.jsx(y,{variant:"h5",children:"Tickets"})}),e.jsx(m,{})]}),e.jsx(R,{sx:{mt:2,height:365},children:e.jsx(Q,{options:t.configs,series:c,type:"bar",height:365})})]})})},Nt="/assets/alarm-icon-a43fb34b.svg",$t=()=>{const{filters:t,other_filters:a}=Y(p=>p.dashboardSlice),[c,{isError:l,isLoading:r,isSuccess:n,data:o}]=Ge(),[g,d]=f.useState(0),i=te(),x=W();return f.useEffect(()=>{if(t.ctrl_id!==""&&t.date!==null){const{ctrl_id:p,date:s,is_monthly:u}=t;c({ctrl_id:Number(p),date:s,monthly:u?"true":"false"})}},[t]),f.useEffect(()=>{!r&&n&&o&&d(o.data.total_alarma),!r&&l&&d(0)},[n,o,r,l]),e.jsxs(R,{sx:{p:2.25},children:[e.jsx(y,{variant:"h6",color:"text.secondary",children:"Alarmas"}),e.jsxs(C,{component:"div",sx:{py:3,display:"flex",alignItems:"center",position:"relative"},children:[e.jsxs(_,{direction:"row",alignItems:"end",children:[e.jsx(y,{color:"inherit",component:"div",fontSize:70,fontWeight:700,lineHeight:1,children:g}),e.jsx(y,{color:"inherit",component:"span",variant:"body1",children:"activaciones"})]}),e.jsx("img",{src:Nt,alt:"alarm-icon",width:80,style:{position:"absolute",top:0,right:0}})]}),t.is_monthly&&e.jsx(_,{direction:"row",justifyContent:"end",children:e.jsx(Ce,{component:"button",underline:"hover",onClick:()=>{x(se(a.region)),x(ae(t.ctrl_id)),x(F("salida")),x(oe(P(t.date,"YYYY-MM").startOf("month").format("YYYY-MM-DD HH:mm:ss"))),x(ie(P(t.date,"YYYY-MM").endOf("month").format("YYYY-MM-DD HH:mm:ss"))),i("/logs")},children:"Ver Mas"})})]})},Wt="/assets/tarjeta-icon-b78bb548.svg",Ye=({onClose:t,open:a,title:c,children:l})=>e.jsxs(Ke,{open:a,onClose:t,fullWidth:!0,maxWidth:"md",children:[e.jsx(Xe,{children:e.jsx(y,{component:"div",variant:"h5",children:c})}),e.jsx(A,{"aria-label":"close",onClick:t,sx:{position:"absolute",right:16,top:8},children:e.jsx(nt,{})}),e.jsx(qe,{dividers:!0,children:l})]}),Qt=({data:t})=>{const a=f.useMemo(()=>t.length===0?[]:Object.keys(t[0]).map(n=>({accessorKey:n,header:()=>e.jsx("span",{children:n})})),[t]),c=lt({data:t,columns:a,getCoreRowModel:ct(),getFilteredRowModel:dt(),getPaginationRowModel:xt(),initialState:{pagination:{pageSize:25}}}),{pageSize:l,pageIndex:r}=c.getState().pagination;return e.jsx(e.Fragment,{children:e.jsxs(C,{sx:{height:"100%",width:"100%",display:"flex",flexDirection:"column",overflow:"hidden",rowGap:1},children:[e.jsx(C,{sx:{flex:1,overflow:"hidden"},children:e.jsxs(Te,{sx:{height:"100%",display:"flex",flexDirection:"column"},component:_e,variant:"outlined",children:[e.jsxs(Ie,{size:"small",stickyHeader:!0,"aria-label":"sticky table",sx:{position:"relative"},children:[e.jsx(Me,{children:c.getHeaderGroups().map(n=>e.jsxs(Je.Fragment,{children:[e.jsx(H,{children:n.headers.map(o=>e.jsx(w,{colSpan:o.colSpan,children:o.isPlaceholder?null:e.jsx("div",{children:me(o.column.columnDef.header,o.getContext())})},o.id))}),e.jsx(H,{children:n.headers.map(o=>e.jsx(w,{colSpan:o.colSpan,children:o.isPlaceholder?null:e.jsx("div",{children:o.column.getCanFilter()&&e.jsx("div",{children:e.jsx(Ut,{column:o.column,table:c})})})},o.id))})]},n.id))}),e.jsx(ve,{children:c.getRowModel().rows.map(n=>e.jsx(H,{children:n.getVisibleCells().map(o=>e.jsx(w,{children:me(o.column.columnDef.cell,o.getContext())},o.id))},n.id))})]}),c.getFilteredRowModel().rows.length===0&&e.jsxs(C,{sx:{width:"100%",height:"100%",textAlign:"center",py:2,display:"flex",flexDirection:"column",alignItems:"center",rowGap:2},children:[e.jsx(rt,{}),"Datos no encontrados"]})]})}),e.jsx(zt,{rowsPerPageOptions:[25,50,100,{label:"All",value:t.length}],component:"div",count:c.getFilteredRowModel().rows.length,rowsPerPage:l,page:r,labelDisplayedRows:({from:n,to:o,count:g})=>`${n}–${o} de ${g!==-1?g:`more than ${o}`}`,labelRowsPerPage:"Filas por Pagina :",SelectProps:{inputProps:{"aria-label":"rows per page"},id:"test-id"},onPageChange:(n,o)=>{c.setPageIndex(o)},onRowsPerPageChange:n=>{const o=n.target.value?Number(n.target.value):25;c.setPageSize(o)},ActionsComponent:ut})]})})};function Ut({column:t}){const a=t.getFilterValue();return e.jsx(Ze,{value:a??"",onChange:c=>t.setFilterValue(c.target.value),placeholder:"Buscar...",inputProps:{"aria-label":"search"},id:`filter-column-by-${t.id}`,size:"small",fullWidth:!0})}const Vt=()=>{const{filters:t}=Y(s=>s.dashboardSlice),[a,{isError:c,isLoading:l,isSuccess:r,data:n}]=Oe(),[o,g]=f.useState(0),[d,i]=f.useState(!1),x=()=>{i(!1)},p=()=>{!l&&r&&n&&i(!0)};return f.useEffect(()=>{t.ctrl_id!==""&&t.date!==null&&a(void 0)},[t.ctrl_id,t.date]),f.useEffect(()=>{!l&&r&&n&&g(n.total_tarjeta),!l&&c&&g(0)},[r,n,l,c]),e.jsxs(R,{sx:{p:2.25},children:[e.jsx(y,{variant:"h6",color:"text.secondary",children:"Tarjetas"}),e.jsxs(C,{component:"div",sx:{py:3,display:"flex",alignItems:"center",position:"relative"},children:[e.jsxs(_,{direction:"row",alignItems:"end",children:[e.jsx(y,{color:"inherit",component:"div",fontSize:70,fontWeight:700,lineHeight:1,children:o}),e.jsx(y,{color:"inherit",component:"span",variant:"body1",children:"asignados"})]}),e.jsx("img",{src:Wt,alt:"alarm-icon",width:80,style:{position:"absolute",top:0,right:0}})]}),e.jsx(_,{direction:"row",justifyContent:"end",children:t.is_monthly&&e.jsx(xe,{size:"small",onClick:p,children:"Ver Detalles"})}),e.jsx(Ye,{title:"Detalles Tarjetas Asignadas",onClose:x,open:d,children:!l&&r&&n&&e.jsx(Qt,{data:n.data})})]})},Gt="/assets/electricity-icon-e7ff5bd6.svg",Kt=()=>{const{filters:t,other_filters:a}=Y(p=>p.dashboardSlice),[c,{isError:l,isLoading:r,isSuccess:n,data:o}]=et(),[g,d]=f.useState(0),i=te(),x=W();return f.useEffect(()=>{if(t.ctrl_id!=""&&t.date!=null){const{ctrl_id:p,date:s,is_monthly:u}=t;c({ctrl_id:Number(p),date:s,monthly:u?"true":"false"})}},[t]),f.useEffect(()=>{!r&&n&&o&&d(o.acumulado),!r&&l&&d(0)},[n,o,r,l]),e.jsxs(R,{sx:{p:2.25},children:[e.jsx(y,{variant:"h6",color:"text.secondary",children:"Potencia"}),e.jsxs(C,{component:"div",sx:{py:3,display:"flex",alignItems:"center",position:"relative"},children:[e.jsxs(_,{direction:"row",alignItems:"end",spacing:1,children:[e.jsx(y,{color:"inherit",component:"div",fontSize:70,fontWeight:700,lineHeight:1,children:g}),e.jsx(y,{color:"inherit",component:"span",fontSize:30,lineHeight:1,children:"kw"}),e.jsx(y,{color:"inherit",component:"span",variant:"body1",children:"consumidos"})]}),e.jsx("img",{src:Gt,alt:"alarm-icon",width:80,style:{position:"absolute",top:0,right:0}})]}),t.is_monthly&&e.jsx(_,{direction:"row",justifyContent:"end",children:e.jsx(Ce,{component:"button",underline:"hover",onClick:()=>{x(se(a.region)),x(ae(t.ctrl_id)),x(F("energia")),x(oe(P(t.date,"YYYY-MM").startOf("month").format("YYYY-MM-DD HH:mm:ss"))),x(ie(P(t.date,"YYYY-MM").endOf("month").format("YYYY-MM-DD HH:mm:ss"))),i("/logs")},children:"Ver Mas"})})]})},Xt=()=>{const[t,a]=f.useState({configs:{chart:{height:365,type:"bar",toolbar:{show:!1},background:"#1e1e1e"},plotOptions:{bar:{columnWidth:"45%",distributed:!0,borderRadius:8,borderRadiusApplication:"end",dataLabels:{position:"top"}}},dataLabels:{enabled:!0},legend:{show:!1},xaxis:{categories:[],labels:{style:{colors:"#8c8c8c",cssClass:"apexcharts-xaxis-label"},formatter(h,j,S){return E(String(h),15,!0)}}},yaxis:{stepSize:1,min:0,max:h=>h+1,title:{text:"Temperatura Max",style:{color:"#8c8c8c"}},labels:{style:{colors:"#8c8c8c",cssClass:"apexcharts-yaxis-label"}}},tooltip:{enabled:!1}}}),[c,l]=f.useState([]),{filters:r}=Y(h=>h.dashboardSlice),[n,{isError:o,isLoading:g,isSuccess:d,data:i}]=tt(),x=N(),p=x.palette.mode;f.useEffect(()=>{a(h=>{const j=p=="dark"?x.palette.text.secondary:x.palette.text.primary;return{configs:{...h.configs,chart:{...h.configs.chart,background:x.palette.background.paper},xaxis:{...h.configs.xaxis,labels:{...h.configs.xaxis?h.configs.xaxis.labels:{},style:{...h.configs.xaxis&&h.configs.xaxis.labels?h.configs.xaxis.labels.style:{},colors:j,cssClass:"apexcharts-xaxis-label"}},title:{...h.configs.xaxis?h.configs.xaxis.title:{},style:{color:j}}},yaxis:{...h.configs.yaxis,labels:{style:{colors:j,cssClass:"apexcharts-yaxis-label"}}}}}})},[p]),f.useEffect(()=>{if(r.ctrl_id!=""&&r.date!=null){const{ctrl_id:h,date:j,is_monthly:S}=r;n({ctrl_id:Number(h),date:j,monthly:S?"true":"false"})}},[r]),f.useEffect(()=>{if(!g&&d&&i){const h=be(i.data),j=Object.values(h).map(T=>T[0]),S=ne(j,"ubicacion","max_valor");a(T=>({configs:{...T.configs,xaxis:{...T.configs.xaxis,categories:S.categories}}})),l([{data:S.series,name:"tickets"}])}!g&&o&&(a(h=>({configs:{...h.configs,xaxis:{...h.configs.xaxis,categories:[]}}})),l([]))},[d,i,g,o]);const[s,u]=f.useState(!1),b=()=>{u(!1)},D=()=>{!g&&d&&i&&u(!0)};return e.jsx(e.Fragment,{children:e.jsxs(C,{children:[e.jsxs(m,{container:!0,alignItems:"center",justifyContent:"space-between",children:[e.jsx(m,{children:e.jsx(y,{variant:"h5",children:"Temperatura"})}),e.jsx(m,{})]}),e.jsxs(R,{sx:{mt:2,height:r.is_monthly?420:365},children:[e.jsx(Q,{options:t.configs,series:c,type:"bar",height:365}),e.jsx(_,{direction:"row",justifyContent:"end",children:r.is_monthly&&e.jsx(xe,{size:"small",onClick:D,children:"Ver Detalles"})})]}),e.jsx(Ye,{title:"Detalles Temperatura",onClose:b,open:s,children:!g&&d&&i&&e.jsx(qt,{data:Object.values(be(i.data))})})]})})},qt=({data:t})=>e.jsx(Te,{component:_e,variant:"outlined",children:e.jsxs(Ie,{size:"small","aria-label":"a dense table",children:[e.jsx(Me,{children:e.jsxs(H,{children:[e.jsx(w,{children:"Sensor Temperatura"}),e.jsx(w,{children:"Serie"}),e.jsx(w,{children:"Max Valor"}),e.jsx(w,{children:"Fecha"}),e.jsx(w,{children:"Acción"})]})}),e.jsx(ve,{children:t.map((a,c)=>e.jsx(Jt,{data:a},c))})]})}),Jt=({data:t})=>{const[a,c]=f.useState(!0),{filters:l,other_filters:r}=Y(g=>g.dashboardSlice),n=te(),o=W();return e.jsxs(e.Fragment,{children:[e.jsxs(H,{children:[e.jsx(w,{children:e.jsxs(_,{direction:"row",alignItems:"center",children:[e.jsx(A,{"aria-label":"expand row",size:"small",onClick:()=>c(!a),children:a?e.jsx(gt,{}):e.jsx(ft,{})}),e.jsx(y,{children:t[0].ubicacion})]})}),e.jsx(w,{colSpan:4})]}),a&&t.map(g=>e.jsxs(H,{children:[e.jsx(w,{}),e.jsx(w,{children:g.serie}),e.jsx(w,{children:g.max_valor}),e.jsxs(w,{children:[" ",jt(g.fecha)]}),e.jsxs(w,{children:[" ",e.jsx(xe,{variant:"contained",color:"info",onClick:()=>{o(se(r.region)),o(ae(l.ctrl_id)),o(F("temperatura")),o(O([{id:"st_id",value:g.st_id}])),o(oe(P(l.date,"YYYY-MM").startOf("month").format("YYYY-MM-DD HH:mm:ss"))),o(ie(P(l.date,"YYYY-MM").endOf("month").format("YYYY-MM-DD HH:mm:ss"))),n("/logs")},children:"Ver Mas"})]})]},g.rtmp_id))]})};function be(t){const a={};return t.forEach(c=>{a[c.st_id]||(a[c.st_id]=[]),a[c.st_id].push(c)}),a}const Zt=()=>{const{filters:t}=Y(i=>i.dashboardSlice),[a,{isError:c,isLoading:l,isSuccess:r,data:n}]=st(),[o,g]=f.useState({camera:[],controller:[]}),d=N();return f.useEffect(()=>{if(t.ctrl_id!=""&&t.date!=null){const{ctrl_id:i}=t;a({ctrl_id:Number(i)})}},[t]),f.useEffect(()=>{!l&&r&&n&&g(n.states),!l&&c&&g({camera:[],controller:[]})},[r,n,l,c]),e.jsxs(C,{children:[e.jsxs(m,{container:!0,alignItems:"center",justifyContent:"space-between",children:[e.jsx(m,{children:e.jsx(y,{variant:"h5",children:"Estados"})}),e.jsx(m,{})]}),e.jsx(R,{sx:{mt:2,height:t.is_monthly?420:365},children:e.jsx(C,{sx:{width:"100%",height:"100%",position:"relative"},children:e.jsx(C,{sx:{width:"100%",height:"100%",position:"absolute"},children:e.jsx(we,{sx:{maxWidth:"100%",maxHeight:"100%"},children:e.jsxs(m,{container:!0,padding:2,rowSpacing:2,columnSpacing:2.5,children:[e.jsx(m,{size:{xs:12},children:e.jsx(y,{variant:"h6",color:d.palette.text.secondary,children:"Camaras"})}),o.camera.map((i,x)=>e.jsx(m,{size:{xs:12,sm:6,md:4},children:e.jsxs(_,{direction:"row",alignItems:"center",justifyContent:"space-between",children:[e.jsxs(_,{direction:"row",spacing:2,alignItems:"center",children:[e.jsx(at,{isSelected:!1}),e.jsxs(_,{children:[e.jsx(y,{variant:"h6",children:E(i.descripcion,15,!0)}),e.jsx(y,{variant:"caption",color:d.palette.text.secondary,children:E(i.tipo,15,!0)})]})]}),e.jsx(je,{conectado:i.conectado})]})},x)),e.jsx(m,{size:{xs:12},children:e.jsx(Pe,{})}),e.jsx(m,{size:{xs:12},children:e.jsx(y,{variant:"h6",color:d.palette.text.secondary,children:"Controladores"})}),o.controller.map((i,x)=>e.jsx(m,{size:{xs:12,sm:6,md:4},children:e.jsxs(_,{direction:"row",alignItems:"center",justifyContent:"space-between",children:[e.jsxs(_,{direction:"row",spacing:2,alignItems:"center",children:[e.jsx(yt,{fontSize:"large"}),e.jsxs(_,{children:[e.jsx(y,{variant:"h6",children:E(i.nodo,15,!0)}),e.jsx(y,{variant:"caption",color:d.palette.text.secondary,children:E(i.descripcion,15,!0)})]})]}),e.jsx(je,{conectado:i.conectado})]})},x))]})})})})})]})},je=({conectado:t})=>t==0?e.jsx(C,{sx:{width:30,height:30,backgroundColor:"#f74c48",borderRadius:"50%"}}):t==1?e.jsx(C,{sx:{width:30,height:30,backgroundColor:"#04c584",borderRadius:"50%"}}):e.jsx(C,{sx:{width:30,height:30,backgroundColor:"#bfbfbf",borderRadius:"50%"}}),Ot=k(m)(({theme:t})=>({[t.breakpoints.down("sm")]:{padding:"16px"},[t.breakpoints.up("sm")]:{padding:"24px"}}));function ps(){return e.jsx(e.Fragment,{children:e.jsx(C,{sx:{width:"100%",height:"100%"},children:e.jsx(we,{sx:{maxWidth:"100%",maxHeight:"100%"},children:e.jsxs(Ot,{container:!0,rowSpacing:4.5,columnSpacing:2.75,children:[e.jsx(m,{size:{xs:12},sx:{mb:-2.25},children:e.jsx(y,{variant:"h5",children:"Dashboard"})}),e.jsx(es,{}),e.jsx(m,{size:{xs:12},children:e.jsx(Pe,{})}),e.jsx(m,{size:{xs:12,sm:6,md:4},children:e.jsx($t,{})}),e.jsx(m,{size:{xs:12,sm:6,md:4},children:e.jsx(Vt,{})}),e.jsx(m,{size:{xs:12,sm:12,md:4},children:e.jsx(Kt,{})}),e.jsx(m,{size:{xs:12,md:6},children:e.jsx(At,{})}),e.jsx(m,{size:{xs:12,md:6},children:e.jsx(Et,{})}),e.jsx(m,{size:{xs:12,md:6},children:e.jsx(Ft,{})}),e.jsx(m,{size:{xs:12,md:6},children:e.jsx(Ht,{})}),e.jsx(m,{size:{xs:12,md:6},children:e.jsx(Xt,{})}),e.jsx(m,{size:{xs:12,md:6},children:e.jsx(Zt,{})})]})})})})}const es=()=>{const{isSuccess:t,data:a}=ot(),{filters:{ctrl_id:c,date:l,is_monthly:r}}=Y(d=>d.dashboardSlice),n=W(),o=d=>{n(ue(d.target.value));const i=d.target.value;if(i!==""&&t&&a){const x=a.find(p=>String(p.ctrl_id)===i);x&&n(ge(x.region))}},g=d=>{n(it(d.target.checked))};return f.useEffect(()=>{if(t){const d=a[0];d&&c===""&&(n(ue(String(d.ctrl_id))),n(ge(d.region)))}},[t,a]),f.useEffect(()=>{n(fe(P().format("YYYY-MM")))},[]),e.jsx(e.Fragment,{children:e.jsxs(m,{container:!0,size:{xs:12},rowSpacing:4.5,columnSpacing:2.75,children:[e.jsx(m,{size:{xs:12,sm:6,md:4,lg:3},children:e.jsxs(_,{spacing:1,children:[e.jsx(de,{htmlFor:"nodo-select",children:"Nodo"}),e.jsx(ye,{value:c,placeholder:"select-nodo",onChange:o,inputProps:{id:"nodo-select"},children:t&&a.map(d=>{const{ctrl_id:i,nodo:x}=d;return e.jsx(Se,{value:i,children:x},i)})})]})}),e.jsx(m,{size:{xs:12,sm:6,md:4,lg:3},children:e.jsxs(_,{spacing:1,children:[e.jsx(de,{htmlFor:"date-select-dashboard",children:"Fecha"}),e.jsx(bt,{views:["month","year"],ampm:!1,format:"YYYY/MM",value:l?P(l,"YYYY-MM"):P(),onChange:d=>{d&&n(fe(d.format("YYYY-MM")))},slotProps:{textField:{size:"medium",id:"date-select-dashboard"}}})]})}),e.jsx(m,{size:{xs:6,sm:6,md:4,lg:3},children:e.jsxs(_,{spacing:1,sx:{height:"100%"},children:[e.jsx(de,{htmlFor:"anual-mensual-switch",children:"Mensual"}),e.jsx(C,{sx:{flex:1,display:"flex",alignItems:"center"},children:e.jsx(ht,{size:"medium",checked:r,onChange:g,sx:{margin:0,width:60,height:28,"& .MuiSwitch-switchBase":{"&.Mui-checked":{transform:"translateX(32px)"}},"& .MuiSwitch-thumb":{width:22,height:22},"& .MuiSwitch-track":{borderRadius:24}},inputProps:{"aria-label":"controlled",id:"anual-mensual-switch"}})})]})})]})})};export{ps as default};
