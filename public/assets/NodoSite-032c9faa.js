import{a as Se,g as _e,s as M,r as u,b as we,j as e,e as re,f as ye,n as $,aU as nt,c as V,aV as ne,aW as Te,u as ot,aX as C,aY as it,l as oe,aZ as ke,aC as ie,B as j,Y as P,Z as k,H as T,h as O,q as z,ah as X,ai as te,ax as at,am as De,an as Z,I as L,a_ as J,a$ as Me,aQ as Pe,W as Re,X as Ie,b0 as B,b1 as A,b2 as lt,b3 as ct,A as y,S as dt,N as W,G as b,D as ae,b4 as ut,b5 as Le,p as mt,v as pt,w as ht,x as xt,z as gt,C as ft,b6 as bt,b7 as ge,b8 as jt,b9 as fe,ba as Ct,bb as vt}from"./index-2aa97167.js";import{C as K}from"./CardHeader-8cdd451d.js";import{D as St}from"./Divider-4f56bf6e.js";import{A as F}from"./Alert-bc05309a.js";import{g as _t,a as wt,P as yt,u as ee,b as le,c as Tt,d as U,f as be,e as kt,h as Dt,r as $e,C as Mt,i as Fe,j as Ae,k as Pt,s as Ee,v as Oe,l as a,m as ze,n as Rt,o as It,D as Lt}from"./useMobilePicker-d1309472.js";import{P as $t,a as N,r as Ft,b as je,c as At,d as se}from"./date-time-utils-4bf49c2d.js";import{T as Ye,D as Ve,S as Et}from"./StreamPlayer-b13c8854.js";import{T as He,t as Ue}from"./Tooltip-8c9f6e8a.js";import{d as Ot,a as zt}from"./LastPage-547da72b.js";import{d as Yt,a as Vt,g as Ne}from"./getFormattedDateTime-9ada5b77.js";import{S as ce}from"./Select-58060dc8.js";import{M as E}from"./MenuItem-40bd3874.js";import{S as Be}from"./ServerError-6c990cf9.js";import{d as Ht,a as Ut,S as Nt}from"./SensorsOffRounded-e4f5e3d7.js";import{b as qe,a as Ge,f as We,c as de,d as Y,T as v,e as ue}from"./PaperTable-3dd23fb2.js";import{d as Bt}from"./DownloadRounded-ec5febc1.js";import{_ as qt}from"./react-apexcharts.min-f06a0931.js";import{D as Gt,a as Wt}from"./DialogContent-ccb06683.js";import{D as Qt}from"./DialogTitle-b5d13699.js";import{S as Xt}from"./Send-4caaba8a.js";import{B as Ce}from"./Button-6990c5cc.js";import{L as Zt}from"./LimitedTextDisplay-82809f87.js";import{M as Kt}from"./Link-7b2f0098.js";import{F as Jt}from"./FormControl-c7d26469.js";import"./InputAdornment-065a5d02.js";import"./Popover-06eef5be.js";import"./InputLabel-8c6a21f8.js";import"./TextField-b6c81c1a.js";import"./Chip-55d32625.js";function es(t){return Se("MuiCardActions",t)}_e("MuiCardActions",["root","spacing"]);const ts=t=>{const{classes:s,disableSpacing:o}=t;return ye({root:["root",!o&&"spacing"]},es,s)},ss=M("div",{name:"MuiCardActions",slot:"Root",overridesResolver:(t,s)=>{const{ownerState:o}=t;return[s.root,!o.disableSpacing&&s.spacing]}})({display:"flex",alignItems:"center",padding:8,variants:[{props:{disableSpacing:!1},style:{"& > :not(style) ~ :not(style)":{marginLeft:8}}}]}),rs=u.forwardRef(function(s,o){const r=we({props:s,name:"MuiCardActions"}),{disableSpacing:i=!1,className:n,...c}=r,m={...r,disableSpacing:i},d=ts(m);return e.jsx(ss,{className:re(d.root,n),ownerState:m,ref:o,...c})}),Qe=rs;function ns(t){return Se("MuiDialogContentText",t)}_e("MuiDialogContentText",["root"]);const os=t=>{const{classes:s}=t,r=ye({root:["root"]},ns,s);return{...s,...r}},is=M($,{shouldForwardProp:t=>nt(t)||t==="classes",name:"MuiDialogContentText",slot:"Root",overridesResolver:(t,s)=>s.root})({}),as=u.forwardRef(function(s,o){const r=we({props:s,name:"MuiDialogContentText"}),{children:i,className:n,...c}=r,m=os(c);return e.jsx(is,{component:"p",variant:"body1",color:"textSecondary",ref:o,ownerState:c,className:re(m.root,n),...r,classes:m})}),ls=as,cs=V([e.jsx("circle",{cx:"12",cy:"12",r:"3.2"},"0"),e.jsx("path",{d:"M9 2 7.17 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2h-3.17L15 2zm3 15c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5"},"1")],"CameraAlt"),ds=V(e.jsx("path",{d:"M16.59 9H15V4c0-.55-.45-1-1-1h-4c-.55 0-1 .45-1 1v5H7.41c-.89 0-1.34 1.08-.71 1.71l4.59 4.59c.39.39 1.02.39 1.41 0l4.59-4.59c.63-.63.19-1.71-.7-1.71M5 19c0 .55.45 1 1 1h12c.55 0 1-.45 1-1s-.45-1-1-1H6c-.55 0-1 .45-1 1"}),"DownloadRounded"),us=V(e.jsx("path",{d:"m15.96 10.29-2.75 3.54-1.96-2.36L8.5 15h11zM3 5H1v16c0 1.1.9 2 2 2h16v-2H3zm18-4H7c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V3c0-1.1-.9-2-2-2m0 16H7V3h14z"}),"Filter"),ms=V(e.jsx("path",{d:"M23 8c0 1.1-.9 2-2 2-.18 0-.35-.02-.51-.07l-3.56 3.55c.05.16.07.34.07.52 0 1.1-.9 2-2 2s-2-.9-2-2c0-.18.02-.36.07-.52l-2.55-2.55c-.16.05-.34.07-.52.07s-.36-.02-.52-.07l-4.55 4.56c.05.16.07.33.07.51 0 1.1-.9 2-2 2s-2-.9-2-2 .9-2 2-2c.18 0 .35.02.51.07l4.56-4.55C8.02 9.36 8 9.18 8 9c0-1.1.9-2 2-2s2 .9 2 2c0 .18-.02.36-.07.52l2.55 2.55c.16-.05.34-.07.52-.07s.36.02.52.07l3.55-3.56C19.02 8.35 19 8.18 19 8c0-1.1.9-2 2-2s2 .9 2 2"}),"Timeline"),ps=V(e.jsx("path",{d:"M4 6H2v14c0 1.1.9 2 2 2h14v-2H4zm16-4H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2m-8 12.5v-9l6 4.5z"}),"VideoLibrary"),hs=V(e.jsx("path",{d:"M17 10.5V7c0-.55-.45-1-1-1H4c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.55 0 1-.45 1-1v-3.5l4 4v-11z"}),"Videocam");function xs(t){return wt("MuiTimePickerToolbar",t)}const q=_t("MuiTimePickerToolbar",["root","separator","hourMinuteLabel","hourMinuteLabelLandscape","hourMinuteLabelReverse","ampmSelection","ampmLandscape","ampmLabel"]),gs=["ampm","ampmInClock","value","isLandscape","onChange","view","onViewChange","views","disabled","readOnly","className"],fs=t=>{const{isLandscape:s,classes:o,isRtl:r}=t;return kt({root:["root"],separator:["separator"],hourMinuteLabel:["hourMinuteLabel",s&&"hourMinuteLabelLandscape",r&&"hourMinuteLabelReverse"],ampmSelection:["ampmSelection",s&&"ampmLandscape"],ampmLabel:["ampmLabel"]},xs,o)},bs=M(yt,{name:"MuiTimePickerToolbar",slot:"Root",overridesResolver:(t,s)=>s.root})({}),js=M($t,{name:"MuiTimePickerToolbar",slot:"Separator",overridesResolver:(t,s)=>s.separator})({outline:0,margin:"0 4px 0 2px",cursor:"default"}),Cs=M("div",{name:"MuiTimePickerToolbar",slot:"HourMinuteLabel",overridesResolver:(t,s)=>[{[`&.${q.hourMinuteLabelLandscape}`]:s.hourMinuteLabelLandscape,[`&.${q.hourMinuteLabelReverse}`]:s.hourMinuteLabelReverse},s.hourMinuteLabel]})({display:"flex",justifyContent:"flex-end",alignItems:"flex-end",variants:[{props:{isRtl:!0},style:{flexDirection:"row-reverse"}},{props:{isLandscape:!0},style:{marginTop:"auto"}}]}),vs=M("div",{name:"MuiTimePickerToolbar",slot:"AmPmSelection",overridesResolver:(t,s)=>[{[`.${q.ampmLabel}`]:s.ampmLabel},{[`&.${q.ampmLandscape}`]:s.ampmLandscape},s.ampmSelection]})({display:"flex",flexDirection:"column",marginRight:"auto",marginLeft:12,[`& .${q.ampmLabel}`]:{fontSize:17},variants:[{props:{isLandscape:!0},style:{margin:"4px 0 auto",flexDirection:"row",justifyContent:"space-around",flexBasis:"100%"}}]});function Ss(t){const s=ne({props:t,name:"MuiTimePickerToolbar"}),{ampm:o,ampmInClock:r,value:i,isLandscape:n,onChange:c,view:m,onViewChange:d,views:l,disabled:p,readOnly:h,className:g}=s,f=Te(s,gs),x=ee(),S=le(),_=ot(),D=!!(o&&!r&&l.includes("hours")),{meridiemMode:w,handleMeridiemChange:H}=Tt(i,o,c),Q=xe=>o?x.format(xe,"hours12h"):x.format(xe,"hours24h"),I=C({},s,{isRtl:_}),R=fs(I),he=e.jsx(js,{tabIndex:-1,value:":",variant:"h3",selected:!1,className:R.separator});return e.jsxs(bs,C({landscapeDirection:"row",toolbarTitle:S.timePickerToolbarTitle,isLandscape:n,ownerState:I,className:re(R.root,g)},f,{children:[e.jsxs(Cs,{className:R.hourMinuteLabel,ownerState:I,children:[U(l,"hours")&&e.jsx(N,{tabIndex:-1,variant:"h3",onClick:()=>d("hours"),selected:m==="hours",value:i?Q(i):"--"}),U(l,["hours","minutes"])&&he,U(l,"minutes")&&e.jsx(N,{tabIndex:-1,variant:"h3",onClick:()=>d("minutes"),selected:m==="minutes",value:i?x.format(i,"minutes"):"--"}),U(l,["minutes","seconds"])&&he,U(l,"seconds")&&e.jsx(N,{variant:"h3",onClick:()=>d("seconds"),selected:m==="seconds",value:i?x.format(i,"seconds"):"--"})]}),D&&e.jsxs(vs,{className:R.ampmSelection,ownerState:I,children:[e.jsx(N,{disableRipple:!0,variant:"subtitle2",selected:w==="am",typographyClassName:R.ampmLabel,value:be(x,"am"),onClick:h?void 0:()=>H("am"),disabled:p}),e.jsx(N,{disableRipple:!0,variant:"subtitle2",selected:w==="pm",typographyClassName:R.ampmLabel,value:be(x,"pm"),onClick:h?void 0:()=>H("pm"),disabled:p})]})]}))}function Xe(t,s){var c;const o=ee(),r=ne({props:t,name:s}),i=r.ampm??o.is12HourCycleInCurrentLocale(),n=u.useMemo(()=>{var m;return((m=r.localeText)==null?void 0:m.toolbarTitle)==null?r.localeText:C({},r.localeText,{timePickerToolbarTitle:r.localeText.toolbarTitle})},[r.localeText]);return C({},r,{ampm:i,localeText:n},Dt({views:r.views,openTo:r.openTo,defaultViews:["hours","minutes"],defaultOpenTo:"hours"}),{disableFuture:r.disableFuture??!1,disablePast:r.disablePast??!1,slots:C({toolbar:Ss},r.slots),slotProps:C({},r.slotProps,{toolbar:C({ampm:i,ampmInClock:r.ampmInClock},(c=r.slotProps)==null?void 0:c.toolbar)})})}const Ze=u.forwardRef(function(s,o){var D,w,H,Q;const r=le(),i=ee(),n=Xe(s,"MuiDesktopTimePicker"),{shouldRenderTimeInASingleColumn:c,views:m,timeSteps:d}=Ft(n),l=c?At:je,p=C({hours:l,minutes:l,seconds:l,meridiem:l},n.viewRenderers),h=n.ampmInClock??!0,g=c?[]:["accept"],x=((D=p.hours)==null?void 0:D.name)===je.name?m:m.filter(I=>I!=="meridiem"),S=C({},n,{ampmInClock:h,timeSteps:d,viewRenderers:p,format:$e(i,n),views:c?["hours"]:x,slots:C({field:Ye,openPickerIcon:Mt},n.slots),slotProps:C({},n.slotProps,{field:I=>{var R;return C({},Fe((R=n.slotProps)==null?void 0:R.field,I),Ae(n),{ref:o})},toolbar:C({hidden:!0,ampmInClock:h},(w=n.slotProps)==null?void 0:w.toolbar),actionBar:C({actions:g},(H=n.slotProps)==null?void 0:H.actionBar)})}),{renderPicker:_}=Pt({props:S,valueManager:Ee,valueType:"time",getOpenDialogAriaText:((Q=S.localeText)==null?void 0:Q.openTimePickerDialogue)??r.openTimePickerDialogue,validator:Oe});return _()});Ze.propTypes={ampm:a.bool,ampmInClock:a.bool,autoFocus:a.bool,className:a.string,closeOnSelect:a.bool,defaultValue:a.object,disabled:a.bool,disableFuture:a.bool,disableIgnoringDatePartForTimeValidation:a.bool,disableOpenPicker:a.bool,disablePast:a.bool,enableAccessibleFieldDOMStructure:a.any,format:a.string,formatDensity:a.oneOf(["dense","spacious"]),inputRef:ze,label:a.node,localeText:a.object,maxTime:a.object,minTime:a.object,minutesStep:a.number,name:a.string,onAccept:a.func,onChange:a.func,onClose:a.func,onError:a.func,onOpen:a.func,onSelectedSectionsChange:a.func,onViewChange:a.func,open:a.bool,openTo:a.oneOf(["hours","meridiem","minutes","seconds"]),orientation:a.oneOf(["landscape","portrait"]),readOnly:a.bool,reduceAnimations:a.bool,referenceDate:a.object,selectedSections:a.oneOfType([a.oneOf(["all","day","empty","hours","meridiem","minutes","month","seconds","weekDay","year"]),a.number]),shouldDisableTime:a.func,skipDisabled:a.bool,slotProps:a.object,slots:a.object,sx:a.oneOfType([a.arrayOf(a.oneOfType([a.func,a.object,a.bool])),a.func,a.object]),thresholdToRenderTimeInASingleColumn:a.number,timeSteps:a.shape({hours:a.number,minutes:a.number,seconds:a.number}),timezone:a.string,value:a.object,view:a.oneOf(["hours","meridiem","minutes","seconds"]),viewRenderers:a.shape({hours:a.func,meridiem:a.func,minutes:a.func,seconds:a.func}),views:a.arrayOf(a.oneOf(["hours","minutes","seconds"]).isRequired)};const Ke=u.forwardRef(function(s,o){var p,h;const r=le(),i=ee(),n=Xe(s,"MuiMobileTimePicker"),c=C({hours:se,minutes:se,seconds:se},n.viewRenderers),m=n.ampmInClock??!1,d=C({},n,{ampmInClock:m,viewRenderers:c,format:$e(i,n),slots:C({field:Ye},n.slots),slotProps:C({},n.slotProps,{field:g=>{var f;return C({},Fe((f=n.slotProps)==null?void 0:f.field,g),Ae(n),{ref:o})},toolbar:C({hidden:!1,ampmInClock:m},(p=n.slotProps)==null?void 0:p.toolbar)})}),{renderPicker:l}=Rt({props:d,valueManager:Ee,valueType:"time",getOpenDialogAriaText:((h=d.localeText)==null?void 0:h.openTimePickerDialogue)??r.openTimePickerDialogue,validator:Oe});return l()});Ke.propTypes={ampm:a.bool,ampmInClock:a.bool,autoFocus:a.bool,className:a.string,closeOnSelect:a.bool,defaultValue:a.object,disabled:a.bool,disableFuture:a.bool,disableIgnoringDatePartForTimeValidation:a.bool,disableOpenPicker:a.bool,disablePast:a.bool,enableAccessibleFieldDOMStructure:a.any,format:a.string,formatDensity:a.oneOf(["dense","spacious"]),inputRef:ze,label:a.node,localeText:a.object,maxTime:a.object,minTime:a.object,minutesStep:a.number,name:a.string,onAccept:a.func,onChange:a.func,onClose:a.func,onError:a.func,onOpen:a.func,onSelectedSectionsChange:a.func,onViewChange:a.func,open:a.bool,openTo:a.oneOf(["hours","minutes","seconds"]),orientation:a.oneOf(["landscape","portrait"]),readOnly:a.bool,reduceAnimations:a.bool,referenceDate:a.object,selectedSections:a.oneOfType([a.oneOf(["all","day","empty","hours","meridiem","minutes","month","seconds","weekDay","year"]),a.number]),shouldDisableTime:a.func,slotProps:a.object,slots:a.object,sx:a.oneOfType([a.arrayOf(a.oneOfType([a.func,a.object,a.bool])),a.func,a.object]),timezone:a.string,value:a.object,view:a.oneOf(["hours","minutes","seconds"]),viewRenderers:a.shape({hours:a.func,minutes:a.func,seconds:a.func}),views:a.arrayOf(a.oneOf(["hours","minutes","seconds"]).isRequired)};const _s=["desktopModeMediaQuery"],ws=u.forwardRef(function(s,o){const r=ne({props:s,name:"MuiTimePicker"}),{desktopModeMediaQuery:i=It}=r,n=Te(r,_s);return it(i,{defaultMatches:!0})?e.jsx(Ze,C({ref:o},n)):e.jsx(Ke,C({ref:o},n))}),ve={p:.5,"& .MuiCardHeader-action":{m:"auto auto",display:"flex"}},G=u.forwardRef(({border:t=!0,boxShadow:s,children:o,content:r=!0,contentSX:i={},darkTitle:n,elevation:c,secondary:m,shadow:d,sx:l={},title:p,isDivider:h=!1,codeHighlight:g,cardActions:f,...x},S)=>{const _=oe();return s=_.palette.mode==="dark"?s||!0:s,e.jsxs(ke,{elevation:c||0,ref:S,...x,sx:{display:"flex",flexDirection:"column",height:"100%",width:"100%",border:t?"1px solid":"none",borderRadius:2,borderColor:_.palette.mode==="dark"?_.palette.divider:_.palette.grey.A800,boxShadow:s&&(!t||_.palette.mode==="dark")?d||_.shadows[10]:"inherit",":hover":{boxShadow:s?d||_.shadows[10]:"inherit"},"& pre":{m:0,p:"16px !important",fontFamily:_.typography.fontFamily,fontSize:"0.75rem"},...l},children:[m&&!p&&e.jsx(K,{sx:ve,action:m}),p&&e.jsx(K,{sx:ve,title:e.jsx($,{variant:"h5",children:p}),action:m}),h&&e.jsx(St,{}),r&&e.jsx(ie,{sx:{flex:1,padding:.5,...i,"&:last-child":{paddingBottom:.5}},children:e.jsx(j,{sx:{width:"100%",height:"100%",position:"relative"},children:e.jsx(j,{sx:{width:"100%",height:"100%",position:"absolute"},children:o})})}),f&&e.jsx(Qe,{disableSpacing:!0,sx:{padding:.5},children:f})]})}),ys=({ctrl_id:t})=>{const[s,o]=u.useState(null),r=u.useRef(null);return u.useEffect(()=>(r.current||(r.current=P(`${k}/last_snapshot/${t}`)),r.current.on("last_snapshot",i=>{o(i)}),()=>{r.current&&(r.current.disconnect(),r.current=null)}),[t]),e.jsx(e.Fragment,{children:e.jsxs(G,{title:"Ultima Foto",children:[s!==null&&e.jsx(j,{component:"img",sx:{height:"100%",width:"100%",overflow:"hidden",borderRadius:"4px"},src:s}),s===null&&e.jsx(j,{component:"div",sx:{width:"100%",height:"100%",display:"grid",placeItems:"center"},children:e.jsx(F,{severity:"info",variant:"outlined",children:"Caputura no disponible"})})]})})},Ts=({timePicked:t,datePicked:s,setDatePicked:o,setTimePicked:r})=>e.jsxs(T,{direction:"row",spacing:2,alignItems:"center",children:[e.jsx(Ve,{value:s,onChange:i=>o(i),slotProps:{textField:{size:"small",sx:{maxWidth:150,"& .MuiOutlinedInput-root":{"& fieldset":{}}}}}}),e.jsx(ws,{views:["hours"],ampm:!1,defaultValue:t,onChange:i=>r(i),slotProps:{textField:{size:"small",sx:{maxWidth:85,"& .MuiOutlinedInput-root":{"& fieldset":{}}}},digitalClockSectionItem:{}}})]}),ks=M(({className:t,...s})=>e.jsx(He,{...s,classes:{popper:t}}))(({theme:t})=>({[`& .${Ue.tooltip}`]:{backgroundColor:t.palette.common.white,color:"rgba(0, 0, 0, 0.87)",boxShadow:t.shadows[1],fontSize:11}})),Ds=({camaras:t,ctrl_id:s})=>{const o=O(d=>d.stream),r=O(d=>d.controllerSiteState),[i,n]=u.useState(null),c=z(),m=(d,l)=>{if(l!==null&&r.controller!==void 0){const p=t.find(h=>h.ip===l);n(l),p&&c(X({ctrl_id:s,cmr_id:p.cmr_id,tc_id:p.tc_id,descripcion:p.descripcion}))}};return u.useEffect(()=>{if(t.length>0&&r.controller!==void 0){const d=o.cmr_id;if(d!==null){const l=t.find(p=>p.cmr_id===d);l?(n(l.ip),c(X({ctrl_id:s,cmr_id:l.cmr_id,tc_id:l.tc_id,descripcion:l.descripcion})),c(te({isSelected:!0}))):(n(t[0].ip),c(X({ctrl_id:s,cmr_id:t[0].cmr_id,tc_id:t[0].tc_id,descripcion:t[0].descripcion})),c(te({isSelected:!0})))}else n(t[0].ip),c(X({ctrl_id:s,cmr_id:t[0].cmr_id,tc_id:t[0].tc_id,descripcion:t[0].descripcion})),c(te({isSelected:!0}))}},[t]),u.useEffect(()=>()=>{c(at())},[]),e.jsx(e.Fragment,{children:e.jsx(De,{color:"primary",value:i,exclusive:!0,onChange:m,"aria-label":"Cameras",size:"small",children:t.map((d,l)=>e.jsx(Z,{value:d.ip,"aria-label":"Camara 1",sx:{padding:0},children:e.jsx(ks,{title:d.descripcion,arrow:!0,children:e.jsxs(T,{direction:"row",spacing:1,alignItems:"center",padding:{lg:1,xs:.5},children:[e.jsx(cs,{}),e.jsxs("div",{children:["Cam ",l+1]})]})})},d.ip))})})},Ms=()=>{const t=O(s=>s.stream);return e.jsx(e.Fragment,{children:e.jsx(j,{sx:{width:"100%",height:"100%",position:"relative"},children:t.cmr_id!==null&&t.ctrl_id!==null&&e.jsx(e.Fragment,{children:e.jsx(Et,{ctrl_id:t.ctrl_id,cmr_id:t.cmr_id,q:"q1"},t.ctrl_id+t.cmr_id+"q1")})})})},Je=u.forwardRef(({title:t,count:s,onChangeIndex:o,current_index:r},i)=>{const[n,c]=u.useState(1),m=g=>{c(g.target.value)},d=()=>{o(0)},l=()=>{const g=r-n<0?0:r-n;o(g)},p=()=>{const g=r+n>s-1?s-1:r+n;o(g)},h=()=>{o(s-1)};return e.jsx(j,{component:"div",sx:{display:"flex",alignItems:"center",justifyContent:"flex-end",gap:1},ref:i,children:s>=0&&e.jsxs(e.Fragment,{children:[e.jsxs($,{component:"p",color:"white",sx:{userSelect:"none"},children:[t," :"]}),e.jsxs(ce,{id:"control-select",name:"control-select",value:n,onChange:m,size:"small",inputProps:{"aria-label":"Select RowsPerPage"},SelectDisplayProps:{style:{paddingTop:5,paddingBottom:5,borderColor:"white"}},sx:{color:"white","& .MuiOutlinedInput-notchedOutline":{borderColor:"white"},"& .MuiSvgIcon-root":{color:"white"}},children:[e.jsx(E,{value:1,children:1}),e.jsx(E,{value:10,children:10}),e.jsx(E,{value:20,children:20}),e.jsx(E,{value:50,children:50})]}),e.jsx($,{component:"div",color:"white",sx:{userSelect:"none"},children:`${r+1} de ${s}`}),e.jsxs(j,{sx:{flexShrink:0,ml:2.5},children:[e.jsx(L,{onClick:d,disabled:r===0,"aria-label":"first page",children:e.jsx(Ot,{})}),e.jsx(L,{onClick:l,disabled:r===0,"aria-label":"previous page",children:e.jsx(Yt,{})}),e.jsx(L,{onClick:p,disabled:r===s-1,"aria-label":"next page",children:e.jsx(Vt,{})}),e.jsx(L,{onClick:h,disabled:r===s-1,"aria-label":"last page",children:e.jsx(zt,{})})]})]})})}),Ps=async(t,s)=>{try{const r=await(await fetch(`${k}/api/v1/site/multimedia/download?filePath=${encodeURIComponent(t)}`,{credentials:"include"})).blob(),i=document.createElement("a");i.href=URL.createObjectURL(r),i.download=s,i.style.display="none",document.body.appendChild(i),i.click(),document.body.removeChild(i)}catch(o){console.error("Error downloading image:",o)}},Rs=({slides:t})=>{const[s,o]=u.useState([]),[r,i]=u.useState(0),n=()=>{if(s.length>0&&s[r]){const l=s[r],p=`downloaded-image-${l.fecha}.jpg`;Ps(l.ruta,p)}},c=z(),m=l=>{l.currentTarget===l.target&&c(J())},d=l=>{i(l)};return u.useEffect(()=>{o(t),i(0)},[t]),e.jsx(e.Fragment,{children:e.jsx(j,{sx:{width:"100%",height:"100%",position:"absolute"},children:e.jsxs(j,{sx:{position:"relative",height:"100%",width:"100%"},children:[e.jsx(j,{component:"div",sx:{position:"absolute",bottom:0,left:0,width:"100%",background:"rgba(0, 0, 0, 0.3)",py:1,"&: hover":{}},children:e.jsxs(T,{spacing:1,direction:"row",alignItems:"center",justifyContent:"center",sx:{position:"relative"},onDoubleClickCapture:m,children:[e.jsx(Je,{title:"N° Fotos",count:s.length,current_index:r,onChangeIndex:d}),e.jsx(L,{"aria-label":"back",sx:{position:"absolute",bottom:"cacl(50% - 23px)",left:10,cursor:"pointer"},onClick:n,children:e.jsx(ds,{sx:{color:"#FD8D14",fontSize:30}})})]})}),s.length>0&&s[r]&&e.jsx(j,{component:"img",sx:{height:"100%",overflow:"hidden",width:"100%",borderRadius:"4px",userSelect:"none"},src:`${k+"/"+s[r].ruta}`,onDoubleClickCapture:m})]})})})},Is="/assets/emptyData-e7a50cc8.svg",et=({children:t})=>e.jsxs(T,{spacing:1,alignItems:"center",children:[e.jsx("img",{src:Is,alt:"",width:100}),e.jsx($,{component:"p",variant:"body1",children:t&&t||"No data"})]}),Ls=({data:t})=>{const{cmr_id:s,ctrl_id:o,date:r,hour:i}=t,{isError:n,isSuccess:c,isLoading:m,data:d}=Me({ctrl_id:o,date:r,hour:i,tipo:0,cmr_id:s}),l=z(),p=h=>{h.currentTarget===h.target&&l(J())};return e.jsxs(j,{sx:{width:"100%",height:"100%",position:"relative",display:"flex",alignItems:"center",justifyContent:"center"},onDoubleClickCapture:p,children:[m&&e.jsx(Pe,{children:"Cargando Fotos"}),n&&e.jsx(Be,{children:"Error no se encontraron imagenes!"}),c&&d.length>0&&e.jsx(Rs,{slides:d}),c&&d.length==0&&e.jsx(et,{children:"No se encontraron fotos."})]})},$s=({slides:t})=>{const[s,o]=u.useState([]),[r,i]=u.useState(0),n=z(),c=p=>{p.currentTarget===p.target&&n(J())},m=p=>{i(p)},d=u.useRef(null),l=u.useMemo(()=>d.current?`calc( 50% - ${d.current.getBoundingClientRect().width*.5}px )`:0,[d.current]);return u.useEffect(()=>{o(t),i(0)},[t]),e.jsx(e.Fragment,{children:e.jsx(j,{sx:{width:"100%",height:"100%",position:"absolute"},children:e.jsxs(j,{sx:{position:"relative",height:"100%",width:"100%"},children:[s.length>0&&s[r]&&e.jsx(j,{component:"video",sx:{height:"100%",overflow:"hidden",width:"100%",borderRadius:"4px"},controls:!0,src:`${k+"/"+s[r].ruta}`,onDoubleClickCapture:c,onClick:p=>{p.preventDefault(),p.detail==2&&p.stopPropagation()}}),e.jsx(j,{component:"div",sx:{position:"absolute",bottom:"7%",left:l},children:e.jsx(Je,{ref:d,title:"N° Videos",count:s.length,current_index:r,onChangeIndex:m})})]})})})},Fs=({data:t})=>{const{cmr_id:s,ctrl_id:o,date:r,hour:i}=t,{isError:n,isSuccess:c,isLoading:m,data:d}=Me({ctrl_id:o,date:r,hour:i,tipo:1,cmr_id:s}),l=z(),p=h=>{h.currentTarget===h.target&&l(J())};return e.jsxs(j,{sx:{width:"100%",height:"100%",position:"relative",display:"flex",alignItems:"center",justifyContent:"center"},onDoubleClickCapture:p,children:[m&&e.jsx(Pe,{children:"Cargando videos"}),n&&e.jsx(Be,{children:"Error no se encontraron videos!"}),c&&d.length>0&&e.jsx($s,{slides:d}),c&&d.length==0&&e.jsx(et,{children:"No se encontraron videos."})]})},As=({option:t,handleChangeOption:s})=>e.jsxs(De,{color:"primary",value:t,exclusive:!0,onChange:s,"aria-label":"Options",size:"small",children:[e.jsx(Z,{value:"vivo","aria-label":"Vivo",children:e.jsxs(T,{direction:"row",alignItems:"center",spacing:1,children:[e.jsx(hs,{}),e.jsx("span",{children:" Vivo"})]})}),e.jsx(Z,{value:"video","aria-label":"Video",children:e.jsxs(T,{direction:"row",alignItems:"center",spacing:1,children:[e.jsx(ps,{}),e.jsx("span",{children:" Video"})]})}),e.jsx(Z,{value:"fotos","aria-label":"Fotos",children:e.jsxs(T,{direction:"row",alignItems:"center",spacing:1,children:[e.jsx(us,{}),e.jsx("span",{children:" Fotos"})]})})]});var me={},Es=Ie;Object.defineProperty(me,"__esModule",{value:!0});var tt=me.default=void 0,Os=Es(Re()),zs=e;tt=me.default=(0,Os.default)((0,zs.jsx)("path",{d:"M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2m-6 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2M9 8V6c0-1.66 1.34-3 3-3s3 1.34 3 3v2z"}),"LockRounded");var pe={},Ys=Ie;Object.defineProperty(pe,"__esModule",{value:!0});var st=pe.default=void 0,Vs=Ys(Re()),Hs=e;st=pe.default=(0,Vs.default)((0,Hs.jsx)("path",{d:"M12 13c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2m6-5h-1V6c0-2.76-2.24-5-5-5-2.28 0-4.27 1.54-4.84 3.75-.14.54.18 1.08.72 1.22.53.14 1.08-.18 1.22-.72C9.44 3.93 10.63 3 12 3c1.65 0 3 1.35 3 3v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2m0 11c0 .55-.45 1-1 1H7c-.55 0-1-.45-1-1v-8c0-.55.45-1 1-1h10c.55 0 1 .45 1 1z"}),"LockOpenRounded");const Us=t=>{const[s,o]=u.useState(null),[r,i]=u.useState(null),[n,c]=u.useState(null),m=u.useRef(null),[d,l]=u.useState(!1),[p,h]=u.useState(null),[g,f]=u.useState(void 0);return u.useEffect(()=>(t!==void 0&&(m.current||(m.current=P(`${k}/controller_state/${t}`)),m.current.on("controller_info",x=>{const{modo:S,seguridad:_,conectado:D,disableSecurityButton:w}=x;i(S),o(_),c(D),f(w)}),m.current.on("update_controller",x=>{const{conectado:S,modo:_,seguridad:D}=x;c(w=>S!==w?S:w),i(w=>_!==w?_:w),o(w=>D!==w?D:w)}),m.current.on("update_security_button",x=>{f(S=>S!==x?x:S)}),m.current.on("connect_error",x=>{l(!0),h(x.message)})),()=>{m.current&&(m.current.disconnect(),m.current=null),o(null),i(null),l(!1),h(null),c(null)}),[t]),{isError:d,error:p,socket:m,mode:r,security:s,connected:n,disableSecurity:g}},Ns=M(({className:t,...s})=>e.jsx(He,{...s,classes:{popper:t}}))(({theme:t})=>({[`& .${Ue.tooltip}`]:{backgroundColor:t.palette.common.white,color:"rgba(0, 0, 0, 0.87)",boxShadow:t.shadows[3],fontSize:11}})),Bs=({ctrl_id:t})=>{const{mode:s,security:o,socket:r,disableSecurity:i}=Us(t),n=()=>{r.current&&(o===A.Armado?r.current.emit("setSecurity",A.Desarmado):r.current.emit("setSecurity",A.Armado))};return e.jsx(e.Fragment,{children:s===B.Seguridad&&e.jsx(Ns,{title:o===A.Armado?"Armado":"Desarmado",placement:"left",children:e.jsx(L,{onClick:n,disabled:i===void 0?!0:i,children:o===A.Armado?e.jsx(tt,{}):e.jsx(st,{})})})})},qs=()=>{const t=O(s=>s.controllerSiteState);return e.jsx(e.Fragment,{children:e.jsx(T,{direction:"row",spacing:1,alignItems:"center",children:t.controller!==void 0&&(t.controller.conectado===lt.Conectado?e.jsxs(e.Fragment,{children:[e.jsx(Ht,{color:"success",fontSize:"large"}),e.jsx($,{children:"Conectado"})]}):e.jsxs(e.Fragment,{children:[e.jsx(Ut,{color:"error",fontSize:"large"}),e.jsx($,{children:"Desconectado"})]}))})})},Gs=({ctrl_id:t})=>{const s=O(f=>f.stream),{isError:o,isSuccess:r,data:i}=ct({ctrl_id:t},{refetchOnMountOrArgChange:!0}),[n,c]=u.useState("vivo"),m=(f,x)=>{x!==null&&c(x)},[d,l]=u.useState(y()),[p,h]=u.useState(y()),g=u.useRef(null);return e.jsxs(dt,{children:[e.jsx(K,{ref:g,sx:{p:.5,"& .MuiCardHeader-action":{m:"auto auto",display:"flex"},overflow:"auto",margin:0},title:e.jsx(qs,{}),action:e.jsx("div",{style:{width:"100%",height:"100%"},children:e.jsxs(T,{direction:"row",spacing:2,alignItems:"center",children:[(n==="fotos"||n==="video")&&e.jsx(Ts,{timePicked:p,datePicked:d,setDatePicked:l,setTimePicked:h}),r&&i.length>0&&e.jsx(Ds,{camaras:i,ctrl_id:t}),o&&e.jsx(F,{variant:"filled",severity:"error",children:"Error al cargar camaras."})]})})}),e.jsxs(ie,{sx:{flex:1,padding:.5,"&:last-child":{paddingBottom:.5}},children:[n==="vivo"&&s.ctrl_id!==null&&s.cmr_id!==null&&r&&i.length>0&&e.jsx(Ms,{},s.ctrl_id+s.cmr_id),n==="fotos"&&s.ctrl_id!==null&&s.cmr_id!==null&&e.jsx(Ls,{data:{cmr_id:s.cmr_id,ctrl_id:s.ctrl_id,date:d.format("YYYY-MM-DD"),hour:Number(p.format("HH"))}},s.ctrl_id+s.cmr_id),n==="video"&&s.ctrl_id!==null&&s.cmr_id!==null&&e.jsx(Fs,{data:{cmr_id:s.cmr_id,ctrl_id:s.ctrl_id,date:d.format("YYYY-MM-DD"),hour:Number(p.format("HH"))}},s.ctrl_id+s.cmr_id)]}),e.jsx(Qe,{disableSpacing:!0,sx:{padding:.5},children:e.jsxs(T,{width:"100%",direction:"row",alignItems:"center",spacing:2,justifyContent:"space-between",children:[e.jsx(As,{option:n,handleChangeOption:m}),e.jsx(Bs,{ctrl_id:t})]})})]})},Ws=({ctrl_id:t})=>{const[s,o]=u.useState([]),r=u.useRef(null),i=oe(),[n,c]=u.useState(B.Seguridad),[m,d]=u.useState(A.Desarmado);return u.useEffect(()=>(r.current||(r.current=P(`${k}/pin_entrada/${t}`)),r.current.on("list_pines_entrada",l=>{o(l)}),r.current.on("controller_mode",l=>{c(l)}),r.current.on("controller_security",l=>{d(l)}),r.current.on("item_pin_entrada",l=>{o(p=>{if(l.activo==1){const h=p.filter(g=>g.pe_id!=l.pe_id);return h.unshift(l),h}return p})}),()=>{r.current&&(r.current.disconnect(),r.current=null)}),[t]),e.jsx(e.Fragment,{children:e.jsxs(ke,{sx:{display:"flex",flexDirection:"column",height:"100%",width:"100%",border:n===B.Seguridad?"2px solid":"1px solid",borderRadius:2,backgroundImage:"inherit",borderColor:n===B.Seguridad?m===A.Armado?"green":"darkgray":i.palette.mode==="dark"?i.palette.divider:i.palette.grey.A800,boxShadow:"inherit",":hover":{boxShadow:"inherit"},"& pre":{m:0,p:"16px !important",fontFamily:i.typography.fontFamily,fontSize:"0.75rem"}},children:[e.jsx(K,{title:"Site",sx:{p:.5,"& .MuiCardHeader-action":{m:"auto auto",display:"flex"}}}),e.jsx(ie,{sx:{flex:1,padding:.5,"&:last-child":{paddingBottom:.5}},children:e.jsx(j,{sx:{width:"100%",height:"100%",position:"relative"},children:e.jsx(j,{sx:{width:"100%",height:"100%",position:"absolute"},children:e.jsx(W,{sx:{width:"100%",height:"100%","& .simplebar-content":{width:"100%",height:"100%",display:"grid",placeItems:"center"}},children:e.jsxs(b,{container:!0,rowSpacing:1,columnSpacing:2,width:"100%",children:[s.length===0&&e.jsx(b,{size:{xs:12},sx:{display:"grid",placeItems:"center"},children:e.jsx(F,{severity:"warning",variant:"outlined",children:"Asignar al menos un pin de entrada"})}),s.map((l,p,h)=>{const g=e.jsxs(T,{direction:"row",spacing:1,alignItems:"center",justifyContent:"space-between",children:[e.jsx("div",{children:ae(l.descripcion,20)}),e.jsx(Nt,{state:n===B.Seguridad?l.estado===1?"warning":"active":l.estado===1?"active":"disable"})]});return h.length==1?e.jsxs(u.Fragment,{children:[e.jsx(b,{size:{xs:3}}),e.jsx(b,{size:{xs:12},children:g}),e.jsx(b,{size:{xs:3}})]},t+l.pe_id):e.jsx(b,{size:{xs:12,lg:6},children:g},t+l.pe_id)})]})})})})})]})})},Qs=M(qe)(({theme:t})=>({border:"1px solid",borderRadius:2,borderColor:t.palette.mode==="dark"?t.palette.divider:t.palette.grey.A800,backgroundColor:t.palette.background.paper,boxShadow:" rgba(0, 0, 0, 0.2) 0px 2px 1px -1px, rgba(0, 0, 0, 0.14) 0px 1px 1px 0px, rgba(0, 0, 0, 0.12) 0px 1px 3px 0px",backgroundImage:t.palette.mode==="dark"?"linear-gradient(rgba(255, 255, 255, 0.05), rgba(255, 255, 255, 0.05))":"none"})),Xs=({ctrl_id:t})=>{const[s,o]=u.useState([]),r=u.useRef(null);return u.useEffect(()=>(r.current||(r.current=P(`${k}/modulo_energia/${t}`)),r.current.on("initial_list_energia",i=>{o(i)}),r.current.on("list_energia",(i,n)=>{n==="add"&&o(c=>c.some(d=>d.me_id===i.me_id)?c:[...c,i].sort((p,h)=>p.me_id-h.me_id)),n==="delete"&&o(c=>c.filter(d=>d.me_id!==i.me_id))}),()=>{r.current&&(r.current.disconnect(),r.current=null)}),[t]),e.jsx(e.Fragment,{children:e.jsxs(j,{component:"div",sx:{width:"100%",height:"100%",display:"grid",placeItems:"center"},children:[s.length===0&&e.jsx(F,{severity:"warning",variant:"outlined",children:"Asignar al menos un modulo de energia"}),s.length>0&&e.jsx(Ge,{component:We,variant:"outlined",sx:{height:"100%",width:"100%",overflowY:"auto"},children:e.jsx(W,{sx:{width:"100%",height:"100%","& .simplebar-content":{width:"100%",height:"100%",display:"grid",placeItems:"center"}},children:e.jsxs(Qs,{"aria-label":"customized table",stickyHeader:!0,size:"small",sx:{position:"relative"},children:[e.jsx(de,{children:e.jsxs(Y,{children:[e.jsx(v,{children:"N°"}),e.jsx(v,{children:"Amp (A)"}),e.jsx(v,{children:"Volt (V)"}),e.jsx(v,{children:"Pot (W)"}),e.jsx(v,{children:"kWh"})]})}),e.jsx(ue,{children:r.current!==null&&s.map((i,n)=>r.current!==null?e.jsx(Zs,{index:n,dataEnergia:i,socket:r.current},i.me_id):null)})]})})})]})})},Zs=({dataEnergia:t,index:s,socket:o})=>{const[r,i]=u.useState(t);return o.on("energia",n=>{n.me_id===t.me_id&&i(n)}),e.jsxs(Y,{children:[e.jsx(v,{component:"th",scope:"row",children:s+1}),e.jsx(v,{children:r.amperaje}),e.jsx(v,{children:r.voltaje}),e.jsx(v,{children:r.potenciaw}),e.jsx(v,{children:r.potenciakwh})]})},Ks=({date:t,registerData:s,info:o})=>{const[r,i]=u.useState({configs:{chart:{height:350,type:"line",zoom:{enabled:!1},background:"#121212",id:"temperature-graph-chart",toolbar:{show:!0,export:{png:{filename:`grafica_temperatura_${encodeURIComponent(o.nodo)}_${encodeURIComponent(o.st_id)}_${encodeURIComponent(o.ubicacion)}_${encodeURIComponent(y(t,"YYYY-MM-DD").unix())}`},svg:{filename:`grafica_temperatura_${encodeURIComponent(o.nodo)}_${encodeURIComponent(o.st_id)}_${encodeURIComponent(o.ubicacion)}_${encodeURIComponent(y(t,"YYYY-MM-DD").unix())}`}}}},dataLabels:{enabled:!1},stroke:{curve:"straight"},grid:{row:{colors:["#1e1e1e","transparent"],opacity:.5}},xaxis:{type:"datetime",tickAmount:24,min:new Date(y(t,"YYYY-MM-DD").startOf("day").toISOString()).getTime(),max:new Date(y(t,"YYYY-MM-DD").add(1,"day").startOf("day").toISOString()).getTime(),labels:{formatter:function(l,p){return y(p).format("HH:mm")},style:{colors:"#8c8c8c",cssClass:"apexcharts-xaxis-label"}},title:{text:"Tiempo ( h )",style:{color:"#8c8c8c"}},tooltip:{enabled:!1,formatter:(l,p)=>y(l).format("HH:mm:ss")}},yaxis:{min:0,decimalsInFloat:2,title:{text:"Temperatura ( °C )",style:{color:"#8c8c8c"}},labels:{style:{colors:"#8c8c8c",cssClass:"apexcharts-yaxis-label"}}},tooltip:{enabled:!0,x:{show:!0,formatter(l,p){return y(l).format("HH:mm:ss")}},y:{}}}}),n=oe(),c=n.palette.mode,[m,d]=u.useState([]);return u.useEffect(()=>{i(l=>{const p=c=="dark"?n.palette.text.secondary:n.palette.text.primary;return{configs:{...l.configs,chart:{...l.configs.chart,background:n.palette.background.default},grid:{row:{colors:[n.palette.background.paper,"transparent"],opacity:.5}},xaxis:{...l.configs.xaxis,labels:{...l.configs.xaxis?l.configs.xaxis.labels:{},style:{...l.configs.xaxis&&l.configs.xaxis.labels?l.configs.xaxis.labels.style:{},colors:p,cssClass:"apexcharts-xaxis-label"}},title:{...l.configs.xaxis?l.configs.xaxis.title:{},style:{color:p}}},yaxis:{...l.configs.yaxis,title:{text:"Temperatura ( °C )",style:{color:p}},labels:{style:{colors:p,cssClass:"apexcharts-yaxis-label"}}}}}})},[c]),u.useEffect(()=>{d([{name:"temperatura",data:s}]),i(l=>({configs:{...l.configs,xaxis:{...l.configs.xaxis,min:new Date(y(t,"YYYY-MM-DD").startOf("day").toISOString()).getTime(),max:new Date(y(t,"YYYY-MM-DD").add(1,"day").startOf("day").toISOString()).getTime()}}}))},[s]),u.useEffect(()=>{i(l=>({configs:{...l.configs,chart:{...l.configs.chart,toolbar:{show:!1,export:{png:{filename:`grafica_temperatura_${encodeURIComponent(o.nodo)}_${encodeURIComponent(o.st_id)}_${encodeURIComponent(o.ubicacion)}_${encodeURIComponent(y(t,"YYYY-MM-DD").unix())}`},svg:{filename:`grafica_temperatura_${encodeURIComponent(o.nodo)}_${encodeURIComponent(o.st_id)}_${encodeURIComponent(o.ubicacion)}_${encodeURIComponent(y(t,"YYYY-MM-DD").unix())}`}}}}}}))},[o,t]),e.jsx(e.Fragment,{children:e.jsx(qt,{options:r.configs,series:m,type:"line",width:"100%",height:500})})};function Js(t,s){const o=ApexCharts.getChartByID(t);o&&(s==="png"?o.exports.exportToPng():s==="svg"&&o.exports.exportToSVG())}const er=({open:t,setOpen:s,data:o})=>{const[r,i]=u.useState(y()),{nodo:n,ctrl_id:c,st_id:m,serie:d,ubicacion:l}=o,p=()=>{s(!1)},h=u.useRef(null);u.useEffect(()=>(t?h.current||(h.current=P(`${k}/sensor_temperatura/${c}/${m}`)):h.current&&(h.current.disconnect(),h.current=null),()=>{h.current&&(h.current.disconnect(),h.current=null)}),[t,o]);const[g,{data:f,isSuccess:x}]=ut(),S=()=>{g({ctrl_id:c,st_id:m,date:r.format("YYYY-MM-DD")})};return e.jsx(e.Fragment,{children:e.jsxs(Gt,{fullWidth:!0,maxWidth:"lg",open:t,onClose:p,sx:{"& .MuiDialog-paper":{backgroundColor:"background.paper",backgroundImage:"inherit"}},children:[e.jsx(Qt,{children:e.jsx($,{component:"div",variant:"h5",children:"Gráfica Temperatura"})}),e.jsxs(Wt,{children:[e.jsxs(ls,{children:["Nodo: ",n," , Ubicacion: ",l," , Serie: ",d]}),e.jsxs(T,{direction:"row",justifyContent:"end",alignItems:"center",spacing:2,marginBottom:2,children:[e.jsx(Ve,{value:r,onChange:_=>{i(_)},slotProps:{textField:{size:"small",sx:{maxWidth:150}}}}),e.jsx(L,{"aria-label":"get register",onClick:S,color:"primary",children:e.jsx(Xt,{})})]}),e.jsx(Ks,{date:r.format("YYYY-MM-DD"),registerData:x&&f?f:[],info:o})]}),e.jsxs(Lt,{children:[e.jsx(Ce,{variant:"contained",onClick:()=>{Js("temperature-graph-chart","png")},startIcon:e.jsx(Bt,{}),children:"Descargar"}),e.jsx(Ce,{variant:"contained",color:"error",onClick:p,children:"Cerrar"})]})]})})},tr=({ctrl_id:t})=>e.jsx(e.Fragment,{children:e.jsx(j,{sx:{width:"100%",height:"100%"},children:e.jsx(W,{sx:{width:"100%",height:"100%","& .simplebar-content":{width:"100%",height:"100%",display:"grid",placeItems:"center"}},children:e.jsx(sr,{ctrl_id:Number(t)})})})}),sr=({ctrl_id:t})=>{const{xregion:s,xnodo:o}=Le(),[r,i]=u.useState([]),n=u.useRef(null),[c,m]=u.useState(!1),[d,l]=u.useState(null),p=h=>{l(h),m(!0)};return u.useEffect(()=>(n.current||(n.current=P(`${k}/sensor_temperatura/${t}`)),n.current.on("initial_list_temperature",h=>{i(h)}),n.current.on("list_temperature",(h,g)=>{g==="add"&&i(f=>f.some(S=>S.st_id===h.st_id)?f:[...f,h].sort((D,w)=>D.st_id-w.st_id)),g==="delete"&&i(f=>f.filter(S=>S.st_id!==h.st_id))}),()=>{n.current&&(n.current.disconnect(),n.current=null)}),[t]),e.jsxs(e.Fragment,{children:[e.jsxs(b,{container:!0,rowSpacing:1,columnSpacing:2,sx:{width:"100%"},children:[r.length===0&&e.jsx(b,{size:{xs:12},sx:{display:"grid",placeItems:"center"},children:e.jsx(F,{severity:"warning",variant:"outlined",children:"Asignar al menos un sensor de temperatura"})}),n.current!==null&&r.map((h,g,f)=>{if(n.current===null)return null;const x=e.jsxs(T,{direction:"row",spacing:1,alignItems:"center",justifyContent:"space-between",children:[e.jsx(rr,{dataViewer:h,socket:n.current}),e.jsx(L,{size:"small","aria-label":"Temperature Graph",color:"primary",onClick:()=>p({...h,nodo:o,region:s,ctrl_id:t}),children:e.jsx(ms,{fontSize:"small"})})]});return f.length===1?e.jsxs(b,{container:!0,sx:{width:"100%"},children:[e.jsx(b,{size:{xs:3}}),e.jsx(b,{size:{xs:6},children:x}),e.jsx(b,{size:{xs:3}})]},t+h.st_id):e.jsx(b,{size:{xs:12,lg:6},children:x},t+h.st_id)})]}),d&&c&&e.jsx(er,{open:c,setOpen:m,data:d})]})},rr=({dataViewer:t,socket:s})=>{const[o,r]=u.useState(t);return s.on("temperature",i=>{t.st_id===i.st_id&&r(i)}),e.jsx(e.Fragment,{children:e.jsxs(T,{direction:"row",spacing:1,alignItems:"center",justifyContent:"space-between",sx:{flex:1},children:[e.jsx("span",{children:`${ae(o.ubicacion,15)}:`}),e.jsxs(j,{children:[o.actual,"°C"]})]})})},nr=({ctrl_id:t,region:s})=>{const o=mt(),r=z(),[i,n]=u.useState("accesos"),c=m=>{n(m.target.value)};return e.jsx(G,{title:e.jsxs(ce,{size:"small",value:i,onChange:c,placeholder:"select-tipo-prioridad",inputProps:{id:"select-prioridad"},children:[e.jsx(E,{value:"accesos",children:"Accesos"}),e.jsx(E,{value:"alarmas",children:"Alarmas"})]}),secondary:e.jsx(Kt,{component:"button",underline:"none",onClick:()=>{r(pt(s)),r(ht(t)),r(xt(i=="accesos"?"acceso":"entrada")),r(gt(y().startOf("day").format("YYYY-MM-DD HH:mm:ss"))),r(ft(y().endOf("day").format("YYYY-MM-DD HH:mm:ss"))),o("/logs")},children:"Ver Mas"}),children:e.jsx(Ge,{component:We,variant:"outlined",sx:{height:"100%",width:"100%",overflowY:"auto"},children:e.jsxs(W,{sx:{width:"100%",height:"100%","& .simplebar-content":{width:"100%",height:"100%",display:"grid",placeItems:"center"}},children:[i=="accesos"&&e.jsx(or,{ctrl_id:t}),i=="alarmas"&&e.jsx(ir,{ctrl_id:t})]})})})},rt=M(qe)(({theme:t})=>({border:"1px solid",borderRadius:2,borderColor:t.palette.mode==="dark"?t.palette.divider:t.palette.grey.A800,backgroundColor:t.palette.background.paper,boxShadow:" rgba(0, 0, 0, 0.2) 0px 2px 1px -1px, rgba(0, 0, 0, 0.14) 0px 1px 1px 0px, rgba(0, 0, 0, 0.12) 0px 1px 3px 0px",backgroundImage:t.palette.mode==="dark"?"linear-gradient(rgba(255, 255, 255, 0.05), rgba(255, 255, 255, 0.05))":"none"})),or=({ctrl_id:t})=>{const[s,o]=u.useState([]),r=u.useRef(null);return u.useEffect(()=>(r.current||(r.current=P(`${k}/registro_acceso/${t}`)),r.current.on("list_registros_acceso",i=>{o(i)}),r.current.on("new_registro_acceso",i=>{o(n=>{const c=[i,...n];return c.length>5&&c.splice(5),c})}),()=>{r.current&&(r.current.disconnect(),r.current=null)}),[t]),e.jsxs(e.Fragment,{children:[s.length===0&&e.jsx(F,{severity:"info",variant:"outlined",children:"Sin registros de acceso."}),s.length>0&&e.jsxs(rt,{size:"small","aria-label":"a dense table",stickyHeader:!0,sx:{position:"relative"},children:[e.jsx(de,{children:e.jsxs(Y,{children:[e.jsx(v,{children:"Personal"}),e.jsx(v,{children:"Autorización"}),e.jsx(v,{children:"Fecha"})]})}),e.jsx(ue,{children:s.map((i,n)=>{const{autorizacion:c,fecha:m,personal:d,administrador:l}=i,p=Ne(m);return e.jsxs(Y,{children:[e.jsx(v,{children:e.jsx(Zt,{text:d!==void 0?`${d.nombre+" "+d.apellido}`:"no-identificado",maxLength:15,insertDots:!0})}),e.jsxs(v,{children:[c===1&&l===0&&"Autorizado",c===1&&l===1&&"Administrador",c===0&&"Denegado"]}),e.jsx(v,{children:p})]},n)})})]})]})},ir=({ctrl_id:t})=>{const[s,o]=u.useState([]),r=u.useRef(null);return u.useEffect(()=>(r.current||(r.current=P(`${k}/registro_entrada/${t}`)),r.current.on("list_registros_entrada",i=>{o(i)}),r.current.on("new_registro_entrada",i=>{o(n=>{const c=[i,...n];return c.length>5&&c.splice(5),c})}),()=>{r.current&&(r.current.disconnect(),r.current=null)}),[t]),e.jsxs(e.Fragment,{children:[s.length===0&&e.jsx(F,{severity:"info",variant:"outlined",children:"Sin registros de alarma."}),s.length>0&&e.jsxs(rt,{size:"small","aria-label":"a dense table",stickyHeader:!0,sx:{position:"relative"},children:[e.jsx(de,{children:e.jsxs(Y,{children:[e.jsx(v,{children:"Pin"}),e.jsx(v,{children:"Estado"}),e.jsx(v,{children:"Fecha"})]})}),e.jsx(ue,{children:s.map((i,n)=>{const{pin:c,estado:m,fecha:d}=i,l=Ne(d);return e.jsxs(Y,{children:[e.jsx(v,{children:c}),e.jsx(v,{children:m==0?"Desactivado":m==1?"Activado":m}),e.jsx(v,{children:l})]},n)})})]})]})};const ar=({ctrl_id:t})=>{const s=u.useRef(null),[o,r]=u.useState([]),[i,n]=u.useState(""),c=o.find(d=>String(d.es_id)===String(i)),m=d=>{n(d.target.value)};return u.useEffect(()=>{o.length>0&&i===""&&n(String(o[0].es_id)),o.find(l=>String(l.es_id)===i)===void 0&&(o.length>0?n(String(o[0].es_id)):n(""))},[o]),u.useEffect(()=>(s.current||(s.current=P(`${k}/pines_salida/${t}`)),s.current.on("equipos_salida",d=>{r(d)}),s.current.on("list_pines_salida",(d,l)=>{r(p=>p.find(({es_id:g})=>g===l.es_id)===void 0?[l,...p].sort((f,x)=>f.es_id-x.es_id):p)}),()=>{s.current&&(s.current.disconnect(),s.current=null)}),[t]),e.jsx(e.Fragment,{children:e.jsx(G,{title:"Control",secondary:e.jsx(Jt,{size:"small",sx:{maxWidth:200},children:o.length>0&&e.jsx(ce,{id:"control-select",name:"control-select",value:i,onChange:m,size:"small",inputProps:{"aria-label":"Select Control"},children:o.map(d=>e.jsx(E,{value:d.es_id,children:d.actuador},d.es_id))})}),children:e.jsxs(j,{sx:{width:"100%",height:"100%",position:"relative"},children:[o.length===0&&e.jsx(j,{component:"div",sx:{width:"100%",height:"100%",display:"grid",placeItems:"center"},children:e.jsx(F,{severity:"warning",variant:"outlined",children:"Asignar al menos un pin de salida"})}),c&&s.current&&e.jsx(lr,{ctrl_id:t,equipo_salida:c,socketRef:s.current},t+c.es_id)]})})})},lr=({equipo_salida:t,socketRef:s,ctrl_id:o})=>{const[r,i]=u.useState([]);return s.on("list_pines_salida",(n,c)=>{t.es_id===c.es_id&&i(n)}),u.useEffect(()=>{s.emit("initial_list_pines_salida",t.es_id)},[t.es_id]),e.jsx(e.Fragment,{children:e.jsx("div",{style:{height:"100%",width:"100%",position:"absolute",top:0,left:0},children:e.jsx(W,{sx:{width:"100%",height:"100%","& .simplebar-content":{width:"100%",height:"100%",display:"grid",placeItems:"center"}},children:e.jsx("div",{className:"grid-container-pinsal-list",children:r.map(n=>e.jsx(cr,{pinSalItem:n,socketRef:s,ctrl_id:o},n.ps_id))})})})})},cr=({pinSalItem:t,socketRef:s,ctrl_id:o})=>{const[r,i]=u.useState(t);return u.useEffect(()=>{s.emit("initial_item_pin_salida",t.ps_id),s.on("item_pin_salida",n=>{t.ps_id===n.ps_id&&i(n)})},[t.ps_id]),e.jsx(e.Fragment,{children:e.jsxs("div",{className:"grid-item-pinsal",children:[e.jsx("span",{children:`${ae(r.descripcion,20)}:`}),e.jsxs("div",{className:"button-group",children:[e.jsx("button",{className:"button_item",onClick:()=>{const{pin:n,es_id:c,ps_id:m}=r;s.emit("orden_pin_salida",{action:0,ctrl_id:o,es_id:c,pin:n,ps_id:m})},style:{backgroundColor:r.orden===0?"#d9d9d9":"transparent",color:r.orden===0?"black":"#1668dc"},children:"A"}),e.jsx("button",{className:"button_item",onClick:()=>{const{pin:n,es_id:c,ps_id:m}=r;s.emit("orden_pin_salida",{action:1,ctrl_id:o,es_id:c,pin:n,ps_id:m})},style:{backgroundColor:r.orden===1?"#49aa19":"transparent",color:r.orden===1?"white":"#1668dc"},children:"ON"}),e.jsx("button",{className:"button_item",onClick:()=>{const{pin:n,es_id:c,ps_id:m}=r;s.emit("orden_pin_salida",{action:-1,ctrl_id:o,es_id:c,pin:n,ps_id:m})},style:{backgroundColor:r.orden===-1?"#a61d24":"transparent",color:r.orden===-1?"white":"#1668dc"},children:"OFF"})]})]})})},zr=()=>{const{xctrl_id:t}=Le(),s=z(),o=u.useRef(null),r=O(n=>n.multimediaSlice),i=O(n=>n.controllerSiteState);return u.useEffect(()=>(t!==void 0&&(s(bt({openItem:[`nodo-${t}`]})),o.current||(o.current=P(`${k}/controller_state/${t}`)),o.current.on("controller_info",n=>{s(ge(n))}),o.current.on("update_region",n=>{s(jt(n))}),o.current.on("update_controller",n=>{s(ge(n))}),o.current.on("error_message",n=>{s(fe(n.message))}),o.current.on("connect",()=>{s(Ct())}),o.current.on("connect_error",n=>{s(fe(`Socket connect error: ${n.message}`))})),()=>{o.current&&(o.current.disconnect(),o.current=null),s(vt())}),[t]),e.jsxs(j,{sx:{width:"100%",height:"100%",padding:1,overflowY:"auto"},children:[i.isError&&e.jsx("div",{children:i.error??"Ocurrio un error al obtener el controlador"}),i.isSuccess&&i.controller!==void 0&&e.jsx(b,{container:!0,sx:{width:"100%",height:"100%",overflowY:"auto"},rowGap:1,children:e.jsxs(e.Fragment,{children:[e.jsx(b,{size:{xs:12},sx:{height:r.isExpandMultimedia?"100%":"calc(66.7% - 4px)"},children:e.jsxs(b,{container:!0,columnSpacing:1,sx:{height:"100%"},children:[e.jsx(b,{size:{xs:r.isExpandMultimedia?12:8},children:e.jsx(Gs,{ctrl_id:i.controller.ctrl_id})}),!r.isExpandMultimedia&&e.jsx(b,{size:{xs:4},sx:{height:"100%"},children:e.jsxs(b,{container:!0,sx:{width:"100%",height:"100%"},gap:1,children:[e.jsx(b,{size:{xs:12},sx:{width:"100%"},children:e.jsx(G,{title:"Temperaturas",children:e.jsx(tr,{ctrl_id:i.controller.ctrl_id})})}),e.jsx(b,{size:{xs:12},sx:{width:"100%"},children:e.jsx(G,{title:"Energia",children:e.jsx(Xs,{ctrl_id:i.controller.ctrl_id})})}),e.jsx(b,{size:{xs:12},sx:{width:"100%"},children:e.jsx(ar,{ctrl_id:i.controller.ctrl_id})})]})})]})}),!r.isExpandMultimedia&&e.jsx(b,{size:{xs:12},sx:{height:"calc(33.3% - 4px)"},children:e.jsxs(b,{container:!0,columnSpacing:1,sx:{height:"100%"},children:[e.jsx(b,{size:{xs:4},children:e.jsx(ys,{ctrl_id:i.controller.ctrl_id})}),e.jsx(b,{size:{xs:4},children:e.jsx(nr,{ctrl_id:i.controller.ctrl_id,region:i.controller.region})}),e.jsx(b,{size:{xs:4},children:e.jsx(Ws,{ctrl_id:i.controller.ctrl_id})})]})})]})},i.controller.ctrl_id)]})};export{zr as NodoSite,zr as default};
