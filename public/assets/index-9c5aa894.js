import{c as q,j as e,g as K,a as Q,s as L,aU as ie,aI as I,m as V,aJ as G,r as x,b as D,e as T,f as ee,c2 as ce,n as w,l as le,G as h,H as S,D as A,b0 as U,B as re,aZ as de,b1 as pe,aC as ue,N as te,W as me,X as fe,_ as he,Y as xe,Z as ge}from"./index-cd9971db.js";import{d as be}from"./Memory-d8dbb47e.js";import{S as ve,d as Ce,a as je}from"./SensorsOffRounded-86e21e2c.js";import{D as E}from"./Divider-31dc6397.js";import{C as we}from"./CameraIcon2-9546dbd3.js";import{C as Me}from"./CardHeader-20f867d3.js";import{d as J}from"./CloseRounded-e8fe62f9.js";import{B as N}from"./Button-ba927df9.js";import{u as Se,f as ke,P as ye}from"./Popover-2b6b18f6.js";import{S as _e}from"./SwitchBase-c742ff1e.js";import{C as Re}from"./Chip-a58ea68f.js";const Ie=q(e.jsx("path",{d:"M19 5v14H5V5h14m0-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z"}),"CheckBoxOutlineBlank"),Ae=q(e.jsx("path",{d:"M19 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.11 0 2-.9 2-2V5c0-1.1-.89-2-2-2zm-9 14l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"}),"CheckBox"),Pe=q(e.jsx("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-2 10H7v-2h10v2z"}),"IndeterminateCheckBox");function ze(r){return Q("MuiCheckbox",r)}const $e=K("MuiCheckbox",["root","checked","disabled","indeterminate","colorPrimary","colorSecondary","sizeSmall","sizeMedium"]),O=$e,Fe=r=>{const{classes:a,indeterminate:l,color:u,size:f}=r,b={root:["root",l&&"indeterminate",`color${I(u)}`,`size${I(f)}`]},C=ee(b,ze,a);return{...a,...C}},Le=L(_e,{shouldForwardProp:r=>ie(r)||r==="classes",name:"MuiCheckbox",slot:"Root",overridesResolver:(r,a)=>{const{ownerState:l}=r;return[a.root,l.indeterminate&&a.indeterminate,a[`size${I(l.size)}`],l.color!=="default"&&a[`color${I(l.color)}`]]}})(V(({theme:r})=>({color:(r.vars||r).palette.text.secondary,variants:[{props:{color:"default",disableRipple:!1},style:{"&:hover":{backgroundColor:r.vars?`rgba(${r.vars.palette.action.activeChannel} / ${r.vars.palette.action.hoverOpacity})`:G(r.palette.action.active,r.palette.action.hoverOpacity)}}},...Object.entries(r.palette).filter(([,a])=>a&&a.main).map(([a])=>({props:{color:a,disableRipple:!1},style:{"&:hover":{backgroundColor:r.vars?`rgba(${r.vars.palette[a].mainChannel} / ${r.vars.palette.action.hoverOpacity})`:G(r.palette[a].main,r.palette.action.hoverOpacity)}}})),...Object.entries(r.palette).filter(([,a])=>a&&a.main).map(([a])=>({props:{color:a},style:{[`&.${O.checked}, &.${O.indeterminate}`]:{color:(r.vars||r).palette[a].main},[`&.${O.disabled}`]:{color:(r.vars||r).palette.action.disabled}}})),{props:{disableRipple:!1},style:{"&:hover":{"@media (hover: none)":{backgroundColor:"transparent"}}}}]}))),Be=e.jsx(Ae,{}),He=e.jsx(Ie,{}),Ne=e.jsx(Pe,{}),Oe=x.forwardRef(function(a,l){const u=D({props:a,name:"MuiCheckbox"}),{checkedIcon:f=Be,color:b="primary",icon:C=He,indeterminate:g=!1,indeterminateIcon:v=Ne,inputProps:j,size:i="medium",disableRipple:s=!1,className:d,...p}=u,t=g?v:C,o=g?v:f,n={...u,disableRipple:s,color:b,indeterminate:g,size:i},c=Fe(n);return e.jsx(Le,{type:"checkbox",inputProps:{"data-indeterminate":g,...j},icon:x.cloneElement(t,{fontSize:t.props.fontSize??i}),checkedIcon:x.cloneElement(o,{fontSize:o.props.fontSize??i}),ownerState:n,ref:l,className:T(c.root,d),...p,classes:c})}),X=Oe;function Te(r){return Q("MuiFormControlLabel",r)}const Ue=K("MuiFormControlLabel",["root","labelPlacementStart","labelPlacementTop","labelPlacementBottom","disabled","label","error","required","asterisk"]),P=Ue,qe=r=>{const{classes:a,disabled:l,labelPlacement:u,error:f,required:b}=r,C={root:["root",l&&"disabled",`labelPlacement${I(u)}`,f&&"error",b&&"required"],label:["label",l&&"disabled"],asterisk:["asterisk",f&&"error"]};return ee(C,Te,a)},Ve=L("label",{name:"MuiFormControlLabel",slot:"Root",overridesResolver:(r,a)=>{const{ownerState:l}=r;return[{[`& .${P.label}`]:a.label},a.root,a[`labelPlacement${I(l.labelPlacement)}`]]}})(V(({theme:r})=>({display:"inline-flex",alignItems:"center",cursor:"pointer",verticalAlign:"middle",WebkitTapHighlightColor:"transparent",marginLeft:-11,marginRight:16,[`&.${P.disabled}`]:{cursor:"default"},[`& .${P.label}`]:{[`&.${P.disabled}`]:{color:(r.vars||r).palette.text.disabled}},variants:[{props:{labelPlacement:"start"},style:{flexDirection:"row-reverse",marginRight:-11}},{props:{labelPlacement:"top"},style:{flexDirection:"column-reverse"}},{props:{labelPlacement:"bottom"},style:{flexDirection:"column"}},{props:({labelPlacement:a})=>a==="start"||a==="top"||a==="bottom",style:{marginLeft:16}}]}))),Ee=L("span",{name:"MuiFormControlLabel",slot:"Asterisk",overridesResolver:(r,a)=>a.asterisk})(V(({theme:r})=>({[`&.${P.error}`]:{color:(r.vars||r).palette.error.main}}))),We=x.forwardRef(function(a,l){const u=D({props:a,name:"MuiFormControlLabel"}),{checked:f,className:b,componentsProps:C={},control:g,disabled:v,disableTypography:j,inputRef:i,label:s,labelPlacement:d="end",name:p,onChange:t,required:o,slots:n={},slotProps:c={},value:m,...k}=u,y=Se(),M=v??g.props.disabled??(y==null?void 0:y.disabled),B=o??g.props.required,Z={disabled:M,required:B};["checked","name","onChange","value","inputRef"].forEach(F=>{typeof g.props[F]>"u"&&typeof u[F]<"u"&&(Z[F]=u[F])});const ae=ke({props:u,muiFormControl:y,states:["error"]}),z={...u,disabled:M,labelPlacement:d,required:B,error:ae.error},H=qe(z),oe={slots:n,slotProps:{...C,...c}},[se,$]=ce("typography",{elementType:w,externalForwardedProps:oe,ownerState:z});let R=s;return R!=null&&R.type!==w&&!j&&(R=e.jsx(se,{component:"span",...$,className:T(H.label,$==null?void 0:$.className),children:R})),e.jsxs(Ve,{className:T(H.root,b),ownerState:z,ref:l,...k,children:[x.cloneElement(g,Z),B?e.jsxs("div",{children:[R,e.jsxs(Ee,{ownerState:z,"aria-hidden":!0,className:H.asterisk,children:["â€‰","*"]})]}):R]})}),Y=We,Ze=()=>{const r=le();return e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M24 14.2502H18.9459L14.7299 9.74974H8.96587C8.32766 7.95996 6.63191 6.66656 4.62476 6.66656C2.07498 6.66656 0 8.74154 0 11.2913C0 13.8411 2.07498 15.9161 4.62476 15.9161C6.63191 15.9161 8.32766 14.6227 8.96587 12.8329H13.0203L17.2363 17.3334H24V14.2502ZM4.62477 9.74978C3.77382 9.74978 3.08319 10.4404 3.08319 11.2914C3.08319 12.1423 3.77382 12.833 4.62477 12.833C5.47573 12.833 6.16636 12.1423 6.16636 11.2914C6.16636 10.4404 5.47573 9.74978 4.62477 9.74978Z",fill:r.palette.text.primary})})},Ge=({modo:r,pines:a})=>e.jsxs(h,{container:!0,rowSpacing:1,columnSpacing:2,width:"100%",children:[e.jsxs(h,{size:{xs:12},children:[e.jsx(w,{variant:"subtitle1",component:"h4",children:"Pin Entrada"}),e.jsx(E,{})]}),Array.from(a).map(([l,u])=>e.jsx(h,{size:{xs:12,lg:6},children:e.jsxs(S,{direction:"row",spacing:1,alignItems:"center",justifyContent:"space-between",children:[e.jsxs(S,{direction:"row",spacing:2,alignItems:"center",children:[e.jsx(Ze,{}),e.jsxs(S,{children:[e.jsx(w,{variant:"h6",children:A(u.descripcion,15,!0)}),e.jsx(w,{variant:"caption",children:A(`Pin: ${u.pin}`,15,!0)})]})]}),e.jsx(ve,{state:r===U.Seguridad?u.estado===1?"warning":"active":u.estado===1?"active":"disable"})]})},l))]}),Je=({camaras:r})=>e.jsxs(h,{container:!0,rowSpacing:1,columnSpacing:2,width:"100%",marginTop:1,children:[e.jsxs(h,{size:{xs:12},children:[e.jsx(w,{variant:"subtitle1",component:"h4",children:"Camaras"}),e.jsx(E,{})]}),Array.from(r).map(([a,l])=>e.jsx(h,{size:{xs:12,lg:6},children:e.jsxs(S,{direction:"row",alignItems:"center",justifyContent:"space-between",children:[e.jsxs(S,{direction:"row",spacing:2,alignItems:"center",children:[e.jsx(we,{isSelected:!1}),e.jsxs(S,{children:[e.jsx(w,{variant:"h6",children:A(l.descripcion,15,!0)}),e.jsx(w,{variant:"caption",children:A(l.ip,15,!0)})]})]}),e.jsx(Xe,{conectado:l.conectado})]})},a))]}),Xe=({conectado:r})=>e.jsx(re,{sx:{width:25,height:25,backgroundColor:r===0?"#f74c48":r===1?"#04c584":"#bfbfbf",borderRadius:"50%"}}),Ye=L(de)(({theme:r,modo:a,seguridad:l})=>({display:"flex",flexDirection:"column",height:"100%",width:"100%",borderStyle:"solid",borderWidth:a===U.Seguridad?2:1,borderRadius:8,backgroundImage:"inherit",borderColor:a===U.Seguridad?l===pe.Armado?"green":"darkgray":r.palette.mode==="dark"?r.palette.divider:r.palette.grey.A800,boxShadow:"inherit",":hover":{boxShadow:"inherit"},"& pre":{m:0,p:"16px !important",fontFamily:r.typography.fontFamily,fontSize:"0.75rem"}})),Ke=({data:{camara:r,controlador:a,pin_entrada:l}})=>e.jsx(e.Fragment,{children:e.jsxs(Ye,{modo:a.modo,seguridad:a.seguridad,children:[e.jsx(Me,{title:e.jsx(Qe,{controller:a}),sx:{p:.5,"& .MuiCardHeader-action":{m:"auto auto",display:"flex"},margin:0},action:e.jsx(De,{conectado:a.conectado})}),e.jsx(E,{}),e.jsx(ue,{sx:{flex:1,padding:.5,"&:last-child":{paddingBottom:.5},overflow:"hidden"},children:e.jsxs(te,{sx:{width:"100%",height:"100%"},children:[e.jsx(Ge,{modo:a.modo,pines:l}),e.jsx(Je,{camaras:r})]})})]})}),Qe=({controller:r})=>e.jsxs(S,{direction:"row",spacing:2,alignItems:"center",children:[e.jsx(be,{fontSize:"large"}),e.jsxs(S,{children:[e.jsx(w,{variant:"h6",children:A(r.nodo,20,!0)}),e.jsx(w,{variant:"caption",children:A(r.descripcion,25,!0)})]})]}),De=({conectado:r})=>e.jsx(e.Fragment,{children:r===1?e.jsx(Ce,{color:"success",fontSize:"large"}):e.jsx(je,{color:"error",fontSize:"large"})});var _=(r=>(r[r.Activo=1]="Activo",r[r.Desactivado=0]="Desactivado",r))(_||{}),W={},er=fe;Object.defineProperty(W,"__esModule",{value:!0});var ne=W.default=void 0,rr=er(me()),tr=e;ne=W.default=(0,rr.default)((0,tr.jsx)("path",{d:"M11 18h2c.55 0 1-.45 1-1s-.45-1-1-1h-2c-.55 0-1 .45-1 1s.45 1 1 1M3 7c0 .55.45 1 1 1h16c.55 0 1-.45 1-1s-.45-1-1-1H4c-.55 0-1 .45-1 1m4 6h10c.55 0 1-.45 1-1s-.45-1-1-1H7c-.55 0-1 .45-1 1s.45 1 1 1"}),"FilterListRounded");const nr=({regiones:r,handleChangeFilter:a})=>{const[l,u]=x.useState(null),f=t=>{u(t.currentTarget)},b=()=>{u(null)},C=!!l,g=C?"filter-region-alarm-popover":void 0,[v,j]=x.useState(new Map([["all",!0]])),i=x.useMemo(()=>Array.from(v).filter(([n,c])=>c&&n!=="all").reduce((n,c)=>{const m=n,[k]=c,y=r.find(M=>String(M.rgn_id)===k);return y!==void 0&&m.push([k,y]),m},[]),[v]),s=t=>{t.target.name==="all"&&t.target.checked&&j(o=>{const n=new Map(o);n.set(t.target.name,t.target.checked);for(const c of n.keys())c!=="all"&&n.set(c,!1);return n}),t.target.name!=="all"&&t.target.checked&&j(o=>{const n=new Map(o);return n.set(t.target.name,t.target.checked),n.set("all",!1),n}),t.target.name!=="all"&&!t.target.checked&&j(o=>{const n=new Map(o);n.set(t.target.name,t.target.checked);let c=!0;for(const m of n.values())c=c&&!m;return c&&n.set("all",!0),n})},d=()=>{j(t=>{const o=new Map(t);for(const n of o.keys())n!=="all"&&o.set(n,!1);return o.set("all",!0),o})},p=t=>{j(o=>{const n=new Map(o);n.set(t,!1);let c=!0;for(const m of n.values())c=c&&!m;return c&&n.set("all",!0),n})};return x.useEffect(()=>{j(t=>{const o=new Map(t);return r.forEach(n=>{o.has(String(n.rgn_id))||o.set(String(n.rgn_id),!1)}),o})},[r]),x.useEffect(()=>{a(i)},[i]),e.jsxs(h,{container:!0,px:2,pt:2,rowSpacing:1,children:[e.jsx(h,{size:{xs:12},children:e.jsxs(S,{direction:"row",justifyContent:"space-between",alignItems:"center",spacing:1,children:[e.jsx(w,{variant:"h5",children:"Alarmas"}),e.jsxs("div",{children:[e.jsx(N,{"aria-describedby":g,variant:"contained",onClick:f,startIcon:e.jsx(ne,{}),children:"Filtro"}),e.jsx(ye,{id:g,open:C,anchorEl:l,onClose:b,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},children:e.jsxs(h,{container:!0,rowSpacing:.5,columnSpacing:1,p:1,children:[e.jsx(h,{size:{xs:6},children:e.jsx(Y,{control:e.jsx(X,{checked:v.get("all"),onChange:s,disabled:v.get("all")===void 0,name:"all"}),label:"Todos"})}),e.jsx(h,{size:{xs:6},display:"flex",justifyContent:"end",children:e.jsx(N,{variant:"outlined",onClick:d,startIcon:e.jsx(J,{}),color:"error",size:"small",children:"Reset"})}),r.map(t=>e.jsx(h,{size:{xs:12,md:6,xl:4},children:e.jsx(Y,{control:e.jsx(X,{checked:v.get(String(t.rgn_id)),onChange:s,name:String(t.rgn_id),disabled:v.get(String(t.rgn_id))===void 0}),label:t.region})},t.rgn_id))]})})]})]})}),i.length>0&&e.jsx(h,{container:!0,children:e.jsxs(S,{direction:"row",alignItems:"center",flexWrap:"wrap",rowGap:1,spacing:1,children:[e.jsx(he,{variant:"outlined",sx:{p:1},children:e.jsxs(h,{container:!0,wrap:"wrap",columnSpacing:1,rowSpacing:1,alignItems:"center",children:[e.jsx(h,{children:e.jsx(w,{component:"span",variant:"subtitle1",children:"Regiones"})}),i.map(([t,o])=>e.jsx(h,{children:e.jsx(Re,{label:o.region,onDelete:()=>{p(t)}})},t))]})}),e.jsx(N,{variant:"outlined",onClick:d,startIcon:e.jsx(J,{}),color:"error",sx:{alignSelf:"center"},children:"Reset"})]})})]})},hr=()=>{const[r,a]=x.useState(new Map),[l,u]=x.useState(new Map),f=x.useRef(null),[b,C]=x.useState([]),g=x.useMemo(()=>b.length===0?Array.from(r.values()):Array.from(r.values()).reduce((s,d)=>{const p=s,t=d;return b.find(([,n])=>n.rgn_id===t.controlador.rgn_id)!==void 0&&p.push(t),p},[]),[r,b]),v=x.useMemo(()=>Array.from(r).reduce((s,d)=>{const p=s,[,t]=d,o=l.get(t.controlador.rgn_id);return o!==void 0&&p.find(c=>c.rgn_id===t.controlador.rgn_id)===void 0&&p.push(o),p},[]),[l,r]),j=i=>{C(i)};return x.useEffect(()=>(f.current||(f.current=xe(`${ge}/alarm_notification`)),f.current.on("initial_data",(i,s)=>{const d=new Map;s.forEach(t=>{d.set(t.rgn_id,t)}),u(d);const p=new Map;Object.values(i).forEach(t=>{const{camara:o,controlador:n,pin_entrada:c}=t,m=o.map(M=>[M.cmr_id,M]),k=c.map(M=>[M.pe_id,M]),y={controlador:n,camara:new Map(m),pin_entrada:new Map(k)};p.set(n.ctrl_id,y)}),a(p)}),f.current.on("region",(i,s)=>{u(d=>{const p=new Map(d);return p.set(i,s),p})}),f.current.on("camera",(i,s,d)=>{a(p=>{const t=new Map(p),o=t.get(i);if(o!==void 0){const n={controlador:o.controlador,camara:new Map(o.camara),pin_entrada:new Map(o.pin_entrada)},c=n.camara.get(s.cmr_id);let m=!1;return d==="update"?c!==void 0&&(s.activo===_.Desactivado?n.camara.delete(s.cmr_id):s.activo===_.Activo&&(m=c.conectado!==s.conectado,n.camara.set(s.cmr_id,s))):d==="add"?c===void 0&&s.activo===_.Activo&&(m=s.conectado===1,n.camara.set(s.cmr_id,s)):d==="delete"&&n.camara.delete(s.cmr_id),m?(t.delete(i),new Map([[i,n],...t])):(t.set(i,n),t)}return p})}),f.current.on("controller",(i,s,d)=>{a(p=>{const t=new Map([...p]),o=t.get(i);if(o!==void 0){const n=o.controlador;let c=!1;if(d==="update"){c=n.conectado!==s.conectado;const m={controlador:s,camara:new Map(o.camara),pin_entrada:new Map(o.pin_entrada)};t.set(i,m)}else d==="delete"&&t.delete(i);if(c){t.delete(i);const m={controlador:s,camara:new Map(o.camara),pin_entrada:new Map(o.pin_entrada)};return new Map([[i,m],...t])}return t}else if(d==="add"&&s.activo===1){const n={camara:new Map,controlador:s,pin_entrada:new Map};return new Map([[i,n],...t])}return p})}),f.current.on("pin_entrada",(i,s,d)=>{a(p=>{const t=new Map(p),o=t.get(i);if(o!==void 0){const n={controlador:o.controlador,camara:new Map(o.camara),pin_entrada:new Map(o.pin_entrada)},c=n.pin_entrada.get(s.pe_id);let m=!1;return d==="update"?c!==void 0&&(s.activo===_.Desactivado?n.pin_entrada.delete(s.pe_id):s.activo===_.Activo&&(m=c.estado!==s.estado,n.pin_entrada.set(s.pe_id,s))):d==="add"?c===void 0&&s.activo===_.Activo&&(m=s.estado===1,n.pin_entrada.set(s.pe_id,s)):d==="delete"&&n.pin_entrada.delete(s.pe_id),m?(t.delete(i),new Map([[i,n],...t])):(t.set(i,n),t)}return p})}),()=>{f.current&&(f.current.disconnect(),f.current=null)}),[]),e.jsx(e.Fragment,{children:e.jsxs(re,{sx:{width:"100%",height:"100%",display:"flex",flexDirection:"column",gap:2},children:[e.jsx(nr,{regiones:v,handleChangeFilter:j}),e.jsx(te,{sx:{width:"100%",height:"100%",flex:1,"& .simplebar-content":{width:"100%",height:"100%",display:"grid",placeItems:"center"}},children:e.jsx(h,{container:!0,rowSpacing:2,columnSpacing:2,padding:2,justifyContent:"center",sx:{width:"100%"},children:g.map(i=>e.jsx(h,{component:"div",height:250,size:{xs:12,sm:6,md:4},children:e.jsx(Ke,{data:i})},i.controlador.ctrl_id))})})]})})};export{hr as default};
