import{s as C,az as v,r as p,j as e,l as w,T as M,aL as T,aM as R,aN as k,aO as m,aP as x,aR as P,ay as b,a as A,x as z,y as O,o as F,dn as I}from"./index-CIpvoVT-.js";import{S as W,P as V,F as B}from"./PageService-CtU2OUjZ.js";import"./CardHeader-Bjo1dF8w.js";import"./Clear-fPfDnbAu.js";import"./SearchIcon-D_HM4D-Y.js";import"./groupByKey-nGMiMvM1.js";const H=({data:s,socket:a,ctrl_id:g})=>{const[u,f]=p.useState(s);return p.useEffect(()=>{a.current&&a.current.on("energy",(j,i,d)=>{switch(d){case"update":g===j&&u.me_id===i.me_id&&f(i);break}})},[a]),e.jsx(e.Fragment,{children:e.jsxs(w,{spacing:1,children:[e.jsx(M,{variant:"subtitle1",color:"textPrimary",sx:{overflow:"hidden",textWrap:"nowrap",textOverflow:"ellipsis"},children:u.descripcion}),e.jsx(T,{component:L,children:e.jsxs(R,{"aria-label":"simple table",size:"small",sx:{"& .MuiTableCell-root":{borderColor:"transparent"}},children:[e.jsx(k,{sx:{backgroundColor:"action.hover"},children:e.jsxs(m,{children:[e.jsx(x,{children:"AMP(A)"}),e.jsx(x,{children:"VOLT(V)"}),e.jsx(x,{children:"POT(W)"}),e.jsx(x,{children:"KWH"})]})}),e.jsx(P,{children:e.jsxs(m,{children:[e.jsx(x,{children:u.amperaje??"*"}),e.jsx(x,{children:u.voltaje??"*"}),e.jsx(x,{children:u.potenciaw??"*"}),e.jsx(x,{children:u.potenciakwh??"*"})]})})]})})]})})},L=C(v)(({theme:s})=>({borderRadius:8,borderWidth:1,borderStyle:"solid",borderColor:s.palette.divider,backgroundColor:s.palette.background.paper,backgroundImage:"none",boxShadow:"none",color:s.palette.text.primary})),N=({data:s,socket:a})=>{const[g,u]=p.useState(s.controlador),[f,j]=p.useState(s.energy);return p.useEffect(()=>{a.current&&(a.current.on("energy",(i,d,c)=>{switch(c){case"add":g.ctrl_id===i&&j(r=>{const t=new Map(r);return t.set(d.me_id,d),t});break;case"delete":g.ctrl_id===i&&j(r=>{const t=new Map(r);return t.delete(d.me_id),t});break}}),a.current.on("controller",(i,d,c)=>{switch(c){case"update":g.ctrl_id===i&&u(d);break}}))},[a]),e.jsx(W,{title:g.nodo,children:e.jsx(w,{spacing:2,children:f.size>0&&e.jsx(b,{size:{xs:12},container:!0,rowSpacing:1,columnSpacing:2,width:"100%",marginTop:1,children:Array.from(f).map(([i,d])=>e.jsx(b,{size:{xs:12},children:e.jsx(H,{data:d,socket:a,ctrl_id:g.ctrl_id})},i))})})})},G=()=>{const{rgn_id:s,ctrl_id:a,state:g}=A(r=>r.energyServiceStore),[u,f]=p.useState(new Map),[j,i]=p.useState(new Map),d=p.useMemo(()=>{const r=new Map;for(const[,l]of j){const n=l.controlador.rgn_id,o=l.controlador.ctrl_id;if(s!==void 0&&String(n)!==String(s)||a!==void 0&&String(o)!==String(a))continue;const h=r.get(n);h===void 0?r.set(n,[l]):h.push(l)}return Array.from(r.values()).reduce((l,n)=>{const o=l,h=n;if(h[0]){const y=u.get(h[0].controlador.rgn_id);y!==void 0&&o.push({rgn_id:y.rgn_id,region:y.region,nodos:r.get(y.rgn_id)??[]})}return o},[])},[j,s,a,g]),c=p.useRef(null);return p.useEffect(()=>(c.current||(c.current=z(`${O}/energy`,{withCredentials:!0})),c.current.on("initial_data",(r,t)=>{const l=new Map;t.forEach(o=>{l.set(o.rgn_id,o)}),f(l);const n=new Map;Object.values(r).forEach(o=>{const{controlador:h,module_energy:y}=o,E=y.map(S=>[S.me_id,S]),_={controlador:h,energy:new Map(E)};n.set(h.ctrl_id,_)}),i(n)}),c.current.on("region",(r,t)=>{f(l=>{const n=new Map(l);return n.set(r,t),n})}),c.current.on("controller",(r,t,l)=>{switch(l){case"add":i(n=>{if(!n.has(r)){const o=new Map([...n]);return o.set(r,{controlador:t,energy:new Map}),o}return n});break;case"delete":i(n=>{if(n.has(r)){const o=new Map([...n]);return o.delete(r),o}return n});break}}),()=>{c.current&&(c.current.disconnect(),c.current=null)}),[]),e.jsx(w,{spacing:2,overflow:"hidden",children:d.map(r=>e.jsxs(w,{overflow:"hidden",children:[e.jsx(M,{variant:"h5",children:r.region}),e.jsx(F,{sx:{width:"100%",height:"100%"},children:e.jsx(w,{spacing:2,direction:"row",py:2,children:r.nodos.map(t=>e.jsx(N,{data:t,socket:c},t.controlador.ctrl_id))})})]},r.rgn_id))})},X=()=>e.jsx(V,{title:"EnergÃ­a",filter:e.jsx(B,{storeSelector:s=>s.energyServiceStore,updateStoreAction:I}),children:e.jsx(G,{})});export{X as default};
