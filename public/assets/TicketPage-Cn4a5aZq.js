import{u as G,a as L,a9 as T,f as X,e as Z,j as e,B as k,o as F,l,F as q,bW as g,H as J,ac as I,a8 as B,ad as A,ae as D,af as f,bX as V,i as H,bY as ee,ab as Y,v as re,bZ as te,b_ as oe,b$ as ie,s as ne,az as ae,r as j,c0 as se,aL as de,aM as le,aN as ce,aO as ue,aP as C,aR as pe,c1 as he,c2 as ge,T as E,m as xe,p as me}from"./index-CIpvoVT-.js";import{g as S}from"./groupByKey-nGMiMvM1.js";import{S as be}from"./SearchIcon-D_HM4D-Y.js";import{C as fe}from"./Clear-fPfDnbAu.js";import{A as je,a as Ce,C as ye}from"./ArrowDropUp-DOIOzcOI.js";import{L as ke}from"./ListItemButton-C_63Vh45.js";var R=(r=>(r[r.Alta=1]="Alta",r[r.Media=2]="Media",r[r.Baja=3]="Baja",r))(R||{}),a=(r=>(r[r.Esperando=1]="Esperando",r[r.Aceptado=2]="Aceptado",r[r.Cancelado=3]="Cancelado",r[r.Rechazado=4]="Rechazado",r[r.Finalizado=16]="Finalizado",r[r.Anulado=17]="Anulado",r[r.NoAtendido=18]="NoAtendido",r[r.Asistido=21]="Asistido",r[r.Inasistencia=22]="Inasistencia",r))(a||{});const O=[{value:R.Alta,name:"Alta"},{value:R.Media,name:"Media"},{value:R.Baja,name:"Baja"}],W=[{value:a.Esperando,name:"Pendientes"},{value:a.Aceptado,name:"Aceptados"},{value:a.Cancelado,name:"Cancelados"},{value:a.Rechazado,name:"Rechazados"},{value:a.Finalizado,name:"Finalizados"},{value:a.Anulado,name:"Anulados"},{value:a.NoAtendido,name:"No atendido"},{value:a.Asistido,name:"Asistidos"},{value:a.Inasistencia,name:"No Asistidos"}],we=()=>{const r=G(),{rgn_id:o,ctrl_id:p,date:d,states:x,priority:h,controllerSearch:m}=L(t=>t.ticketStore),c=L(t=>t.authStore),{isSuccess:b,data:u,isLoading:w}=T(),P=X(),v=Z(),n=()=>{var t;P(((t=c.user)==null?void 0:t.rl_id)===ie.Invitado?"/invitado/ticket/create":"/ticket/create",{state:{from:v.pathname}})},s=t=>{r(g({rgn_id:t.target.value,ctrl_id:void 0}))},_=t=>{r(g({ctrl_id:t.target.value}))},$=t=>{r(g({priority:t.target.value}))},Q=t=>{typeof t.target.value=="object"&&r(g({states:[...t.target.value]}))};return e.jsx(e.Fragment,{children:e.jsx(k,{sx:{width:"100%"},children:e.jsx(F,{sx:{maxWidth:"100%",height:"100%"},children:e.jsxs(l,{direction:"row",spacing:1,alignItems:"center",justifyContent:"space-between",paddingBottom:1.5,children:[e.jsxs(l,{direction:"row",spacing:1,alignItems:"center",height:"auto",children:[e.jsx(l,{spacing:2,sx:{width:250},children:e.jsx(q,{freeSolo:!0,value:m,onChange:(t,i)=>{typeof i!="string"&&r(g({controllerSearch:i,rgn_id:i?String(i.rgn_id):void 0,ctrl_id:i?String(i.ctrl_id):void 0}))},clearIcon:e.jsx(fe,{onClick:()=>{r(g({controllerSearch:null}))}}),id:"controller_ticket_searcher",options:b&&u?u:[],getOptionLabel:t=>typeof t=="string"?t:t.nodo,sx:{width:250},renderInput:t=>e.jsx(J,{...t,placeholder:"Buscar sitio",disabled:w,slotProps:{input:{...t.InputProps,startAdornment:e.jsx(be,{})}},sx:{"& .MuiOutlinedInput-root":{borderRadius:"25px",px:2}}})})}),e.jsxs(l,{spacing:1,width:200,direction:"row",alignItems:"center",children:[e.jsx(I,{htmlFor:"group_site",sx:{display:"none"},children:"Grupo de sitio"}),e.jsxs(B,{displayEmpty:!0,value:o??"",onChange:s,inputProps:{id:"group_site"},renderValue:t=>{if(t.length===0)return e.jsx(e.Fragment,{children:"Grupo de sitio"});let i;return b&&(i=S(u,"rgn_id")[t]?S(u,"rgn_id")[t][0]:void 0),e.jsx(e.Fragment,{children:i==null?void 0:i.region.region})},IconComponent:({...t})=>o?e.jsx(A,{onClick:i=>{i.stopPropagation(),r(g({rgn_id:void 0,ctrl_id:void 0}))}}):e.jsx(D,{...t}),sx:{width:200,borderRadius:"10px",backgroundColor:"transparent","&.Mui-focused":{boxShadow:"none"},"&.MuiOutlinedInput-root":{fontWeight:500,backgroundColor:"transparent",color:"text.primary","& fieldset":{...o&&{backgroundColor:"tertiary.opacityLight"},borderColor:"custom.outlineBoder"},"&:hover fieldset":{backgroundColor:"tertiary.opacityLight",borderColor:"custom.outlineBoder"},"&.Mui-focused fieldset":{borderColor:"custom.outlineBoder",backgroundColor:"tertiary.opacityLight"}},"& .MuiSelect-icon":{color:"text.primary"}},MenuProps:{PaperProps:{style:{maxHeight:200,width:200}}},children:[e.jsx(f,{disabled:!0,value:"",children:e.jsx(e.Fragment,{children:"Grupo de sitio"})}),b&&Object.entries(S(u,"rgn_id")).map(([t,i])=>e.jsx(f,{value:t,children:e.jsx(k,{sx:{overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis",width:"100%"},children:i[0].region.region})},t))]})]}),e.jsxs(l,{spacing:1,width:200,direction:"row",alignItems:"center",children:[e.jsx(I,{htmlFor:"site_item",sx:{display:"none"},children:"Sitio"}),e.jsxs(B,{disabled:!o,displayEmpty:!0,value:p??"",onChange:_,inputProps:{id:"site_item"},renderValue:t=>{if(t.length===0)return e.jsx(e.Fragment,{children:"Sitio"});let i;return b&&(i=u.find(M=>String(M.ctrl_id)===String(t))),e.jsx(e.Fragment,{children:i==null?void 0:i.nodo})},IconComponent:({...t})=>p?e.jsx(A,{onClick:i=>{i.stopPropagation(),r(g({ctrl_id:void 0}))}}):e.jsx(D,{...t}),sx:{width:200,borderRadius:"10px",backgroundColor:"transparent","&.Mui-focused":{boxShadow:"none"},"&.MuiOutlinedInput-root":{fontWeight:500,backgroundColor:"transparent",color:"text.primary","& fieldset":{...o&&{backgroundColor:"tertiary.opacityLight"},borderColor:"custom.outlineBoder"},"&:hover fieldset":{backgroundColor:"tertiary.opacityLight",borderColor:"custom.outlineBoder"},"&.Mui-focused fieldset":{borderColor:"custom.outlineBoder",backgroundColor:"tertiary.opacityLight"}},"& .MuiSelect-icon":{color:"text.primary"}},MenuProps:{PaperProps:{style:{maxHeight:200,width:200}}},children:[e.jsx(f,{disabled:!0,value:"",children:e.jsx(e.Fragment,{children:"Sitio"})}),b&&o&&S(u,"rgn_id")[o]&&S(u,"rgn_id")[o].map(t=>e.jsx(f,{value:String(t.ctrl_id),children:e.jsx(k,{sx:{overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis",width:"100%"},children:t.nodo})},String(t.ctrl_id)))]})]}),e.jsxs(l,{spacing:1,width:200,direction:"row",alignItems:"center",children:[e.jsx(I,{htmlFor:"multiple_state_select",sx:{display:"none"},children:"Estados"}),e.jsxs(B,{displayEmpty:!0,value:x,multiple:!0,onChange:Q,inputProps:{id:"multiple_state_select"},renderValue:t=>{if(t.length===0)return e.jsx(e.Fragment,{children:"Estados"});const i=t.reduce((M,U)=>{const z=M,N=W.find(K=>String(K.value)===String(U));return N&&z.push(N.name),z},[]);return e.jsx(e.Fragment,{children:i.join(", ")})},IconComponent:({...t})=>x.length>0?e.jsx(A,{onClick:i=>{i.stopPropagation(),r(g({states:[]}))}}):e.jsx(D,{...t}),sx:{width:200,borderRadius:"10px",backgroundColor:"transparent","&.Mui-focused":{boxShadow:"none"},"&.MuiOutlinedInput-root":{fontWeight:500,backgroundColor:"transparent",color:"text.primary","& fieldset":{...x.length>0&&{backgroundColor:"tertiary.opacityLight"},borderColor:"custom.outlineBoder"},"&:hover fieldset":{backgroundColor:"tertiary.opacityLight",borderColor:"custom.outlineBoder"},"&.Mui-focused fieldset":{borderColor:"custom.outlineBoder",backgroundColor:"tertiary.opacityLight"}},"& .MuiSelect-icon":{color:"text.primary"}},MenuProps:{PaperProps:{style:{maxHeight:400,width:200}}},children:[e.jsx(f,{disabled:!0,value:"",children:e.jsx(e.Fragment,{children:"Estados"})}),W.map((t,i)=>e.jsxs(f,{value:String(t.value),children:[e.jsx(V,{checked:x.includes(String(t.value))}),e.jsx(H,{primary:t.name})]},i))]})]}),e.jsxs(l,{spacing:1,width:200,direction:"row",alignItems:"center",children:[e.jsx(I,{htmlFor:"priority_select",sx:{display:"none"},children:"Prioridad"}),e.jsxs(B,{displayEmpty:!0,value:h??"",onChange:$,inputProps:{id:"priority_select"},renderValue:t=>{if(t.length===0)return e.jsx(e.Fragment,{children:"Nivel de prioridad"});const i=O.find(M=>String(M.value)===String(t));return e.jsx(e.Fragment,{children:i?i.name:"No controlado"})},IconComponent:({...t})=>h?e.jsx(A,{onClick:i=>{i.stopPropagation(),r(g({priority:void 0}))}}):e.jsx(D,{...t}),sx:{width:200,borderRadius:"10px",backgroundColor:"transparent","&.Mui-focused":{boxShadow:"none"},"&.MuiOutlinedInput-root":{fontWeight:500,backgroundColor:"transparent",color:"text.primary","& fieldset":{...h&&{backgroundColor:"tertiary.opacityLight"},borderColor:"custom.outlineBoder"},"&:hover fieldset":{backgroundColor:"tertiary.opacityLight",borderColor:"custom.outlineBoder"},"&.Mui-focused fieldset":{borderColor:"custom.outlineBoder",backgroundColor:"tertiary.opacityLight"}},"& .MuiSelect-icon":{color:"text.primary"}},MenuProps:{PaperProps:{style:{maxHeight:200,width:200}}},children:[e.jsx(f,{disabled:!0,value:"",children:e.jsx(e.Fragment,{children:"Nivel de prioridad"})}),O.map((t,i)=>e.jsx(f,{value:t.value,children:t.name},i))]})]}),e.jsxs(l,{spacing:1,width:200,direction:"row",alignItems:"center",children:[e.jsx(I,{htmlFor:"date-select-ticket",sx:{display:"none"},children:"Fecha"}),e.jsx(ee,{format:"DD/MM/YYYY",value:d?Y(d,"DD/MM/YYYY"):null,onChange:t=>{t&&r(g({date:t.format("DD/MM/YYYY")}))},slots:{inputAdornment:ve},slotProps:{textField:{size:"medium",id:"date-select-ticket"},inputAdornment:{canDelete:!!d}}})]})]}),e.jsx(re,{variant:"contained",color:"primary",size:"medium",startIcon:e.jsx(te,{}),onClick:n,sx:{minWidth:140,whiteSpace:"nowrap"},children:"Crear ticket"})]})})})})};function ve(r){const{canDelete:o,children:p,sx:d,...x}=r,h=G();return e.jsxs(oe,{...x,children:[o&&e.jsx(A,{onClick:m=>{m.stopPropagation(),h(g({date:void 0}))}}),!o&&p]})}const Se=({controlador:{ctrl_id:r}})=>{const[o,p]=j.useState(0),[d,x]=j.useState(10),{date:h,states:m,priority:c}=L(s=>s.ticketStore),b=s=>{x(s.target.value),p(0)},u=(s,_)=>{p(_)},[w,{isError:P,isSuccess:v,data:n}]=se();return j.useEffect(()=>{const s={};m.length>0&&(s.state=m),h!==void 0&&(s.dateRange={end:Y(h,"DD/MM/YYYY").format("YYYY-MM-DD"),start:Y(h,"DD/MM/YYYY").format("YYYY-MM-DD")}),c!==void 0&&(s.priority=c),w({ctrl_id:r,limit:d,offset:o*d,filters:s},!1)},[r,o,d,h,c,m]),e.jsxs(e.Fragment,{children:[e.jsx(de,{component:_e,children:e.jsxs(le,{"aria-label":"simple table",size:"small",sx:s=>({"& .MuiTableCell-root":{borderColor:"divider"},"& tbody tr:hover":{backgroundColor:"tertiary.opacityLight"}}),children:[e.jsx(ce,{sx:{backgroundColor:"action.hover"},children:e.jsxs(ue,{children:[e.jsx(C,{children:"N°"}),e.jsx(C,{children:"Empresa"}),e.jsx(C,{children:"Descripción"}),e.jsx(C,{children:"Ingreso"}),e.jsx(C,{children:"Salida"}),e.jsx(C,{children:"Estado"}),e.jsx(C,{children:"Decisión"})]})}),e.jsx(pe,{children:v&&n&&n.data.map(s=>e.jsx(he,{ctrl_id:r,registroTicket:s},s.rt_id))})]})}),v&&n&&e.jsx(ge,{handleChangePage:u,handleChangeRowsPerPage:b,page:o,rowsPerPage:d,total:n.total_size})]})},_e=ne(ae)(({theme:r})=>({borderTopRightRadius:0,borderTopLeftRadius:0,border:"none",backgroundColor:r.palette.background.default,backgroundImage:"none",boxShadow:"none"})),Me=[{state:a.Esperando,name:"Pendiente",backgroundColor:"warning.300",filter:"drop-shadow(0px 2px 6px rgba(241, 225, 44, 0.30))"},{state:a.Aceptado,name:"Aceptado",backgroundColor:"success.opacityDarker",filter:"drop-shadow(0px 2px 6px rgba(44, 241, 120, 0.30))"},{state:a.Cancelado,name:"Cancelado",backgroundColor:"secondary.400",filter:"drop-shadow(0px 2px 6px rgba(242, 160, 44, 0.30))"},{state:a.Rechazado,name:"Rechazado",backgroundColor:"error.opacityDarker",filter:"drop-shadow(0px 2px 6px rgba(241, 44, 44, 0.30))"},{state:a.Finalizado,name:"Finalizado",backgroundColor:"info.opacityDarker",filter:"drop-shadow(0px 2px 6px rgba(44, 113, 241, 0.30))"},{state:a.Anulado,name:"Anulado",backgroundColor:"tertiary.opacityDarker",filter:"drop-shadow(0px 2px 6px rgba(93, 115, 117, 0.30))"},{state:a.NoAtendido,name:"No atendido",backgroundColor:"action.disabledBackground",filter:"drop-shadow(0px 1px 6px rgba(42, 55, 60, 0.10))"},{state:a.Asistido,name:"Asistió",backgroundColor:"primary.300",filter:"drop-shadow(0px 2px 6px rgba(44, 225, 241, 0.30))"},{state:a.Inasistencia,name:"No asistió",backgroundColor:"tertiary.opacityDarker",filter:"drop-shadow(0px 2px 6px rgba(93, 115, 117, 0.30))"}],y=({state:r})=>{const o=Me.find(p=>p.state===r);return e.jsxs(l,{direction:"row",spacing:1,alignItems:"center",children:[e.jsx(k,{sx:{width:12,height:12,backgroundColor:(o==null?void 0:o.backgroundColor)??"tertiary.opacityDarker",borderRadius:"50%",filter:(o==null?void 0:o.filter)??"drop-shadow(0px 2px 6px rgba(93, 115, 117, 0.30))",strokeWidth:1,stroke:"divider"}}),e.jsx(E,{color:"textSecondary",variant:"body1",children:(o==null?void 0:o.name)??"error_estado"})]})},Ie=()=>{const{rgn_id:r,ctrl_id:o,date:p,states:d,priority:x,controllerSearch:h}=L(n=>n.ticketStore),{isSuccess:m,data:c,isLoading:b}=T(),[u,w]=j.useState(0),P=j.useMemo(()=>c===void 0?{}:S(c,"rgn_id"),[c]),v=j.useMemo(()=>{if(!c)return[];let n=c;return r!==void 0?n=n.filter(s=>String(s.rgn_id)===String(r)):u>0&&(n=n.filter(s=>String(s.rgn_id)===String(u))),o!==void 0&&(n=n.filter(s=>String(s.ctrl_id)===String(o))),n},[c,r,o,u]);return j.useEffect(()=>{if(m&&c&&r===void 0){const n=c[0].rgn_id;n&&w(n)}},[m,c,r]),e.jsxs(l,{spacing:2,height:"100%",children:[e.jsx(k,{children:e.jsx(F,{sx:{maxWidth:"100%",height:"100%"},children:e.jsx(l,{direction:"row",spacing:2,paddingBottom:1.5,children:Object.entries(P).map(([n,s])=>e.jsx(Ae,{region:s[0].region,selected:r!==void 0?String(r)===String(n):String(n)===String(u),onClick:()=>{w(Number(n))}},n))})})}),e.jsxs(l,{flexGrow:1,overflow:"hidden",sx:{borderWidth:1,borderStyle:"solid",borderColor:"divider",borderRadius:"8px"},children:[e.jsx(F,{sx:{height:"100%",width:"100%"},children:e.jsx(xe,{disablePadding:!0,children:v.map((n,s,_)=>e.jsx(Pe,{title:n.nodo,divider:s<_.length-1,children:e.jsx(Se,{controlador:n})},`${n.rgn_id}_${n.ctrl_id}`))})}),e.jsxs(l,{direction:"row",spacing:1,px:2,py:1,alignItems:"center",sx:{backgroundColor:"action.hover"},children:[e.jsx(y,{state:a.Esperando}),e.jsx(y,{state:a.Aceptado}),e.jsx(y,{state:a.Rechazado}),e.jsx(y,{state:a.Inasistencia}),e.jsx(y,{state:a.Finalizado}),e.jsx(y,{state:a.Cancelado}),e.jsx(y,{state:a.NoAtendido})]})]})]})},Ae=({region:r,selected:o,onClick:p})=>e.jsx(k,{sx:{py:1,px:2,borderRadius:"10px",border:"1px solid",borderColor:"custom.outlineBoder",":hover":{...o&&{backgroundColor:"primary.opacityDark"},...!o&&{backgroundColor:"primary.opacityLight"}},...o&&{backgroundColor:"primary.opacityDark",borderColor:"transparent"},cursor:"pointer"},onClick:p,children:e.jsx(E,{variant:"subtitle1",color:"textPrimary",sx:{whiteSpace:"nowrap"},children:r.region})}),Pe=({children:r,title:o,divider:p})=>{const[d,x]=j.useState(!1),h=()=>{x(!d)};return e.jsxs(e.Fragment,{children:[e.jsxs(ke,{onClick:h,sx:{backgroundColor:d?"tertiary.opacityMain":"background.default",color:"text.primary",":hover":{color:"text.primary",backgroundColor:d?"tertiary.opacityMain":"custom.trackBackground"}},divider:!d&&p,children:[e.jsx(H,{primary:o}),d?e.jsx(je,{}):e.jsx(Ce,{})]}),e.jsx(ye,{in:d,timeout:"auto",unmountOnExit:!0,sx:{...d&&{borderBottomWidth:1,borderBottomStyle:"solid",borderBottomColor:"divider"}},children:r})]})},Ee=()=>e.jsx(k,{sx:{width:"100%",height:"100%",overflow:"hidden"},children:e.jsxs(l,{sx:{px:{xs:2,sm:3},py:{xs:2,sm:3},mx:"auto",overflow:"hidden"},spacing:2,maxWidth:1600,width:"100%",height:"100%",children:[e.jsx(l,{children:e.jsx(E,{variant:"h5",children:"Tickets"})}),e.jsx(we,{}),e.jsx(me,{}),e.jsx(l,{flexGrow:1,overflow:"hidden",children:e.jsx(Ie,{})})]})});export{Ee as default};
