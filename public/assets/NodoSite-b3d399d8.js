import{a as et,g as tt,s as R,n as L,bf as st,r as m,b as rt,j as e,d as ve,f as nt,b4 as V,bg as re,bh as _e,u as ot,bi as C,bj as it,l as ne,bk as Se,aV as J,aW as oe,B as j,bl as we,a9 as M,aa as k,K as T,h as A,t as z,av as K,aw as te,aO as at,aD as ye,aE as X,S as ie,M as O,I as F,bm as lt,bn as Z,bo as Te,b9 as ke,a6 as De,a7 as Me,bp as B,bq as E,br as ct,bs as dt,C as y,o as ut,_ as W,G as b,E as ae,bt as mt,O as pt,P as ht,Q as xt,bu as gt,aB as ft,W as xe,bv as Pe,q as bt,N as jt,w as Ct,x as vt,y as _t,A as St,D as wt,be as yt,bw as Tt,bx as ge,by as kt,bz as fe,bA as Dt,bB as Mt}from"./index-7f3888f4.js";import{D as Pt}from"./Divider-6d6f4f47.js";import{A as $}from"./Alert-d5d5c8ce.js";import{g as Rt,a as It,P as Ft,u as ee,b as le,c as Lt,d as N,f as be,e as $t,h as Et,r as Re,C as Ot,i as Ie,j as Fe,k as At,s as Le,v as $e,l as a,m as Ee,n as zt,D as Yt}from"./useMobilePicker-8618c87d.js";import{P as Vt,a as U,r as Ht,b as je,c as Nt,d as se}from"./date-time-utils-35ca60ce.js";import{T as Oe,D as Ae,S as Ut}from"./StreamPlayer-e73c9f02.js";import{T as ze,t as Ye}from"./Tooltip-928eb6e5.js";import{d as Bt,a as qt}from"./LastPage-7f39ad88.js";import{d as Gt,a as Wt,g as Ve}from"./getFormattedDateTime-3bd4b06d.js";import{S as He}from"./ServerError-86a4bf79.js";import{d as Qt,a as Kt,S as Xt}from"./SensorsOffRounded-c09f1175.js";import{b as Ne,a as Ue,f as Be,c as ce,d as Y,T as v,e as de}from"./PaperTable-d3644a14.js";import{d as Jt}from"./DownloadRounded-877094ad.js";import{_ as Zt}from"./react-apexcharts.min-81c0cf6e.js";import{L as es}from"./LimitedTextDisplay-a86b62aa.js";import"./InputAdornment-709639ba.js";import"./Chip-7a4f0a5e.js";function ts(t){return et("MuiDialogContentText",t)}tt("MuiDialogContentText",["root"]);const ss=t=>{const{classes:s}=t,r=nt({root:["root"]},ts,s);return{...s,...r}},rs=R(L,{shouldForwardProp:t=>st(t)||t==="classes",name:"MuiDialogContentText",slot:"Root",overridesResolver:(t,s)=>s.root})({}),ns=m.forwardRef(function(s,o){const r=rt({props:s,name:"MuiDialogContentText"}),{children:i,className:n,...c}=r,p=ss(c);return e.jsx(rs,{component:"p",variant:"body1",color:"textSecondary",ref:o,ownerState:c,className:ve(p.root,n),...r,classes:p})}),os=ns,is=V([e.jsx("circle",{cx:"12",cy:"12",r:"3.2"},"0"),e.jsx("path",{d:"M9 2 7.17 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2h-3.17L15 2zm3 15c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5"},"1")],"CameraAlt"),as=V(e.jsx("path",{d:"M16.59 9H15V4c0-.55-.45-1-1-1h-4c-.55 0-1 .45-1 1v5H7.41c-.89 0-1.34 1.08-.71 1.71l4.59 4.59c.39.39 1.02.39 1.41 0l4.59-4.59c.63-.63.19-1.71-.7-1.71M5 19c0 .55.45 1 1 1h12c.55 0 1-.45 1-1s-.45-1-1-1H6c-.55 0-1 .45-1 1"}),"DownloadRounded"),ls=V(e.jsx("path",{d:"m15.96 10.29-2.75 3.54-1.96-2.36L8.5 15h11zM3 5H1v16c0 1.1.9 2 2 2h16v-2H3zm18-4H7c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V3c0-1.1-.9-2-2-2m0 16H7V3h14z"}),"Filter"),cs=V(e.jsx("path",{d:"M23 8c0 1.1-.9 2-2 2-.18 0-.35-.02-.51-.07l-3.56 3.55c.05.16.07.34.07.52 0 1.1-.9 2-2 2s-2-.9-2-2c0-.18.02-.36.07-.52l-2.55-2.55c-.16.05-.34.07-.52.07s-.36-.02-.52-.07l-4.55 4.56c.05.16.07.33.07.51 0 1.1-.9 2-2 2s-2-.9-2-2 .9-2 2-2c.18 0 .35.02.51.07l4.56-4.55C8.02 9.36 8 9.18 8 9c0-1.1.9-2 2-2s2 .9 2 2c0 .18-.02.36-.07.52l2.55 2.55c.16-.05.34-.07.52-.07s.36.02.52.07l3.55-3.56C19.02 8.35 19 8.18 19 8c0-1.1.9-2 2-2s2 .9 2 2"}),"Timeline"),ds=V(e.jsx("path",{d:"M4 6H2v14c0 1.1.9 2 2 2h14v-2H4zm16-4H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2m-8 12.5v-9l6 4.5z"}),"VideoLibrary"),us=V(e.jsx("path",{d:"M17 10.5V7c0-.55-.45-1-1-1H4c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.55 0 1-.45 1-1v-3.5l4 4v-11z"}),"Videocam");function ms(t){return It("MuiTimePickerToolbar",t)}const q=Rt("MuiTimePickerToolbar",["root","separator","hourMinuteLabel","hourMinuteLabelLandscape","hourMinuteLabelReverse","ampmSelection","ampmLandscape","ampmLabel"]),ps=["ampm","ampmInClock","value","isLandscape","onChange","view","onViewChange","views","disabled","readOnly","className"],hs=t=>{const{isLandscape:s,classes:o,isRtl:r}=t;return $t({root:["root"],separator:["separator"],hourMinuteLabel:["hourMinuteLabel",s&&"hourMinuteLabelLandscape",r&&"hourMinuteLabelReverse"],ampmSelection:["ampmSelection",s&&"ampmLandscape"],ampmLabel:["ampmLabel"]},ms,o)},xs=R(Ft,{name:"MuiTimePickerToolbar",slot:"Root",overridesResolver:(t,s)=>s.root})({}),gs=R(Vt,{name:"MuiTimePickerToolbar",slot:"Separator",overridesResolver:(t,s)=>s.separator})({outline:0,margin:"0 4px 0 2px",cursor:"default"}),fs=R("div",{name:"MuiTimePickerToolbar",slot:"HourMinuteLabel",overridesResolver:(t,s)=>[{[`&.${q.hourMinuteLabelLandscape}`]:s.hourMinuteLabelLandscape,[`&.${q.hourMinuteLabelReverse}`]:s.hourMinuteLabelReverse},s.hourMinuteLabel]})({display:"flex",justifyContent:"flex-end",alignItems:"flex-end",variants:[{props:{isRtl:!0},style:{flexDirection:"row-reverse"}},{props:{isLandscape:!0},style:{marginTop:"auto"}}]}),bs=R("div",{name:"MuiTimePickerToolbar",slot:"AmPmSelection",overridesResolver:(t,s)=>[{[`.${q.ampmLabel}`]:s.ampmLabel},{[`&.${q.ampmLandscape}`]:s.ampmLandscape},s.ampmSelection]})({display:"flex",flexDirection:"column",marginRight:"auto",marginLeft:12,[`& .${q.ampmLabel}`]:{fontSize:17},variants:[{props:{isLandscape:!0},style:{margin:"4px 0 auto",flexDirection:"row",justifyContent:"space-around",flexBasis:"100%"}}]});function js(t){const s=re({props:t,name:"MuiTimePickerToolbar"}),{ampm:o,ampmInClock:r,value:i,isLandscape:n,onChange:c,view:p,onViewChange:d,views:l,disabled:u,readOnly:h,className:g}=s,x=_e(s,ps),f=ee(),_=le(),S=ot(),D=!!(o&&!r&&l.includes("hours")),{meridiemMode:w,handleMeridiemChange:H}=Lt(i,o,c),Q=he=>o?f.format(he,"hours12h"):f.format(he,"hours24h"),I=C({},s,{isRtl:S}),P=hs(I),pe=e.jsx(gs,{tabIndex:-1,value:":",variant:"h3",selected:!1,className:P.separator});return e.jsxs(xs,C({landscapeDirection:"row",toolbarTitle:_.timePickerToolbarTitle,isLandscape:n,ownerState:I,className:ve(P.root,g)},x,{children:[e.jsxs(fs,{className:P.hourMinuteLabel,ownerState:I,children:[N(l,"hours")&&e.jsx(U,{tabIndex:-1,variant:"h3",onClick:()=>d("hours"),selected:p==="hours",value:i?Q(i):"--"}),N(l,["hours","minutes"])&&pe,N(l,"minutes")&&e.jsx(U,{tabIndex:-1,variant:"h3",onClick:()=>d("minutes"),selected:p==="minutes",value:i?f.format(i,"minutes"):"--"}),N(l,["minutes","seconds"])&&pe,N(l,"seconds")&&e.jsx(U,{variant:"h3",onClick:()=>d("seconds"),selected:p==="seconds",value:i?f.format(i,"seconds"):"--"})]}),D&&e.jsxs(bs,{className:P.ampmSelection,ownerState:I,children:[e.jsx(U,{disableRipple:!0,variant:"subtitle2",selected:w==="am",typographyClassName:P.ampmLabel,value:be(f,"am"),onClick:h?void 0:()=>H("am"),disabled:u}),e.jsx(U,{disableRipple:!0,variant:"subtitle2",selected:w==="pm",typographyClassName:P.ampmLabel,value:be(f,"pm"),onClick:h?void 0:()=>H("pm"),disabled:u})]})]}))}function qe(t,s){var c;const o=ee(),r=re({props:t,name:s}),i=r.ampm??o.is12HourCycleInCurrentLocale(),n=m.useMemo(()=>{var p;return((p=r.localeText)==null?void 0:p.toolbarTitle)==null?r.localeText:C({},r.localeText,{timePickerToolbarTitle:r.localeText.toolbarTitle})},[r.localeText]);return C({},r,{ampm:i,localeText:n},Et({views:r.views,openTo:r.openTo,defaultViews:["hours","minutes"],defaultOpenTo:"hours"}),{disableFuture:r.disableFuture??!1,disablePast:r.disablePast??!1,slots:C({toolbar:js},r.slots),slotProps:C({},r.slotProps,{toolbar:C({ampm:i,ampmInClock:r.ampmInClock},(c=r.slotProps)==null?void 0:c.toolbar)})})}const Ge=m.forwardRef(function(s,o){var D,w,H,Q;const r=le(),i=ee(),n=qe(s,"MuiDesktopTimePicker"),{shouldRenderTimeInASingleColumn:c,views:p,timeSteps:d}=Ht(n),l=c?Nt:je,u=C({hours:l,minutes:l,seconds:l,meridiem:l},n.viewRenderers),h=n.ampmInClock??!0,g=c?[]:["accept"],f=((D=u.hours)==null?void 0:D.name)===je.name?p:p.filter(I=>I!=="meridiem"),_=C({},n,{ampmInClock:h,timeSteps:d,viewRenderers:u,format:Re(i,n),views:c?["hours"]:f,slots:C({field:Oe,openPickerIcon:Ot},n.slots),slotProps:C({},n.slotProps,{field:I=>{var P;return C({},Ie((P=n.slotProps)==null?void 0:P.field,I),Fe(n),{ref:o})},toolbar:C({hidden:!0,ampmInClock:h},(w=n.slotProps)==null?void 0:w.toolbar),actionBar:C({actions:g},(H=n.slotProps)==null?void 0:H.actionBar)})}),{renderPicker:S}=At({props:_,valueManager:Le,valueType:"time",getOpenDialogAriaText:((Q=_.localeText)==null?void 0:Q.openTimePickerDialogue)??r.openTimePickerDialogue,validator:$e});return S()});Ge.propTypes={ampm:a.bool,ampmInClock:a.bool,autoFocus:a.bool,className:a.string,closeOnSelect:a.bool,defaultValue:a.object,disabled:a.bool,disableFuture:a.bool,disableIgnoringDatePartForTimeValidation:a.bool,disableOpenPicker:a.bool,disablePast:a.bool,enableAccessibleFieldDOMStructure:a.any,format:a.string,formatDensity:a.oneOf(["dense","spacious"]),inputRef:Ee,label:a.node,localeText:a.object,maxTime:a.object,minTime:a.object,minutesStep:a.number,name:a.string,onAccept:a.func,onChange:a.func,onClose:a.func,onError:a.func,onOpen:a.func,onSelectedSectionsChange:a.func,onViewChange:a.func,open:a.bool,openTo:a.oneOf(["hours","meridiem","minutes","seconds"]),orientation:a.oneOf(["landscape","portrait"]),readOnly:a.bool,reduceAnimations:a.bool,referenceDate:a.object,selectedSections:a.oneOfType([a.oneOf(["all","day","empty","hours","meridiem","minutes","month","seconds","weekDay","year"]),a.number]),shouldDisableTime:a.func,skipDisabled:a.bool,slotProps:a.object,slots:a.object,sx:a.oneOfType([a.arrayOf(a.oneOfType([a.func,a.object,a.bool])),a.func,a.object]),thresholdToRenderTimeInASingleColumn:a.number,timeSteps:a.shape({hours:a.number,minutes:a.number,seconds:a.number}),timezone:a.string,value:a.object,view:a.oneOf(["hours","meridiem","minutes","seconds"]),viewRenderers:a.shape({hours:a.func,meridiem:a.func,minutes:a.func,seconds:a.func}),views:a.arrayOf(a.oneOf(["hours","minutes","seconds"]).isRequired)};const We=m.forwardRef(function(s,o){var u,h;const r=le(),i=ee(),n=qe(s,"MuiMobileTimePicker"),c=C({hours:se,minutes:se,seconds:se},n.viewRenderers),p=n.ampmInClock??!1,d=C({},n,{ampmInClock:p,viewRenderers:c,format:Re(i,n),slots:C({field:Oe},n.slots),slotProps:C({},n.slotProps,{field:g=>{var x;return C({},Ie((x=n.slotProps)==null?void 0:x.field,g),Fe(n),{ref:o})},toolbar:C({hidden:!1,ampmInClock:p},(u=n.slotProps)==null?void 0:u.toolbar)})}),{renderPicker:l}=zt({props:d,valueManager:Le,valueType:"time",getOpenDialogAriaText:((h=d.localeText)==null?void 0:h.openTimePickerDialogue)??r.openTimePickerDialogue,validator:$e});return l()});We.propTypes={ampm:a.bool,ampmInClock:a.bool,autoFocus:a.bool,className:a.string,closeOnSelect:a.bool,defaultValue:a.object,disabled:a.bool,disableFuture:a.bool,disableIgnoringDatePartForTimeValidation:a.bool,disableOpenPicker:a.bool,disablePast:a.bool,enableAccessibleFieldDOMStructure:a.any,format:a.string,formatDensity:a.oneOf(["dense","spacious"]),inputRef:Ee,label:a.node,localeText:a.object,maxTime:a.object,minTime:a.object,minutesStep:a.number,name:a.string,onAccept:a.func,onChange:a.func,onClose:a.func,onError:a.func,onOpen:a.func,onSelectedSectionsChange:a.func,onViewChange:a.func,open:a.bool,openTo:a.oneOf(["hours","minutes","seconds"]),orientation:a.oneOf(["landscape","portrait"]),readOnly:a.bool,reduceAnimations:a.bool,referenceDate:a.object,selectedSections:a.oneOfType([a.oneOf(["all","day","empty","hours","meridiem","minutes","month","seconds","weekDay","year"]),a.number]),shouldDisableTime:a.func,slotProps:a.object,slots:a.object,sx:a.oneOfType([a.arrayOf(a.oneOfType([a.func,a.object,a.bool])),a.func,a.object]),timezone:a.string,value:a.object,view:a.oneOf(["hours","minutes","seconds"]),viewRenderers:a.shape({hours:a.func,minutes:a.func,seconds:a.func}),views:a.arrayOf(a.oneOf(["hours","minutes","seconds"]).isRequired)};const Cs=["desktopModeMediaQuery"],vs=m.forwardRef(function(s,o){const r=re({props:s,name:"MuiTimePicker"}),{desktopModeMediaQuery:i=Yt}=r,n=_e(r,Cs);return it(i,{defaultMatches:!0})?e.jsx(Ge,C({ref:o},n)):e.jsx(We,C({ref:o},n))}),Ce={p:.5,"& .MuiCardHeader-action":{m:"auto auto",display:"flex"}},G=m.forwardRef(({border:t=!0,boxShadow:s,children:o,content:r=!0,contentSX:i={},darkTitle:n,elevation:c,secondary:p,shadow:d,sx:l={},title:u,isDivider:h=!1,codeHighlight:g,cardActions:x,...f},_)=>{const S=ne();return s=S.palette.mode==="dark"?s||!0:s,e.jsxs(Se,{elevation:c||0,ref:_,...f,sx:{display:"flex",flexDirection:"column",height:"100%",width:"100%",border:t?"1px solid":"none",borderRadius:2,borderColor:S.palette.mode==="dark"?S.palette.divider:S.palette.grey.A800,boxShadow:s&&(!t||S.palette.mode==="dark")?d||S.shadows[10]:"inherit",":hover":{boxShadow:s?d||S.shadows[10]:"inherit"},"& pre":{m:0,p:"16px !important",fontFamily:S.typography.fontFamily,fontSize:"0.75rem"},...l},children:[p&&!u&&e.jsx(J,{sx:Ce,action:p}),u&&e.jsx(J,{sx:Ce,title:e.jsx(L,{variant:"h5",children:u}),action:p}),h&&e.jsx(Pt,{}),r&&e.jsx(oe,{sx:{flex:1,padding:.5,...i,"&:last-child":{paddingBottom:.5}},children:e.jsx(j,{sx:{width:"100%",height:"100%",position:"relative"},children:e.jsx(j,{sx:{width:"100%",height:"100%",position:"absolute"},children:o})})}),x&&e.jsx(we,{disableSpacing:!0,sx:{padding:.5},children:x})]})}),_s=({ctrl_id:t})=>{const[s,o]=m.useState(null),r=m.useRef(null);return m.useEffect(()=>(r.current||(r.current=M(`${k}/last_snapshot/${t}`)),r.current.on("last_snapshot",i=>{o(i)}),()=>{r.current&&(r.current.disconnect(),r.current=null)}),[t]),e.jsx(e.Fragment,{children:e.jsxs(G,{title:"Ultima Foto",children:[s!==null&&e.jsx(j,{component:"img",sx:{height:"100%",width:"100%",overflow:"hidden",borderRadius:"4px"},src:s}),s===null&&e.jsx(j,{component:"div",sx:{width:"100%",height:"100%",display:"grid",placeItems:"center"},children:e.jsx($,{severity:"info",variant:"outlined",children:"Caputura no disponible"})})]})})},Ss=({timePicked:t,datePicked:s,setDatePicked:o,setTimePicked:r})=>e.jsxs(T,{direction:"row",spacing:2,alignItems:"center",children:[e.jsx(Ae,{value:s,onChange:i=>o(i),slotProps:{textField:{size:"small",sx:{maxWidth:150,"& .MuiOutlinedInput-root":{"& fieldset":{}}}}}}),e.jsx(vs,{views:["hours"],ampm:!1,defaultValue:t,onChange:i=>r(i),slotProps:{textField:{size:"small",sx:{maxWidth:85,"& .MuiOutlinedInput-root":{"& fieldset":{}}}},digitalClockSectionItem:{}}})]}),ws=R(({className:t,...s})=>e.jsx(ze,{...s,classes:{popper:t}}))(({theme:t})=>({[`& .${Ye.tooltip}`]:{backgroundColor:t.palette.common.white,color:"rgba(0, 0, 0, 0.87)",boxShadow:t.shadows[1],fontSize:11}})),ys=({camaras:t,ctrl_id:s})=>{const o=A(d=>d.stream),r=A(d=>d.controllerSiteState),[i,n]=m.useState(null),c=z(),p=(d,l)=>{if(l!==null&&r.controller!==void 0){const u=t.find(h=>h.ip===l);n(l),u&&c(K({ctrl_id:s,cmr_id:u.cmr_id,tc_id:u.tc_id,descripcion:u.descripcion}))}};return m.useEffect(()=>{if(t.length>0&&r.controller!==void 0){const d=o.cmr_id;if(d!==null){const l=t.find(u=>u.cmr_id===d);l?(n(l.ip),c(K({ctrl_id:s,cmr_id:l.cmr_id,tc_id:l.tc_id,descripcion:l.descripcion})),c(te({isSelected:!0}))):(n(t[0].ip),c(K({ctrl_id:s,cmr_id:t[0].cmr_id,tc_id:t[0].tc_id,descripcion:t[0].descripcion})),c(te({isSelected:!0})))}else n(t[0].ip),c(K({ctrl_id:s,cmr_id:t[0].cmr_id,tc_id:t[0].tc_id,descripcion:t[0].descripcion})),c(te({isSelected:!0}))}},[t]),m.useEffect(()=>()=>{c(at())},[]),e.jsx(e.Fragment,{children:e.jsx(ye,{color:"primary",value:i,exclusive:!0,onChange:p,"aria-label":"Cameras",size:"small",children:t.map((d,l)=>e.jsx(X,{value:d.ip,"aria-label":"Camara 1",sx:{padding:0},children:e.jsx(ws,{title:d.descripcion,arrow:!0,children:e.jsxs(T,{direction:"row",spacing:1,alignItems:"center",padding:{lg:1,xs:.5},children:[e.jsx(is,{}),e.jsxs("div",{children:["Cam ",l+1]})]})})},d.ip))})})},Ts=()=>{const t=A(s=>s.stream);return e.jsx(e.Fragment,{children:e.jsx(j,{sx:{width:"100%",height:"100%",position:"relative"},children:t.cmr_id!==null&&t.ctrl_id!==null&&e.jsx(e.Fragment,{children:e.jsx(Ut,{ctrl_id:t.ctrl_id,cmr_id:t.cmr_id,q:"q1"},t.ctrl_id+t.cmr_id+"q1")})})})},Qe=m.forwardRef(({title:t,count:s,onChangeIndex:o,current_index:r},i)=>{const[n,c]=m.useState(1),p=g=>{c(g.target.value)},d=()=>{o(0)},l=()=>{const g=r-n<0?0:r-n;o(g)},u=()=>{const g=r+n>s-1?s-1:r+n;o(g)},h=()=>{o(s-1)};return e.jsx(j,{component:"div",sx:{display:"flex",alignItems:"center",justifyContent:"flex-end",gap:1},ref:i,children:s>=0&&e.jsxs(e.Fragment,{children:[e.jsxs(L,{component:"p",color:"white",sx:{userSelect:"none"},children:[t," :"]}),e.jsxs(ie,{id:"control-select",name:"control-select",value:n,onChange:p,size:"small",inputProps:{"aria-label":"Select RowsPerPage"},SelectDisplayProps:{style:{paddingTop:5,paddingBottom:5,borderColor:"white"}},sx:{color:"white","& .MuiOutlinedInput-notchedOutline":{borderColor:"white"},"& .MuiSvgIcon-root":{color:"white"}},children:[e.jsx(O,{value:1,children:1}),e.jsx(O,{value:10,children:10}),e.jsx(O,{value:20,children:20}),e.jsx(O,{value:50,children:50})]}),e.jsx(L,{component:"div",color:"white",sx:{userSelect:"none"},children:`${r+1} de ${s}`}),e.jsxs(j,{sx:{flexShrink:0,ml:2.5},children:[e.jsx(F,{onClick:d,disabled:r===0,"aria-label":"first page",children:e.jsx(Bt,{})}),e.jsx(F,{onClick:l,disabled:r===0,"aria-label":"previous page",children:e.jsx(Gt,{})}),e.jsx(F,{onClick:u,disabled:r===s-1,"aria-label":"next page",children:e.jsx(Wt,{})}),e.jsx(F,{onClick:h,disabled:r===s-1,"aria-label":"last page",children:e.jsx(qt,{})})]})]})})}),ks=({slides:t})=>{const[s,o]=m.useState([]),[r,i]=m.useState(0),[n]=lt(),c=async()=>{if(s.length>0&&s[r])try{const u=s[r],h=`motion_capture_${u.cmr_id}_${Date.now()}.jpg`,g=await n({filePath:u.ruta}).unwrap(),x=document.createElement("a");x.href=g,x.download=h,x.style.display="none",document.body.appendChild(x),x.click(),document.body.removeChild(x)}catch(u){console.error("Ocurrio un error al descargar imagen",u)}},p=z(),d=u=>{u.currentTarget===u.target&&p(Z())},l=u=>{i(u)};return m.useEffect(()=>{o(t),i(0)},[t]),e.jsx(e.Fragment,{children:e.jsx(j,{sx:{width:"100%",height:"100%",position:"absolute"},children:e.jsxs(j,{sx:{position:"relative",height:"100%",width:"100%"},children:[e.jsx(j,{component:"div",sx:{position:"absolute",bottom:0,left:0,width:"100%",background:"rgba(0, 0, 0, 0.3)",py:1,"&: hover":{}},children:e.jsxs(T,{spacing:1,direction:"row",alignItems:"center",justifyContent:"center",sx:{position:"relative"},onDoubleClickCapture:d,children:[e.jsx(Qe,{title:"N° Fotos",count:s.length,current_index:r,onChangeIndex:l}),e.jsx(F,{"aria-label":"back",sx:{position:"absolute",bottom:"cacl(50% - 23px)",left:10,cursor:"pointer"},onClick:c,children:e.jsx(as,{sx:{color:"#FD8D14",fontSize:30}})})]})}),s.length>0&&s[r]&&e.jsx(j,{component:"img",sx:{height:"100%",overflow:"hidden",width:"100%",borderRadius:"4px",userSelect:"none"},src:`${k+"/"+s[r].ruta}`,onDoubleClickCapture:d})]})})})},Ds="/assets/emptyData-e7a50cc8.svg",Ke=({children:t})=>e.jsxs(T,{spacing:1,alignItems:"center",children:[e.jsx("img",{src:Ds,alt:"",width:100}),e.jsx(L,{component:"p",variant:"body1",children:t&&t||"No data"})]}),Ms=({data:t})=>{const{cmr_id:s,ctrl_id:o,date:r,hour:i}=t,{isError:n,isSuccess:c,isLoading:p,data:d}=Te({ctrl_id:o,date:r,hour:i,tipo:0,cmr_id:s}),l=z(),u=h=>{h.currentTarget===h.target&&l(Z())};return e.jsxs(j,{sx:{width:"100%",height:"100%",position:"relative",display:"flex",alignItems:"center",justifyContent:"center"},onDoubleClickCapture:u,children:[p&&e.jsx(ke,{children:"Cargando Fotos"}),n&&e.jsx(He,{children:"Error no se encontraron imagenes!"}),c&&d.length>0&&e.jsx(ks,{slides:d}),c&&d.length==0&&e.jsx(Ke,{children:"No se encontraron fotos."})]})},Ps=({slides:t})=>{const[s,o]=m.useState([]),[r,i]=m.useState(0),n=z(),c=u=>{u.currentTarget===u.target&&n(Z())},p=u=>{i(u)},d=m.useRef(null),l=m.useMemo(()=>d.current?`calc( 50% - ${d.current.getBoundingClientRect().width*.5}px )`:0,[d.current]);return m.useEffect(()=>{o(t),i(0)},[t]),e.jsx(e.Fragment,{children:e.jsx(j,{sx:{width:"100%",height:"100%",position:"absolute"},children:e.jsxs(j,{sx:{position:"relative",height:"100%",width:"100%"},children:[s.length>0&&s[r]&&e.jsx(j,{component:"video",sx:{height:"100%",overflow:"hidden",width:"100%",borderRadius:"4px"},controls:!0,src:`${k+"/"+s[r].ruta}`,onDoubleClickCapture:c,onClick:u=>{u.preventDefault(),u.detail==2&&u.stopPropagation()}}),e.jsx(j,{component:"div",sx:{position:"absolute",bottom:"7%",left:l},children:e.jsx(Qe,{ref:d,title:"N° Videos",count:s.length,current_index:r,onChangeIndex:p})})]})})})},Rs=({data:t})=>{const{cmr_id:s,ctrl_id:o,date:r,hour:i}=t,{isError:n,isSuccess:c,isLoading:p,data:d}=Te({ctrl_id:o,date:r,hour:i,tipo:1,cmr_id:s}),l=z(),u=h=>{h.currentTarget===h.target&&l(Z())};return e.jsxs(j,{sx:{width:"100%",height:"100%",position:"relative",display:"flex",alignItems:"center",justifyContent:"center"},onDoubleClickCapture:u,children:[p&&e.jsx(ke,{children:"Cargando videos"}),n&&e.jsx(He,{children:"Error no se encontraron videos!"}),c&&d.length>0&&e.jsx(Ps,{slides:d}),c&&d.length==0&&e.jsx(Ke,{children:"No se encontraron videos."})]})},Is=({option:t,handleChangeOption:s})=>e.jsxs(ye,{color:"primary",value:t,exclusive:!0,onChange:s,"aria-label":"Options",size:"small",children:[e.jsx(X,{value:"vivo","aria-label":"Vivo",children:e.jsxs(T,{direction:"row",alignItems:"center",spacing:1,children:[e.jsx(us,{}),e.jsx("span",{children:" Vivo"})]})}),e.jsx(X,{value:"video","aria-label":"Video",children:e.jsxs(T,{direction:"row",alignItems:"center",spacing:1,children:[e.jsx(ds,{}),e.jsx("span",{children:" Video"})]})}),e.jsx(X,{value:"fotos","aria-label":"Fotos",children:e.jsxs(T,{direction:"row",alignItems:"center",spacing:1,children:[e.jsx(ls,{}),e.jsx("span",{children:" Fotos"})]})})]});var ue={},Fs=Me;Object.defineProperty(ue,"__esModule",{value:!0});var Xe=ue.default=void 0,Ls=Fs(De()),$s=e;Xe=ue.default=(0,Ls.default)((0,$s.jsx)("path",{d:"M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2m-6 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2M9 8V6c0-1.66 1.34-3 3-3s3 1.34 3 3v2z"}),"LockRounded");var me={},Es=Me;Object.defineProperty(me,"__esModule",{value:!0});var Je=me.default=void 0,Os=Es(De()),As=e;Je=me.default=(0,Os.default)((0,As.jsx)("path",{d:"M12 13c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2m6-5h-1V6c0-2.76-2.24-5-5-5-2.28 0-4.27 1.54-4.84 3.75-.14.54.18 1.08.72 1.22.53.14 1.08-.18 1.22-.72C9.44 3.93 10.63 3 12 3c1.65 0 3 1.35 3 3v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2m0 11c0 .55-.45 1-1 1H7c-.55 0-1-.45-1-1v-8c0-.55.45-1 1-1h10c.55 0 1 .45 1 1z"}),"LockOpenRounded");const zs=t=>{const[s,o]=m.useState(null),[r,i]=m.useState(null),[n,c]=m.useState(null),p=m.useRef(null),[d,l]=m.useState(!1),[u,h]=m.useState(null),[g,x]=m.useState(void 0);return m.useEffect(()=>(t!==void 0&&(p.current||(p.current=M(`${k}/controller_state/${t}`)),p.current.on("controller_info",f=>{const{modo:_,seguridad:S,conectado:D,disableSecurityButton:w}=f;i(_),o(S),c(D),x(w)}),p.current.on("update_controller",f=>{const{conectado:_,modo:S,seguridad:D}=f;c(w=>_!==w?_:w),i(w=>S!==w?S:w),o(w=>D!==w?D:w)}),p.current.on("update_security_button",f=>{x(_=>_!==f?f:_)}),p.current.on("connect_error",f=>{l(!0),h(f.message)})),()=>{p.current&&(p.current.disconnect(),p.current=null),o(null),i(null),l(!1),h(null),c(null)}),[t]),{isError:d,error:u,socket:p,mode:r,security:s,connected:n,disableSecurity:g}},Ys=R(({className:t,...s})=>e.jsx(ze,{...s,classes:{popper:t}}))(({theme:t})=>({[`& .${Ye.tooltip}`]:{backgroundColor:t.palette.common.white,color:"rgba(0, 0, 0, 0.87)",boxShadow:t.shadows[3],fontSize:11}})),Vs=({ctrl_id:t})=>{const{mode:s,security:o,socket:r,disableSecurity:i}=zs(t),n=()=>{r.current&&(o===E.Armado?r.current.emit("setSecurity",E.Desarmado):r.current.emit("setSecurity",E.Armado))};return e.jsx(e.Fragment,{children:s===B.Seguridad&&e.jsx(Ys,{title:o===E.Armado?"Armado":"Desarmado",placement:"left",children:e.jsx("span",{children:e.jsx(F,{onClick:n,disabled:i===void 0?!0:i,children:o===E.Armado?e.jsx(Xe,{}):e.jsx(Je,{})})})})})},Hs=()=>{const t=A(s=>s.controllerSiteState);return e.jsx(e.Fragment,{children:e.jsx(T,{direction:"row",spacing:1,alignItems:"center",children:t.controller!==void 0&&(t.controller.conectado===ct.Conectado?e.jsxs(e.Fragment,{children:[e.jsx(Qt,{color:"success",fontSize:"large"}),e.jsx(L,{children:"Conectado"})]}):e.jsxs(e.Fragment,{children:[e.jsx(Kt,{color:"error",fontSize:"large"}),e.jsx(L,{children:"Desconectado"})]}))})})},Ns=({ctrl_id:t})=>{const s=A(x=>x.stream),{isError:o,isSuccess:r,data:i}=dt({ctrl_id:t},{refetchOnMountOrArgChange:!0}),[n,c]=m.useState("vivo"),p=(x,f)=>{f!==null&&c(f)},[d,l]=m.useState(y()),[u,h]=m.useState(y()),g=m.useRef(null);return e.jsxs(ut,{children:[e.jsx(J,{ref:g,sx:{p:.5,"& .MuiCardHeader-action":{m:"auto auto",display:"flex"},overflow:"auto",margin:0},title:e.jsx(Hs,{}),action:e.jsx("div",{style:{width:"100%",height:"100%"},children:e.jsxs(T,{direction:"row",spacing:2,alignItems:"center",children:[(n==="fotos"||n==="video")&&e.jsx(Ss,{timePicked:u,datePicked:d,setDatePicked:l,setTimePicked:h}),r&&i.length>0&&e.jsx(ys,{camaras:i,ctrl_id:t}),o&&e.jsx($,{variant:"filled",severity:"error",children:"Error al cargar camaras."})]})})}),e.jsxs(oe,{sx:{flex:1,padding:.5,"&:last-child":{paddingBottom:.5}},children:[n==="vivo"&&s.ctrl_id!==null&&s.cmr_id!==null&&r&&i.length>0&&e.jsx(Ts,{},s.ctrl_id+s.cmr_id),n==="fotos"&&s.ctrl_id!==null&&s.cmr_id!==null&&e.jsx(Ms,{data:{cmr_id:s.cmr_id,ctrl_id:s.ctrl_id,date:d.format("YYYY-MM-DD"),hour:Number(u.format("HH"))}},s.ctrl_id+s.cmr_id),n==="video"&&s.ctrl_id!==null&&s.cmr_id!==null&&e.jsx(Rs,{data:{cmr_id:s.cmr_id,ctrl_id:s.ctrl_id,date:d.format("YYYY-MM-DD"),hour:Number(u.format("HH"))}},s.ctrl_id+s.cmr_id)]}),e.jsx(we,{disableSpacing:!0,sx:{padding:.5},children:e.jsxs(T,{width:"100%",direction:"row",alignItems:"center",spacing:2,justifyContent:"space-between",children:[e.jsx(Is,{option:n,handleChangeOption:p}),e.jsx(Vs,{ctrl_id:t})]})})]})},Us=({ctrl_id:t})=>{const[s,o]=m.useState([]),r=m.useRef(null),i=ne(),[n,c]=m.useState(B.Seguridad),[p,d]=m.useState(E.Desarmado);return m.useEffect(()=>(r.current||(r.current=M(`${k}/pin_entrada/${t}`)),r.current.on("list_pines_entrada",l=>{o(l)}),r.current.on("controller_mode",l=>{c(l)}),r.current.on("controller_security",l=>{d(l)}),r.current.on("item_pin_entrada",l=>{o(u=>{if(l.activo==1){const h=u.filter(g=>g.pe_id!=l.pe_id);return h.unshift(l),h}return u})}),()=>{r.current&&(r.current.disconnect(),r.current=null)}),[t]),e.jsx(e.Fragment,{children:e.jsxs(Se,{sx:{display:"flex",flexDirection:"column",height:"100%",width:"100%",border:n===B.Seguridad?"2px solid":"1px solid",borderRadius:2,backgroundImage:"inherit",borderColor:n===B.Seguridad?p===E.Armado?"green":"darkgray":i.palette.mode==="dark"?i.palette.divider:i.palette.grey.A800,boxShadow:"inherit",":hover":{boxShadow:"inherit"},"& pre":{m:0,p:"16px !important",fontFamily:i.typography.fontFamily,fontSize:"0.75rem"}},children:[e.jsx(J,{title:"Site",sx:{p:.5,"& .MuiCardHeader-action":{m:"auto auto",display:"flex"}}}),e.jsx(oe,{sx:{flex:1,padding:.5,"&:last-child":{paddingBottom:.5}},children:e.jsx(j,{sx:{width:"100%",height:"100%",position:"relative"},children:e.jsx(j,{sx:{width:"100%",height:"100%",position:"absolute"},children:e.jsx(W,{sx:{width:"100%",height:"100%","& .simplebar-content":{width:"100%",height:"100%",display:"grid",placeItems:"center"}},children:e.jsxs(b,{container:!0,rowSpacing:1,columnSpacing:2,width:"100%",children:[s.length===0&&e.jsx(b,{size:{xs:12},sx:{display:"grid",placeItems:"center"},children:e.jsx($,{severity:"warning",variant:"outlined",children:"Asignar al menos un pin de entrada"})}),s.map((l,u,h)=>{const g=e.jsxs(T,{direction:"row",spacing:1,alignItems:"center",justifyContent:"space-between",children:[e.jsx("div",{children:ae(l.descripcion,20)}),e.jsx(Xt,{state:n===B.Seguridad?l.estado===1?"warning":"active":l.estado===1?"active":"disable"})]});return h.length==1?e.jsxs(m.Fragment,{children:[e.jsx(b,{size:{xs:3}}),e.jsx(b,{size:{xs:12},children:g}),e.jsx(b,{size:{xs:3}})]},t+l.pe_id):e.jsx(b,{size:{xs:12,lg:6},children:g},t+l.pe_id)})]})})})})})]})})},Bs=R(Ne)(({theme:t})=>({border:"1px solid",borderRadius:2,borderColor:t.palette.mode==="dark"?t.palette.divider:t.palette.grey.A800,backgroundColor:t.palette.background.paper,boxShadow:" rgba(0, 0, 0, 0.2) 0px 2px 1px -1px, rgba(0, 0, 0, 0.14) 0px 1px 1px 0px, rgba(0, 0, 0, 0.12) 0px 1px 3px 0px",backgroundImage:t.palette.mode==="dark"?"linear-gradient(rgba(255, 255, 255, 0.05), rgba(255, 255, 255, 0.05))":"none"})),qs=({ctrl_id:t})=>{const[s,o]=m.useState([]),r=m.useRef(null);return m.useEffect(()=>(r.current||(r.current=M(`${k}/modulo_energia/${t}`)),r.current.on("initial_list_energia",i=>{o(i)}),r.current.on("list_energia",(i,n)=>{n==="add"&&o(c=>c.some(d=>d.me_id===i.me_id)?c:[...c,i].sort((u,h)=>u.me_id-h.me_id)),n==="delete"&&o(c=>c.filter(d=>d.me_id!==i.me_id))}),()=>{r.current&&(r.current.disconnect(),r.current=null)}),[t]),e.jsx(e.Fragment,{children:e.jsxs(j,{component:"div",sx:{width:"100%",height:"100%",display:"grid",placeItems:"center"},children:[s.length===0&&e.jsx($,{severity:"warning",variant:"outlined",children:"Asignar al menos un modulo de energia"}),s.length>0&&e.jsx(Ue,{component:Be,variant:"outlined",sx:{height:"100%",width:"100%",overflowY:"auto"},children:e.jsx(W,{sx:{width:"100%",height:"100%","& .simplebar-content":{width:"100%",height:"100%",display:"grid",placeItems:"center"}},children:e.jsxs(Bs,{"aria-label":"customized table",stickyHeader:!0,size:"small",sx:{position:"relative"},children:[e.jsx(ce,{children:e.jsxs(Y,{children:[e.jsx(v,{children:"N°"}),e.jsx(v,{children:"Amp (A)"}),e.jsx(v,{children:"Volt (V)"}),e.jsx(v,{children:"Pot (W)"}),e.jsx(v,{children:"kWh"})]})}),e.jsx(de,{children:r.current!==null&&s.map((i,n)=>r.current!==null?e.jsx(Gs,{index:n,dataEnergia:i,socket:r.current},i.me_id):null)})]})})})]})})},Gs=({dataEnergia:t,index:s,socket:o})=>{const[r,i]=m.useState(t);return o.on("energia",n=>{n.me_id===t.me_id&&i(n)}),e.jsxs(Y,{children:[e.jsx(v,{component:"th",scope:"row",children:s+1}),e.jsx(v,{children:r.amperaje}),e.jsx(v,{children:r.voltaje}),e.jsx(v,{children:r.potenciaw}),e.jsx(v,{children:r.potenciakwh})]})},Ws=({date:t,registerData:s,info:o})=>{const[r,i]=m.useState({configs:{chart:{height:350,type:"line",zoom:{enabled:!1},background:"#121212",id:"temperature-graph-chart",toolbar:{show:!0,export:{png:{filename:`grafica_temperatura_${encodeURIComponent(o.nodo)}_${encodeURIComponent(o.st_id)}_${encodeURIComponent(o.ubicacion)}_${encodeURIComponent(y(t,"YYYY-MM-DD").unix())}`},svg:{filename:`grafica_temperatura_${encodeURIComponent(o.nodo)}_${encodeURIComponent(o.st_id)}_${encodeURIComponent(o.ubicacion)}_${encodeURIComponent(y(t,"YYYY-MM-DD").unix())}`}}}},dataLabels:{enabled:!1},stroke:{curve:"straight"},grid:{row:{colors:["#1e1e1e","transparent"],opacity:.5}},xaxis:{type:"datetime",tickAmount:24,min:new Date(y(t,"YYYY-MM-DD").startOf("day").toISOString()).getTime(),max:new Date(y(t,"YYYY-MM-DD").add(1,"day").startOf("day").toISOString()).getTime(),labels:{formatter:function(l,u){return y(u).format("HH:mm")},style:{colors:"#8c8c8c",cssClass:"apexcharts-xaxis-label"}},title:{text:"Tiempo ( h )",style:{color:"#8c8c8c"}},tooltip:{enabled:!1,formatter:(l,u)=>y(l).format("HH:mm:ss")}},yaxis:{min:0,decimalsInFloat:2,title:{text:"Temperatura ( °C )",style:{color:"#8c8c8c"}},labels:{style:{colors:"#8c8c8c",cssClass:"apexcharts-yaxis-label"}}},tooltip:{enabled:!0,x:{show:!0,formatter(l,u){return y(l).format("HH:mm:ss")}},y:{}}}}),n=ne(),c=n.palette.mode,[p,d]=m.useState([]);return m.useEffect(()=>{i(l=>{const u=c=="dark"?n.palette.text.secondary:n.palette.text.primary;return{configs:{...l.configs,chart:{...l.configs.chart,background:n.palette.background.default},grid:{row:{colors:[n.palette.background.paper,"transparent"],opacity:.5}},xaxis:{...l.configs.xaxis,labels:{...l.configs.xaxis?l.configs.xaxis.labels:{},style:{...l.configs.xaxis&&l.configs.xaxis.labels?l.configs.xaxis.labels.style:{},colors:u,cssClass:"apexcharts-xaxis-label"}},title:{...l.configs.xaxis?l.configs.xaxis.title:{},style:{color:u}}},yaxis:{...l.configs.yaxis,title:{text:"Temperatura ( °C )",style:{color:u}},labels:{style:{colors:u,cssClass:"apexcharts-yaxis-label"}}}}}})},[c]),m.useEffect(()=>{d([{name:"temperatura",data:s}]),i(l=>({configs:{...l.configs,xaxis:{...l.configs.xaxis,min:new Date(y(t,"YYYY-MM-DD").startOf("day").toISOString()).getTime(),max:new Date(y(t,"YYYY-MM-DD").add(1,"day").startOf("day").toISOString()).getTime()}}}))},[s]),m.useEffect(()=>{i(l=>({configs:{...l.configs,chart:{...l.configs.chart,toolbar:{show:!1,export:{png:{filename:`grafica_temperatura_${encodeURIComponent(o.nodo)}_${encodeURIComponent(o.st_id)}_${encodeURIComponent(o.ubicacion)}_${encodeURIComponent(y(t,"YYYY-MM-DD").unix())}`},svg:{filename:`grafica_temperatura_${encodeURIComponent(o.nodo)}_${encodeURIComponent(o.st_id)}_${encodeURIComponent(o.ubicacion)}_${encodeURIComponent(y(t,"YYYY-MM-DD").unix())}`}}}}}}))},[o,t]),e.jsx(e.Fragment,{children:e.jsx(Zt,{options:r.configs,series:p,type:"line",width:"100%",height:500})})};function Qs(t,s){const o=ApexCharts.getChartByID(t);o&&(s==="png"?o.exports.exportToPng():s==="svg"&&o.exports.exportToSVG())}const Ks=({open:t,setOpen:s,data:o})=>{const[r,i]=m.useState(y()),{nodo:n,ctrl_id:c,st_id:p,serie:d,ubicacion:l}=o,u=()=>{s(!1)},h=m.useRef(null);m.useEffect(()=>(t?h.current||(h.current=M(`${k}/sensor_temperatura/${c}/${p}`)):h.current&&(h.current.disconnect(),h.current=null),()=>{h.current&&(h.current.disconnect(),h.current=null)}),[t,o]);const[g,{data:x,isSuccess:f}]=mt(),_=()=>{g({ctrl_id:c,st_id:p,date:r.format("YYYY-MM-DD")})};return e.jsx(e.Fragment,{children:e.jsxs(pt,{fullWidth:!0,maxWidth:"lg",open:t,onClose:u,sx:{"& .MuiDialog-paper":{backgroundColor:"background.paper",backgroundImage:"inherit"}},children:[e.jsx(ht,{children:e.jsx(L,{component:"div",variant:"h5",children:"Gráfica Temperatura"})}),e.jsxs(xt,{children:[e.jsxs(os,{children:["Nodo: ",n," , Ubicacion: ",l," , Serie: ",d]}),e.jsxs(T,{direction:"row",justifyContent:"end",alignItems:"center",spacing:2,marginBottom:2,children:[e.jsx(Ae,{value:r,onChange:S=>{i(S)},slotProps:{textField:{size:"small",sx:{maxWidth:150}}}}),e.jsx(F,{"aria-label":"get register",onClick:_,color:"primary",children:e.jsx(gt,{})})]}),e.jsx(Ws,{date:r.format("YYYY-MM-DD"),registerData:f&&x?x:[],info:o})]}),e.jsxs(ft,{children:[e.jsx(xe,{variant:"contained",onClick:()=>{Qs("temperature-graph-chart","png")},startIcon:e.jsx(Jt,{}),children:"Descargar"}),e.jsx(xe,{variant:"contained",color:"error",onClick:u,children:"Cerrar"})]})]})})},Xs=({ctrl_id:t})=>e.jsx(e.Fragment,{children:e.jsx(j,{sx:{width:"100%",height:"100%"},children:e.jsx(W,{sx:{width:"100%",height:"100%","& .simplebar-content":{width:"100%",height:"100%",display:"grid",placeItems:"center"}},children:e.jsx(Js,{ctrl_id:Number(t)})})})}),Js=({ctrl_id:t})=>{const{xregion:s,xnodo:o}=Pe(),[r,i]=m.useState([]),n=m.useRef(null),[c,p]=m.useState(!1),[d,l]=m.useState(null),u=h=>{l(h),p(!0)};return m.useEffect(()=>(n.current||(n.current=M(`${k}/sensor_temperatura/${t}`)),n.current.on("initial_list_temperature",h=>{i(h)}),n.current.on("list_temperature",(h,g)=>{g==="add"&&i(x=>x.some(_=>_.st_id===h.st_id)?x:[...x,h].sort((D,w)=>D.st_id-w.st_id)),g==="delete"&&i(x=>x.filter(_=>_.st_id!==h.st_id))}),()=>{n.current&&(n.current.disconnect(),n.current=null)}),[t]),e.jsxs(e.Fragment,{children:[e.jsxs(b,{container:!0,rowSpacing:1,columnSpacing:2,sx:{width:"100%"},children:[r.length===0&&e.jsx(b,{size:{xs:12},sx:{display:"grid",placeItems:"center"},children:e.jsx($,{severity:"warning",variant:"outlined",children:"Asignar al menos un sensor de temperatura"})}),n.current!==null&&r.map((h,g,x)=>{if(n.current===null)return null;const f=e.jsxs(T,{direction:"row",spacing:1,alignItems:"center",justifyContent:"space-between",children:[e.jsx(Zs,{dataViewer:h,socket:n.current}),e.jsx(F,{size:"small","aria-label":"Temperature Graph",color:"primary",onClick:()=>u({...h,nodo:o,region:s,ctrl_id:t}),children:e.jsx(cs,{fontSize:"small"})})]});return x.length===1?e.jsxs(b,{container:!0,sx:{width:"100%"},children:[e.jsx(b,{size:{xs:3}}),e.jsx(b,{size:{xs:6},children:f}),e.jsx(b,{size:{xs:3}})]},t+h.st_id):e.jsx(b,{size:{xs:12,lg:6},children:f},t+h.st_id)})]}),d&&c&&e.jsx(Ks,{open:c,setOpen:p,data:d})]})},Zs=({dataViewer:t,socket:s})=>{const[o,r]=m.useState(t);return s.on("temperature",i=>{t.st_id===i.st_id&&r(i)}),e.jsx(e.Fragment,{children:e.jsxs(T,{direction:"row",spacing:1,alignItems:"center",justifyContent:"space-between",sx:{flex:1},children:[e.jsx("span",{children:`${ae(o.ubicacion,15)}:`}),e.jsxs(j,{children:[o.actual,"°C"]})]})})},er=({ctrl_id:t,region:s})=>{const o=bt(),r=z(),[i,n]=m.useState("accesos"),c=p=>{n(p.target.value)};return e.jsx(G,{title:e.jsxs(ie,{size:"small",value:i,onChange:c,placeholder:"select-tipo-prioridad",inputProps:{id:"select-prioridad"},children:[e.jsx(O,{value:"accesos",children:"Accesos"}),e.jsx(O,{value:"alarmas",children:"Alarmas"})]}),secondary:e.jsx(jt,{component:"button",underline:"none",onClick:()=>{r(Ct(s)),r(vt(t)),r(_t(i==="accesos"?"acceso":"entrada")),r(St(y().startOf("day").format("YYYY-MM-DD HH:mm:ss"))),r(wt(y().endOf("day").format("YYYY-MM-DD HH:mm:ss"))),o("/logs")},children:"Ver Mas"}),children:e.jsx(Ue,{component:Be,variant:"outlined",sx:{height:"100%",width:"100%",overflowY:"auto"},children:e.jsxs(W,{sx:{width:"100%",height:"100%","& .simplebar-content":{width:"100%",height:"100%",display:"grid",placeItems:"center"}},children:[i==="accesos"&&e.jsx(tr,{ctrl_id:t}),i==="alarmas"&&e.jsx(sr,{ctrl_id:t})]})})})},Ze=R(Ne)(({theme:t})=>({border:"1px solid",borderRadius:2,borderColor:t.palette.mode==="dark"?t.palette.divider:t.palette.grey.A800,backgroundColor:t.palette.background.paper,boxShadow:" rgba(0, 0, 0, 0.2) 0px 2px 1px -1px, rgba(0, 0, 0, 0.14) 0px 1px 1px 0px, rgba(0, 0, 0, 0.12) 0px 1px 3px 0px",backgroundImage:t.palette.mode==="dark"?"linear-gradient(rgba(255, 255, 255, 0.05), rgba(255, 255, 255, 0.05))":"none"})),tr=({ctrl_id:t})=>{const[s,o]=m.useState([]),r=m.useRef(null);return m.useEffect(()=>(r.current||(r.current=M(`${k}/registro_acceso/${t}`)),r.current.on("list_registros_acceso",i=>{o(i)}),r.current.on("new_registro_acceso",i=>{o(n=>{const c=[i,...n];return c.length>5&&c.splice(5),c})}),()=>{r.current&&(r.current.disconnect(),r.current=null)}),[t]),e.jsxs(e.Fragment,{children:[s.length===0&&e.jsx($,{severity:"info",variant:"outlined",children:"Sin registros de acceso."}),s.length>0&&e.jsxs(Ze,{size:"small","aria-label":"a dense table",stickyHeader:!0,sx:{position:"relative"},children:[e.jsx(ce,{children:e.jsxs(Y,{children:[e.jsx(v,{children:"Personal"}),e.jsx(v,{children:"Autorización"}),e.jsx(v,{children:"Fecha"})]})}),e.jsx(de,{children:s.map((i,n)=>{const{autorizacion:c,fecha:p,personal:d,administrador:l}=i,u=Ve(p);return e.jsxs(Y,{children:[e.jsx(v,{children:e.jsx(es,{text:d!==void 0?`${d.nombre+" "+d.apellido}`:"no-identificado",maxLength:15,insertDots:!0})}),e.jsxs(v,{children:[c===1&&l===0&&"Autorizado",c===1&&l===1&&"Administrador",c===0&&"Denegado"]}),e.jsx(v,{children:u})]},n)})})]})]})},sr=({ctrl_id:t})=>{const[s,o]=m.useState([]),r=m.useRef(null);return m.useEffect(()=>(r.current||(r.current=M(`${k}/registro_entrada/${t}`)),r.current.on("list_registros_entrada",i=>{o(i)}),r.current.on("new_registro_entrada",i=>{o(n=>{const c=[i,...n];return c.length>5&&c.splice(5),c})}),()=>{r.current&&(r.current.disconnect(),r.current=null)}),[t]),e.jsxs(e.Fragment,{children:[s.length===0&&e.jsx($,{severity:"info",variant:"outlined",children:"Sin registros de alarma."}),s.length>0&&e.jsxs(Ze,{size:"small","aria-label":"a dense table",stickyHeader:!0,sx:{position:"relative"},children:[e.jsx(ce,{children:e.jsxs(Y,{children:[e.jsx(v,{children:"Pin"}),e.jsx(v,{children:"Estado"}),e.jsx(v,{children:"Fecha"})]})}),e.jsx(de,{children:s.map((i,n)=>{const{pin:c,estado:p,fecha:d}=i,l=Ve(d);return e.jsxs(Y,{children:[e.jsx(v,{children:c}),e.jsx(v,{children:p===0?"Desactivado":p===1?"Activado":p}),e.jsx(v,{children:l})]},n)})})]})]})};const rr=({ctrl_id:t})=>{const s=m.useRef(null),[o,r]=m.useState([]),[i,n]=m.useState(""),c=o.find(d=>String(d.es_id)===String(i)),p=d=>{n(d.target.value)};return m.useEffect(()=>{o.length>0&&i===""&&n(String(o[0].es_id)),o.find(l=>String(l.es_id)===i)===void 0&&(o.length>0?n(String(o[0].es_id)):n(""))},[o]),m.useEffect(()=>(s.current||(s.current=M(`${k}/pines_salida/${t}`)),s.current.on("equipos_salida",d=>{r(d)}),s.current.on("list_pines_salida",(d,l)=>{r(u=>u.find(({es_id:g})=>g===l.es_id)===void 0?[l,...u].sort((x,f)=>x.es_id-f.es_id):u)}),()=>{s.current&&(s.current.disconnect(),s.current=null)}),[t]),e.jsx(e.Fragment,{children:e.jsx(G,{title:"Control",secondary:e.jsx(yt,{size:"small",sx:{maxWidth:200},children:o.length>0&&e.jsx(ie,{id:"control-select",name:"control-select",value:i,onChange:p,size:"small",inputProps:{"aria-label":"Select Control"},children:o.map(d=>e.jsx(O,{value:d.es_id,children:d.actuador},d.es_id))})}),children:e.jsxs(j,{sx:{width:"100%",height:"100%",position:"relative"},children:[o.length===0&&e.jsx(j,{component:"div",sx:{width:"100%",height:"100%",display:"grid",placeItems:"center"},children:e.jsx($,{severity:"warning",variant:"outlined",children:"Asignar al menos un pin de salida"})}),c&&s.current&&e.jsx(nr,{ctrl_id:t,equipo_salida:c,socketRef:s.current},t+c.es_id)]})})})},nr=({equipo_salida:t,socketRef:s,ctrl_id:o})=>{const[r,i]=m.useState([]);return s.on("list_pines_salida",(n,c)=>{t.es_id===c.es_id&&i(n)}),m.useEffect(()=>{s.emit("initial_list_pines_salida",t.es_id)},[t.es_id]),e.jsx(e.Fragment,{children:e.jsx("div",{style:{height:"100%",width:"100%",position:"absolute",top:0,left:0},children:e.jsx(W,{sx:{width:"100%",height:"100%","& .simplebar-content":{width:"100%",height:"100%",display:"grid",placeItems:"center"}},children:e.jsx("div",{className:"grid-container-pinsal-list",children:r.map(n=>e.jsx(or,{pinSalItem:n,socketRef:s,ctrl_id:o},n.ps_id))})})})})},or=({pinSalItem:t,socketRef:s,ctrl_id:o})=>{const[r,i]=m.useState(t);return m.useEffect(()=>{s.emit("initial_item_pin_salida",t.ps_id),s.on("item_pin_salida",n=>{t.ps_id===n.ps_id&&i(n)})},[t.ps_id]),e.jsx(e.Fragment,{children:e.jsxs("div",{className:"grid-item-pinsal",children:[e.jsx("span",{children:`${ae(r.descripcion,20)}:`}),e.jsxs("div",{className:"button-group",children:[e.jsx("button",{className:"button_item",onClick:()=>{const{pin:n,es_id:c,ps_id:p}=r;s.emit("orden_pin_salida",{action:0,ctrl_id:o,es_id:c,pin:n,ps_id:p})},style:{backgroundColor:r.orden===0?"#d9d9d9":"transparent",color:r.orden===0?"black":"#1668dc"},children:"A"}),e.jsx("button",{className:"button_item",onClick:()=>{const{pin:n,es_id:c,ps_id:p}=r;s.emit("orden_pin_salida",{action:1,ctrl_id:o,es_id:c,pin:n,ps_id:p})},style:{backgroundColor:r.orden===1?"#49aa19":"transparent",color:r.orden===1?"white":"#1668dc"},children:"ON"}),e.jsx("button",{className:"button_item",onClick:()=>{const{pin:n,es_id:c,ps_id:p}=r;s.emit("orden_pin_salida",{action:-1,ctrl_id:o,es_id:c,pin:n,ps_id:p})},style:{backgroundColor:r.orden===-1?"#a61d24":"transparent",color:r.orden===-1?"white":"#1668dc"},children:"OFF"})]})]})})},Sr=()=>{const{xctrl_id:t}=Pe(),s=z(),o=m.useRef(null),r=A(n=>n.multimediaSlice),i=A(n=>n.controllerSiteState);return m.useEffect(()=>(t!==void 0&&(s(Tt({openItem:[`nodo-${t}`]})),o.current||(o.current=M(`${k}/controller_state/${t}`)),o.current.on("controller_info",n=>{s(ge(n))}),o.current.on("update_region",n=>{s(kt(n))}),o.current.on("update_controller",n=>{s(ge(n))}),o.current.on("error_message",n=>{s(fe(n.message))}),o.current.on("connect",()=>{s(Dt())}),o.current.on("connect_error",n=>{s(fe(`Socket connect error: ${n.message}`))})),()=>{o.current&&(o.current.disconnect(),o.current=null),s(Mt())}),[t]),e.jsxs(j,{sx:{width:"100%",height:"100%",padding:1,overflowY:"auto"},children:[i.isError&&e.jsx("div",{children:i.error??"Ocurrio un error al obtener el controlador"}),i.isSuccess&&i.controller!==void 0&&e.jsx(b,{container:!0,sx:{width:"100%",height:"100%",overflowY:"auto"},rowGap:1,children:e.jsxs(e.Fragment,{children:[e.jsx(b,{size:{xs:12},sx:{height:r.isExpandMultimedia?"100%":"calc(66.7% - 4px)"},children:e.jsxs(b,{container:!0,columnSpacing:1,sx:{height:"100%"},children:[e.jsx(b,{size:{xs:r.isExpandMultimedia?12:8},children:e.jsx(Ns,{ctrl_id:i.controller.ctrl_id})}),!r.isExpandMultimedia&&e.jsx(b,{size:{xs:4},sx:{height:"100%"},children:e.jsxs(b,{container:!0,sx:{width:"100%",height:"100%"},gap:1,children:[e.jsx(b,{size:{xs:12},sx:{width:"100%"},children:e.jsx(G,{title:"Temperaturas",children:e.jsx(Xs,{ctrl_id:i.controller.ctrl_id})})}),e.jsx(b,{size:{xs:12},sx:{width:"100%"},children:e.jsx(G,{title:"Energia",children:e.jsx(qs,{ctrl_id:i.controller.ctrl_id})})}),e.jsx(b,{size:{xs:12},sx:{width:"100%"},children:e.jsx(rr,{ctrl_id:i.controller.ctrl_id})})]})})]})}),!r.isExpandMultimedia&&e.jsx(b,{size:{xs:12},sx:{height:"calc(33.3% - 4px)"},children:e.jsxs(b,{container:!0,columnSpacing:1,sx:{height:"100%"},children:[e.jsx(b,{size:{xs:4},children:e.jsx(_s,{ctrl_id:i.controller.ctrl_id})}),e.jsx(b,{size:{xs:4},children:e.jsx(er,{ctrl_id:i.controller.ctrl_id,region:i.controller.region})}),e.jsx(b,{size:{xs:4},children:e.jsx(Us,{ctrl_id:i.controller.ctrl_id})})]})})]})},i.controller.ctrl_id)]})};export{Sr as NodoSite,Sr as default};
