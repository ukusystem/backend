import{r as d,N as D,M as N,s as E,aY as tt,W as _,V as F,aZ as et,P as U,j as e,Q as V,R as q,X as v,a_ as rt,a$ as ot,a as G,u as H,o as at,m as st,L as nt,h as it,i as lt,T as w,b0 as dt,x as Q,y as J,l as C,B as h,O as K,b1 as ct,e as ut,b2 as I,b3 as pt,b4 as P,b5 as gt,b6 as xt,J as ft,v as ht,K as $,w as mt}from"./index-D9tpZ6Qh.js";import{C as bt}from"./ControllerConnectIcon-7xwTbIHS.js";import{L as vt}from"./LockIcon-DTa8VVWu.js";import{S as yt,a as Ct}from"./StreamPlayer-DxVPa5U9.js";import{L as Bt}from"./ListItemButton-Pv68Be0T.js";function St(t){return d.Children.toArray(t).filter(r=>d.isValidElement(r))}function $t(t){return D("MuiToggleButton",t)}const y=N("MuiToggleButton",["root","disabled","selected","standard","primary","secondary","sizeSmall","sizeMedium","sizeLarge","fullWidth"]),X=d.createContext({}),Y=d.createContext(void 0);function jt(t,r){return r===void 0||t===void 0?!1:Array.isArray(r)?r.includes(t):t===r}const Rt=t=>{const{classes:r,fullWidth:o,selected:s,disabled:a,size:x,color:l}=t,g={root:["root",s&&"selected",a&&"disabled",o&&"fullWidth",`size${_(x)}`,l]};return q(g,$t,r)},Tt=E(tt,{name:"MuiToggleButton",slot:"Root",overridesResolver:(t,r)=>{const{ownerState:o}=t;return[r.root,r[`size${_(o.size)}`]]}})(F(({theme:t})=>({...t.typography.button,borderRadius:(t.vars||t).shape.borderRadius,padding:11,border:`1px solid ${(t.vars||t).palette.divider}`,color:(t.vars||t).palette.action.active,[`&.${y.disabled}`]:{color:(t.vars||t).palette.action.disabled,border:`1px solid ${(t.vars||t).palette.action.disabledBackground}`},"&:hover":{textDecoration:"none",backgroundColor:t.vars?`rgba(${t.vars.palette.text.primaryChannel} / ${t.vars.palette.action.hoverOpacity})`:v(t.palette.text.primary,t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},variants:[{props:{color:"standard"},style:{[`&.${y.selected}`]:{color:(t.vars||t).palette.text.primary,backgroundColor:t.vars?`rgba(${t.vars.palette.text.primaryChannel} / ${t.vars.palette.action.selectedOpacity})`:v(t.palette.text.primary,t.palette.action.selectedOpacity),"&:hover":{backgroundColor:t.vars?`rgba(${t.vars.palette.text.primaryChannel} / calc(${t.vars.palette.action.selectedOpacity} + ${t.vars.palette.action.hoverOpacity}))`:v(t.palette.text.primary,t.palette.action.selectedOpacity+t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:t.vars?`rgba(${t.vars.palette.text.primaryChannel} / ${t.vars.palette.action.selectedOpacity})`:v(t.palette.text.primary,t.palette.action.selectedOpacity)}}}}},...Object.entries(t.palette).filter(rt()).map(([r])=>({props:{color:r},style:{[`&.${y.selected}`]:{color:(t.vars||t).palette[r].main,backgroundColor:t.vars?`rgba(${t.vars.palette[r].mainChannel} / ${t.vars.palette.action.selectedOpacity})`:v(t.palette[r].main,t.palette.action.selectedOpacity),"&:hover":{backgroundColor:t.vars?`rgba(${t.vars.palette[r].mainChannel} / calc(${t.vars.palette.action.selectedOpacity} + ${t.vars.palette.action.hoverOpacity}))`:v(t.palette[r].main,t.palette.action.selectedOpacity+t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:t.vars?`rgba(${t.vars.palette[r].mainChannel} / ${t.vars.palette.action.selectedOpacity})`:v(t.palette[r].main,t.palette.action.selectedOpacity)}}}}})),{props:{fullWidth:!0},style:{width:"100%"}},{props:{size:"small"},style:{padding:7,fontSize:t.typography.pxToRem(13)}},{props:{size:"large"},style:{padding:15,fontSize:t.typography.pxToRem(15)}}]}))),kt=d.forwardRef(function(r,o){const{value:s,...a}=d.useContext(X),x=d.useContext(Y),l=et({...a,selected:jt(r.value,s)},r),g=U({props:l,name:"MuiToggleButton"}),{children:m,className:n,color:c="standard",disabled:L=!1,disableFocusRipple:B=!1,fullWidth:p=!1,onChange:j,onClick:R,selected:b,size:O="medium",value:S,...z}=g,T={...g,color:c,disabled:L,disableFocusRipple:B,fullWidth:p,size:O},M=Rt(T),A=u=>{R&&(R(u,S),u.defaultPrevented)||j&&j(u,S)},f=x||"";return e.jsx(Tt,{className:V(a.className,M.root,n,f),disabled:L,focusRipple:!B,ref:o,onClick:A,onChange:j,value:S,ownerState:T,"aria-pressed":b,...z,children:m})});function wt(t){return D("MuiToggleButtonGroup",t)}const i=N("MuiToggleButtonGroup",["root","selected","horizontal","vertical","disabled","grouped","groupedHorizontal","groupedVertical","fullWidth","firstButton","lastButton","middleButton"]),Lt=t=>{const{classes:r,orientation:o,fullWidth:s,disabled:a}=t,x={root:["root",o,s&&"fullWidth"],grouped:["grouped",`grouped${_(o)}`,a&&"disabled"],firstButton:["firstButton"],lastButton:["lastButton"],middleButton:["middleButton"]};return q(x,wt,r)},Ot=E("div",{name:"MuiToggleButtonGroup",slot:"Root",overridesResolver:(t,r)=>{const{ownerState:o}=t;return[{[`& .${i.grouped}`]:r.grouped},{[`& .${i.grouped}`]:r[`grouped${_(o.orientation)}`]},{[`& .${i.firstButton}`]:r.firstButton},{[`& .${i.lastButton}`]:r.lastButton},{[`& .${i.middleButton}`]:r.middleButton},r.root,o.orientation==="vertical"&&r.vertical,o.fullWidth&&r.fullWidth]}})(F(({theme:t})=>({display:"inline-flex",borderRadius:(t.vars||t).shape.borderRadius,variants:[{props:{orientation:"vertical"},style:{flexDirection:"column",[`& .${i.grouped}`]:{[`&.${i.selected} + .${i.grouped}.${i.selected}`]:{borderTop:0,marginTop:0}},[`& .${i.firstButton},& .${i.middleButton}`]:{borderBottomLeftRadius:0,borderBottomRightRadius:0},[`& .${i.lastButton},& .${i.middleButton}`]:{marginTop:-1,borderTop:"1px solid transparent",borderTopLeftRadius:0,borderTopRightRadius:0},[`& .${i.lastButton}.${y.disabled},& .${i.middleButton}.${y.disabled}`]:{borderTop:"1px solid transparent"}}},{props:{fullWidth:!0},style:{width:"100%"}},{props:{orientation:"horizontal"},style:{[`& .${i.grouped}`]:{[`&.${i.selected} + .${i.grouped}.${i.selected}`]:{borderLeft:0,marginLeft:0}},[`& .${i.firstButton},& .${i.middleButton}`]:{borderTopRightRadius:0,borderBottomRightRadius:0},[`& .${i.lastButton},& .${i.middleButton}`]:{marginLeft:-1,borderLeft:"1px solid transparent",borderTopLeftRadius:0,borderBottomLeftRadius:0},[`& .${i.lastButton}.${y.disabled},& .${i.middleButton}.${y.disabled}`]:{borderLeft:"1px solid transparent"}}}]}))),Wt=d.forwardRef(function(r,o){const s=U({props:r,name:"MuiToggleButtonGroup"}),{children:a,className:x,color:l="standard",disabled:g=!1,exclusive:m=!1,fullWidth:n=!1,onChange:c,orientation:L="horizontal",size:B="medium",value:p,...j}=s,R={...s,disabled:g,fullWidth:n,orientation:L,size:B},b=Lt(R),O=d.useCallback((f,u)=>{if(!c)return;const k=p&&p.indexOf(u);let W;p&&k>=0?(W=p.slice(),W.splice(k,1)):W=p?p.concat(u):[u],c(f,W)},[c,p]),S=d.useCallback((f,u)=>{c&&c(f,p===u?null:u)},[c,p]),z=d.useMemo(()=>({className:b.grouped,onChange:m?S:O,value:p,size:B,fullWidth:n,color:l,disabled:g}),[b.grouped,m,S,O,p,B,n,l,g]),T=St(a),M=T.length,A=f=>{const u=f===0,k=f===M-1;return u&&k?"":u?b.firstButton:k?b.lastButton:b.middleButton};return e.jsx(Ot,{role:"group",className:V(b.root,x),ref:o,ownerState:R,...j,children:e.jsx(X.Provider,{value:z,children:T.map((f,u)=>e.jsx(Y.Provider,{value:A(u),children:f},u))})})}),_t=({ctrl_id:t})=>{const{isSuccess:r,data:o}=ot({ctrl_id:t},{refetchOnMountOrArgChange:!0}),s=G(l=>l.streamStore),a=H(),x=l=>{l!==null&&a(dt({ctrl_id:t,cmr_id:l.cmr_id,tc_id:l.tc_id,descripcion:l.descripcion}))};return e.jsx(at,{sx:{maxWidth:"100%",maxHeight:"100%"},children:e.jsx(st,{children:r&&o&&o.map((l,g)=>{var n,c;const m=((n=s.camera)==null?void 0:n.cmr_id)===l.cmr_id&&((c=s.camera)==null?void 0:c.ctrl_id)===t;return e.jsx(nt,{disablePadding:!0,children:e.jsxs(Bt,{onClick:()=>{x(l)},selected:m,sx:{minHeight:48,color:"text.primary","&:hover":{backgroundColor:"custom.trackBackground"},"&.Mui-selected":{backgroundColor:"tertiary.opacityMain",color:"text.primary","&:hover":{backgroundColor:"tertiary.opacityMain"}},justifyContent:"initial"},children:[e.jsx(it,{sx:{minWidth:40},children:e.jsx(yt,{sx:{width:24,height:"auto",color:"text.primary"}})}),e.jsx(lt,{sx:{overflow:"hidden"},primary:e.jsx(w,{variant:"body1",sx:{overflow:"hidden",width:"100%",textWrap:"nowrap",textOverflow:"ellipsis"},children:l.descripcion})})]})},g)})})})},zt=({ctrl_id:t})=>{const[r,o]=d.useState(null),s=d.useRef(null);return d.useEffect(()=>(s.current||(s.current=Q(`${J}/last_snapshot/${t}`,{withCredentials:!0})),s.current.on("last_snapshot",a=>{o(a)}),()=>{s.current&&(s.current.disconnect(),s.current=null)}),[t]),e.jsx(e.Fragment,{children:e.jsxs(C,{spacing:1,height:"100%",children:[e.jsx(w,{variant:"h5",color:"textPrimary",sx:{px:1,py:.5},children:"Última foto"}),e.jsxs(C,{flex:1,children:[r!==null&&e.jsx(h,{component:"img",sx:{height:"100%",width:"100%",objectFit:"contain"},src:r}),r===null&&e.jsx(C,{width:"100%",height:"100%",alignItems:"center",justifyContent:"center",children:e.jsx(w,{variant:"body1",textAlign:"center",sx:{textWrap:"pretty"},children:"Captura no disponible."})})]})]})})},Mt=()=>{const{camera:t}=G(r=>r.streamStore);return e.jsx(e.Fragment,{children:e.jsxs(h,{sx:{width:"100%",height:"100%",position:"relative"},children:[t&&e.jsx(e.Fragment,{children:e.jsx(Ct,{ctrl_id:t.ctrl_id,cmr_id:t.cmr_id,q:"q1",isContain:!0},t.ctrl_id+t.cmr_id+"q1")}),!t&&e.jsx(C,{width:"100%",height:"100%",alignItems:"center",justifyContent:"center",children:e.jsx(w,{variant:"body1",children:"Seleciona una camara."})})]})})},At=({ctrl_id:t})=>e.jsxs(h,{sx:{display:"grid",gridTemplateColumns:"250px auto 300px",gridTemplateRows:"repeat(5, 1fr)",gridColumnGap:"0px",gridRowGap:"0px",height:"100%",width:"100%",color:"white"},children:[e.jsx(h,{sx:{gridArea:"1 / 1 / 4 / 2",borderBottomWidth:1,borderBottomStyle:"solid",borderBottomColor:"divider",borderRightWidth:1,borderRightStyle:"solid",borderRightColor:"divider"},children:e.jsx(_t,{ctrl_id:t})}),e.jsx(h,{sx:{gridArea:"4 / 1 / 6 / 2",borderRightWidth:1,borderRightStyle:"solid",borderRightColor:"divider"},children:e.jsx(zt,{ctrl_id:t})}),e.jsx(h,{sx:{gridArea:"1 / 2 / 6 / 3"},children:e.jsx(Mt,{})}),e.jsx(h,{sx:{gridArea:"1 / 3 / 6 / 4",borderLeftWidth:1,borderLeftStyle:"solid",borderLeftColor:"divider"},children:e.jsx(K,{})})]}),Z=[{value:"cameras",name:"Cámaras"},{value:"tickets",name:"Tickets"},{value:"alarms",name:"Alarmas"},{value:"controls",name:"Controles"},{value:"access",name:"Accesos"},{value:"temperature-energy",name:"Temperatura y energía"}],Gt=t=>{const r=t.match(/^\/site\/[^/]+\/([^/]+)(?:\/.*)?$/);if(!r)return[!1,""];const o=r[1],s=Z.some(a=>a.value===o);return s?[s,o]:[!1,""]},Ft=()=>{const{ctrl_id:t}=ct(),{pathname:r}=ut(),o=d.useRef(null),s=H(),a=G(n=>n.controllerSiteState),x=()=>{o.current&&a.controller&&(a.controller.seguridad===$.Armado?o.current.emit("setSecurity",$.Desarmado):o.current.emit("setSecurity",$.Armado))},[l,g]=d.useState(Gt(r)[1]),m=(n,c)=>{c&&g(c)};return d.useEffect(()=>(t!==void 0&&(o.current||(o.current=Q(`${J}/controller_state/${t}`,{withCredentials:!0})),o.current.on("controller_info",n=>{s(I(n))}),o.current.on("update_region",n=>{s(pt(n))}),o.current.on("update_controller",n=>{s(I(n))}),o.current.on("error_message",n=>{s(P(n.message))}),o.current.on("connect",()=>{s(gt())}),o.current.on("connect_error",n=>{s(P(`Socket connect error: ${n.message}`))})),()=>{o.current&&(o.current.disconnect(),o.current=null),s(xt())}),[t]),e.jsxs(h,{sx:{width:"100%",height:"100%",overflow:"hidden"},children:[a.isError&&e.jsx("div",{children:a.error??"Ocurrio un error al obtener el controlador"}),a.isSuccess&&a.controller!==void 0&&e.jsxs(h,{sx:{maxWidth:1600,width:"100%",height:"100%",overflow:"hidden",mx:"auto",p:{xs:2,sm:3},display:"flex",flexDirection:"column",gap:2},children:[e.jsxs(C,{direction:"row",spacing:1,justifyContent:"space-between",alignItems:"center",children:[e.jsxs(C,{direction:"row",spacing:3,alignItems:"center",justifyContent:"center",children:[e.jsxs(C,{direction:"row",spacing:1,alignItems:"center",justifyContent:"center",children:[e.jsx(bt,{isConnect:a.controller.conectado===1,sx:{width:40,height:"auto"}}),e.jsx(w,{variant:"h5",sx:{textWrap:"nowrap"},children:a.controller.nodo})]}),a.controller.modo===ft.Seguridad&&e.jsx(ht,{variant:"label",fullWidth:!0,color:a.controller.seguridad===$.Armado?"tertiary":"warning",size:"medium",onClick:x,disabled:a.controller.disableSecurityButton===void 0?!0:a.controller.disableSecurityButton,startIcon:e.jsx(vt,{isOpen:a.controller.seguridad===$.Desarmado}),children:a.controller.seguridad===$.Armado?"Armado":"Desarmado"})]}),e.jsx(Wt,{color:"primary",value:l,exclusive:!0,onChange:m,"aria-label":"Platform",sx:{"& .MuiToggleButton-root":{borderWidth:1,borderStyle:"solid",borderColor:"tertiary.main",color:"text.primary",fontWeight:"bold",textTransform:"none","&:hover":{backgroundColor:"tertiary.opacityLight"},"&.Mui-selected":{backgroundColor:"tertiary.opacityDark",color:"text.primary","&:hover":{backgroundColor:"tertiary.opacityDark"}},"&:not(:last-of-type)":{borderRight:"none"},"&:first-of-type":{borderTopLeftRadius:"12px",borderBottomLeftRadius:"12px"},"&:last-of-type":{borderTopRightRadius:"12px",borderBottomRightRadius:"12px"}}},children:Z.map((n,c)=>e.jsx(kt,{value:n.value,component:mt,to:`/site/${t}/${n.value}`,sx:{whiteSpace:"nowrap"},children:n.name},c))})]}),e.jsxs(h,{sx:{flexGrow:1,overflow:"hidden",borderRadius:"8px",borderWidth:1,borderStyle:"solid",borderColor:"divider",backgroundColor:"background.paper"},children:[l!=="tickets"&&e.jsx(At,{ctrl_id:a.controller.ctrl_id}),l==="tickets"&&e.jsx(K,{})]})]})]})};export{Ft as default};
