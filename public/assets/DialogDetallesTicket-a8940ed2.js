import{r as ae,i as ce,j as e,u as Ce,a as y,bG as de,bH as Se,bI as De,F as R,B as T,T as r,H as A,I as D,aq as ie,J as V,G as t,ad as F,ae as P,S as a,L as H,e as U,l as W,s as ne}from"./index-4ffecd31.js";import{C as B,a as _e,P as we,b as Ee,c as Re,d as se,T as h,e as Te}from"./PaperTable-4c1ed6ff.js";import{g as L}from"./getFormattedDateTime-944b9e70.js";import{d as Ae}from"./SaveAltRounded-1416e30e.js";import{d as q}from"./DownloadRounded-a7b25489.js";import{d as Fe}from"./Close-55357cc5.js";import{C as Pe,d as Be}from"./ChooseFiles-48036bf7.js";import{D as Le,a as Oe,b as Ie}from"./DialogContent-c97a26f4.js";import{D as $e}from"./DialogTitle-4c44c10e.js";import{D as j}from"./Divider-d6bd9b5e.js";import{B as J}from"./Button-f956e5a8.js";import{P as Ge}from"./Select-5be36243.js";import"./InputLabel-3e1049b5.js";import"./MenuItem-c3457822.js";var Q={},ze=ce;Object.defineProperty(Q,"__esModule",{value:!0});var le=Q.default=void 0,Ne=ze(ae()),He=e,Ue=(0,Ne.default)((0,He.jsx)("path",{d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2zm4.3 14.3c-.39.39-1.02.39-1.41 0L12 13.41 9.11 16.3c-.39.39-1.02.39-1.41 0a.9959.9959 0 0 1 0-1.41L10.59 12 7.7 9.11a.9959.9959 0 0 1 0-1.41c.39-.39 1.02-.39 1.41 0L12 10.59l2.89-2.89c.39-.39 1.02-.39 1.41 0 .39.39.39 1.02 0 1.41L13.41 12l2.89 2.89c.38.38.38 1.02 0 1.41z"}),"CancelRounded");le=Q.default=Ue;var K={},We=ce;Object.defineProperty(K,"__esModule",{value:!0});var pe=K.default=void 0,qe=We(ae()),Me=e,Ve=(0,qe.default)((0,Me.jsx)("path",{d:"M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 14h-3v3h-2v-3H8v-2h3v-3h2v3h3v2zm-3-7V3.5L18.5 9H13z"}),"NoteAdd");pe=K.default=Ve;const Je=({foto:g})=>{const[v,b]=y.useState(null),u=C=>{b(C.currentTarget),_({foto:g})},p=()=>{b(null)},i=!!v,o=i?"simple-popover":void 0,[_,{isError:O,isSuccess:I,data:k}]=de();return e.jsxs("div",{children:[e.jsx(J,{"aria-describedby":o,variant:"contained",onClick:u,size:"small",children:"Ver Foto"}),e.jsxs(Ge,{id:o,open:i,anchorEl:v,onClose:p,anchorOrigin:{vertical:"top",horizontal:"right"},transformOrigin:{vertical:"bottom",horizontal:"right"},children:[O&&e.jsx(V,{children:"Ocurrio un error al intentar obtener la foto de perfil"}),I&&k&&k.base64&&e.jsx("img",{src:"data:image/png;base64,"+k.base64,alt:"actividad_personal_foto_perfil",width:200,height:200,style:{objectFit:"cover",borderRadius:"50%"}})]})]})};function M(g,v){return v=="docs"?g.reduce((u,p)=>{const i=u,{tipo:o}=p;return(o=="application/pdf"||o=="application/vnd.ms-powerpoint"||o=="application/vnd.openxmlformats-officedocument.presentationml.presentation"||o=="application/vnd.ms-excel"||o=="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"||o=="application/msword"||o=="application/vnd.openxmlformats-officedocument.wordprocessingml.document")&&i.push(p),i},[]):v=="imgs"?g.reduce((u,p)=>{const i=u,{tipo:o}=p;return(o=="image/jpeg"||o=="image/png"||o=="image/svg+xml"||o=="image/gif"||o=="image/avif"||o=="image/apng"||o=="image/webp")&&i.push(p),i},[]):v=="vids"?g.reduce((u,p)=>{const i=u,{tipo:o}=p;return(o=="video/x-msvideo"||o=="video/mp4"||o=="video/mpeg"||o=="video/ogg"||o=="video/webm"||o=="video/3gpp")&&i.push(p),i},[]):[]}const dr=({handleCloseDialog:g,isOpen:v,data:b})=>{const{ctrl_id:u,rt_id:p}=b,i=Ce(),[o,_]=y.useState(null),[O,{isError:I,isSuccess:k,data:C}]=de(),[he,{isError:X,isSuccess:Y,data:w,error:Z,isLoading:xe}]=Se(),{isSuccess:$,data:n,isLoading:me,isError:ue}=De({ctrl_id:u,rt_id:p}),G=async(s,c)=>{try{const x=JSON.stringify({path:s}),l=await fetch(`${ne}/api/v1/ticket/download/archivo`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:x});if(!l.ok)throw new Error(`Error al descargar el archivo: ${l.statusText}`);const m=await l.blob(),N=window.URL.createObjectURL(m),f=document.createElement("a");f.href=N,f.setAttribute("download",c),document.body.appendChild(f),f.click(),document.body.removeChild(f)}catch(d){console.error("Error al descargar el archivo",d)}},je=async()=>{try{const s=await fetch(`${ne}/api/v1/ticket/download?rt_id=${p}&ctrl_id=${u}`,{method:"GET",credentials:"include"});if(!s.ok){R.error(()=>e.jsx(T,{children:e.jsx(r,{component:"p",variant:"body1",children:JSON.stringify(s)})}),{position:"bottom-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:i.palette.mode,transition:A,closeButton:!0,style:{backgroundColor:i.palette.background.paper,borderWidth:"1px",borderStyle:"solid",borderColor:i.palette.divider}});return}const c=`TicketDetalles_${Date.now()}.pdf`,d=await s.blob(),x=window.URL.createObjectURL(d),l=document.createElement("a");l.href=x,l.setAttribute("download",c),document.body.appendChild(l),l.click(),document.body.removeChild(l)}catch(s){console.error("Error al descargar archivo pdf de los detalles del ticket.",s)}},[S,ee]=y.useState(!1),ve=()=>{S&&(E(null),z([])),ee(!S)},ge=["image/jpeg","image/jpg","image/png","application/pdf","video/mp4"],[re,E]=y.useState(null),[te,z]=y.useState([]),be=s=>{R.warn(()=>e.jsx(T,{children:e.jsx(r,{component:"p",variant:"body1",children:s})}),{position:"bottom-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:i.palette.mode,transition:A,closeButton:!0,style:{backgroundColor:i.palette.background.paper,borderWidth:"1px",borderStyle:"solid",borderColor:i.palette.divider}})},fe=s=>{const c=new FormData;s.forEach(d=>{c.append("archivos",d)}),E(c)},ye=s=>{const c=new FormData;s.forEach(d=>{c.append("archivos",d)}),E(c)},ke=()=>{if(re){let s=new FormData;const c=JSON.stringify({ctrl_id:u,rt_id:p});s.append("formvalues",c);for(const[d,x]of re.entries())s.append(d,x);he(s)}};return y.useEffect(()=>{if($&&n){const{solicitante:{foto:s},archivos_respaldo:c}=n;v&&O({foto:s}),_(c)}},[$,n]),y.useEffect(()=>{X&&Z&&R.error(()=>e.jsx(T,{children:e.jsx(r,{component:"p",variant:"body1",children:JSON.stringify(Z)})}),{position:"bottom-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:i.palette.mode,transition:A,closeButton:!0,style:{backgroundColor:i.palette.background.paper,borderWidth:"1px",borderStyle:"solid",borderColor:i.palette.divider}}),Y&&w&&(R.success(()=>e.jsx(T,{children:e.jsx(r,{component:"p",variant:"body1",children:w.message})}),{position:"bottom-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:i.palette.mode,transition:A,closeButton:!0,style:{backgroundColor:i.palette.background.paper,borderWidth:"1px",borderStyle:"solid",borderColor:i.palette.divider}}),E(null),z([]),ee(!1),_(w.data))},[X,Y,w]),e.jsxs(Le,{open:v,onClose:g,fullWidth:!0,maxWidth:"xl",sx:{"& .MuiDialog-paper":{}},children:[e.jsx($e,{children:e.jsx(r,{component:"div",variant:"h5",children:"Detalles"})}),e.jsx(D,{"aria-label":"close",onClick:g,sx:{position:"absolute",right:16,top:8},children:e.jsx(Fe,{})}),e.jsxs(Oe,{dividers:!0,children:[me&&e.jsx(ie,{children:"Cargando detalles ..."}),ue&&e.jsx(V,{children:"Error al cargar detalles del ticket."}),$&&n&&e.jsxs(t,{container:!0,rowSpacing:1,columnSpacing:1,children:[e.jsx(t,{item:!0,xs:4,children:e.jsxs(F,{children:[e.jsx(B,{sx:{p:1},title:e.jsx(r,{component:"div",variant:"h5",children:"Solicitante"})}),e.jsx(j,{}),e.jsx(P,{children:e.jsxs(t,{container:!0,rowSpacing:1,columnSpacing:1,children:[e.jsx(t,{item:!0,xs:12,children:e.jsxs(a,{spacing:.5,alignItems:"center",children:[I&&e.jsx(V,{children:"Error al cargar foto de perfil"}),k&&C&&C.base64&&e.jsx("img",{src:"data:image/png;base64,"+C.base64,alt:"solicitante_foto_perfil",width:100,height:100,style:{objectFit:"cover",borderRadius:"50%"}}),e.jsx(r,{component:"p",variant:"h6",children:n.solicitante.nombre}),e.jsx(r,{component:"p",variant:"body1",children:n.solicitante.cargo})]})}),e.jsx(t,{item:!0,xs:12,children:e.jsx(j,{})}),e.jsx(t,{item:!0,xs:6,children:e.jsxs(a,{spacing:.5,children:[e.jsx(r,{component:"p",variant:"h6",children:"Nombre"}),e.jsx(r,{component:"p",variant:"body1",children:n.solicitante.nombre})]})}),e.jsx(t,{item:!0,xs:6,children:e.jsxs(a,{spacing:.5,children:[e.jsx(r,{component:"p",variant:"h6",children:"Telefono"}),e.jsx(r,{component:"p",variant:"body1",children:n.solicitante.telefono})]})}),e.jsx(t,{item:!0,xs:12,children:e.jsx(j,{})}),e.jsx(t,{item:!0,xs:6,children:e.jsxs(a,{spacing:.5,children:[e.jsx(r,{component:"p",variant:"h6",children:"Correo"}),e.jsx(r,{component:"p",variant:"body1",children:n.solicitante.correo})]})}),e.jsx(t,{item:!0,xs:6,children:e.jsxs(a,{spacing:.5,children:[e.jsx(r,{component:"p",variant:"h6",children:"DNI"}),e.jsx(r,{component:"p",variant:"body1",children:n.solicitante.dni})]})}),e.jsx(t,{item:!0,xs:12,children:e.jsx(j,{})}),e.jsx(t,{item:!0,xs:6,children:e.jsxs(a,{spacing:.5,children:[e.jsx(r,{component:"p",variant:"h6",children:"Cargo"}),e.jsx(r,{component:"p",variant:"body1",children:n.solicitante.cargo})]})}),e.jsx(t,{item:!0,xs:6,children:e.jsxs(a,{spacing:.5,children:[e.jsx(r,{component:"p",variant:"h6",children:"Contrata"}),e.jsx(r,{component:"p",variant:"body1",children:n.solicitante.contrata})]})})]})})]})}),e.jsx(t,{item:!0,xs:8,children:e.jsxs(F,{children:[e.jsx(B,{sx:{p:1},title:e.jsx(r,{component:"div",variant:"h5",children:"Ticket"})}),e.jsx(j,{}),e.jsx(P,{children:e.jsxs(t,{container:!0,rowSpacing:1.5,columnSpacing:1,children:[e.jsx(t,{item:!0,xs:4,children:e.jsxs(a,{spacing:.5,children:[e.jsx(r,{component:"p",variant:"h6",children:"Tipo Trabajo"}),e.jsx(r,{component:"p",variant:"body1",children:n.ticket.tipotrabajo})]})}),e.jsx(t,{item:!0,xs:4,children:e.jsxs(a,{spacing:.5,children:[e.jsx(r,{component:"p",variant:"h6",children:"Descripci√≥n"}),e.jsx(r,{component:"p",variant:"body1",children:n.ticket.descripcion})]})}),e.jsx(t,{item:!0,xs:4,children:e.jsxs(a,{spacing:.5,children:[e.jsx(r,{component:"p",variant:"h6",children:"Prioridad"}),e.jsx(r,{component:"p",variant:"body1",children:n.ticket.prioridad==1?"Alta":(n.ticket.prioridad==2?"Medio":"Bajo")||"Error_Prioridad"})]})}),e.jsx(t,{item:!0,xs:12,children:e.jsx(j,{})}),e.jsx(t,{item:!0,xs:4,children:e.jsxs(a,{spacing:.5,children:[e.jsx(r,{component:"p",variant:"h6",children:"Contrata"}),e.jsx(r,{component:"p",variant:"body1",children:n.ticket.contrata})]})}),e.jsx(t,{item:!0,xs:4,children:e.jsxs(a,{spacing:.5,children:[e.jsx(r,{component:"p",variant:"h6",children:"Estado"}),e.jsx(r,{component:"p",variant:"body1",children:n.ticket.estado})]})}),e.jsx(t,{item:!0,xs:4,children:e.jsxs(a,{spacing:.5,children:[e.jsx(r,{component:"p",variant:"h6",children:"Fecha Creaci√≥n"}),e.jsx(r,{component:"p",variant:"body1",children:L(n.ticket.fechacreacion)})]})}),e.jsx(t,{item:!0,xs:12,children:e.jsx(j,{})}),e.jsx(t,{item:!0,xs:4,children:e.jsxs(a,{spacing:.5,children:[e.jsx(r,{component:"p",variant:"h6",children:"Fecha Comienzo"}),e.jsx(r,{component:"p",variant:"body1",children:L(n.ticket.fechacomienzo)})]})}),e.jsx(t,{item:!0,xs:4,children:e.jsxs(a,{spacing:.5,children:[e.jsx(r,{component:"p",variant:"h6",children:"Fecha Termino"}),e.jsx(r,{component:"p",variant:"body1",children:L(n.ticket.fechatermino)})]})}),e.jsx(t,{item:!0,xs:4,children:e.jsxs(a,{spacing:.5,children:[e.jsx(r,{component:"p",variant:"h6",children:"Fecha Estado Final"}),e.jsx(r,{component:"p",variant:"body1",children:n.ticket.fechaestadofinal&&L(n.ticket.fechaestadofinal)})]})}),e.jsx(t,{item:!0,xs:12,children:e.jsx(j,{})}),e.jsx(t,{item:!0,xs:4,children:e.jsxs(a,{spacing:.5,children:[e.jsx(r,{component:"p",variant:"h6",children:"Telefono"}),e.jsx(r,{component:"p",variant:"body1",children:n.ticket.telefono})]})}),e.jsx(t,{item:!0,xs:4,children:e.jsxs(a,{spacing:.5,children:[e.jsx(r,{component:"p",variant:"h6",children:"Correo"}),e.jsx(r,{component:"p",variant:"body1",children:n.ticket.correo})]})}),e.jsx(t,{item:!0,xs:4,children:e.jsxs(a,{spacing:.5,children:[e.jsx(r,{component:"p",variant:"h6",children:"Numero Ticket:"}),e.jsx(r,{component:"p",variant:"body1",children:n.ticket.rt_id})]})})]})})]})}),e.jsx(t,{item:!0,xs:12,children:e.jsxs(F,{children:[e.jsx(B,{sx:{p:1},title:e.jsx(r,{component:"div",variant:"h5",children:"Personales"})}),e.jsx(j,{}),e.jsx(P,{children:e.jsx(_e,{component:we,children:e.jsxs(Ee,{sx:{minWidth:650},"aria-label":"simple table",size:"small",children:[e.jsx(Re,{children:e.jsxs(se,{children:[e.jsx(h,{children:"N¬∞"}),e.jsx(h,{children:"Nombre"}),e.jsx(h,{children:"Telefono"}),e.jsx(h,{children:"DNI"}),e.jsx(h,{children:"Cargo"}),e.jsx(h,{children:"Contrata"}),e.jsx(h,{children:"Foto"})]})}),e.jsx(Te,{children:n.personales.map((s,c)=>{const{ap_id:d,nombre:x,telefono:l,dni:m,cargo:N,contrata:f,foto:oe}=s;return e.jsxs(se,{children:[e.jsx(h,{children:c+1}),e.jsx(h,{children:x}),e.jsx(h,{children:l}),e.jsx(h,{children:m}),e.jsx(h,{children:N}),e.jsx(h,{children:f}),e.jsx(h,{children:oe&&e.jsx(Je,{foto:oe},d+m)})]},d)})})]})})})]})}),e.jsx(t,{item:!0,xs:12,children:e.jsxs(F,{children:[e.jsx(B,{sx:{pl:1,py:1,pr:2},title:e.jsx(r,{component:"div",variant:"h5",children:"Archivos de Respaldo"}),action:e.jsxs(D,{"aria-label":"editar_archivos_respaldo",size:"small",onClick:ve,children:[!S&&e.jsx(pe,{color:"warning"}),S&&e.jsx(le,{color:"error"})]})}),e.jsx(j,{}),e.jsx(P,{children:e.jsxs(t,{container:!0,rowSpacing:1,columnSpacing:1,children:[S&&e.jsx(t,{item:!0,xs:12,sx:{marginBottom:1,borderBottomWidth:1,borderBottomStyle:"solid",borderBottomColor:i.palette.divider},children:e.jsxs(a,{spacing:1,pb:1,children:[e.jsx(Pe,{supportedFormats:ge,handleError:be,onUpload:fe,onDelete:ye,count:5,maxSize:10,files:te,setFiles:z,buttonStyle:{maxWidth:300},children:"Nuevos archivos de respaldo:"}),xe&&e.jsx(ie,{children:"Enviando ..."}),te.length>0&&e.jsx(a,{alignItems:"end",children:e.jsx(J,{sx:{maxWidth:300},onClick:ke,variant:"contained",type:"submit",startIcon:e.jsx(Be,{}),children:"Guardar"})})]})}),e.jsx(t,{item:!0,xs:4,sx:{borderRightWidth:"2px",borderRightColor:i.palette.mode==="dark"?i.palette.divider:i.palette.grey.A800,borderRightStyle:"solid"},children:e.jsxs(a,{direction:"column",spacing:1,children:[e.jsx(r,{component:"div",variant:"body1",children:"Documentos:"}),e.jsx(H,{sx:{pr:1},children:o&&M(o,"docs").map((s,c,d)=>{const{at_id:x,ruta:l,nombreoriginal:m}=s;return e.jsx(U,{divider:c<d.length-1,secondaryAction:e.jsx(D,{edge:"end","aria-label":"download_doc",onClick:()=>{G(l,m)},children:e.jsx(q,{color:"info"})}),children:e.jsx(W,{primary:m})},x)})})]})}),e.jsx(t,{item:!0,xs:4,sx:{borderRightWidth:"2px",borderRightColor:i.palette.mode==="dark"?i.palette.divider:i.palette.grey.A800,borderRightStyle:"solid"},children:e.jsxs(a,{direction:"column",spacing:1,children:[e.jsx(r,{component:"div",variant:"body1",children:"Fotos:"}),e.jsx(H,{sx:{pr:1},children:o&&M(o,"imgs").map((s,c,d)=>{const{at_id:x,ruta:l,nombreoriginal:m}=s;return e.jsx(U,{divider:c<d.length-1,secondaryAction:e.jsx(D,{edge:"end","aria-label":"download_img",onClick:()=>{G(l,m)},children:e.jsx(q,{color:"info"})}),children:e.jsx(W,{primary:m})},x)})})]})}),e.jsx(t,{item:!0,xs:4,children:e.jsxs(a,{direction:"column",spacing:1,children:[e.jsx(r,{component:"div",variant:"body1",children:"Videos:"}),e.jsx(H,{sx:{pr:1},children:o&&M(o,"vids").map((s,c,d)=>{const{at_id:x,ruta:l,nombreoriginal:m}=s;return e.jsx(U,{divider:c<d.length-1,secondaryAction:e.jsx(D,{edge:"end","aria-label":"download_vids",onClick:()=>{G(l,m)},children:e.jsx(q,{color:"info"})}),children:e.jsx(W,{primary:m})},x)})})]})})]})})]})})]})]}),e.jsx(Ie,{children:e.jsx(J,{variant:"contained",startIcon:e.jsx(Ae,{}),onClick:je,children:"Descargar"})})]})};export{dr as DialogDetallesTicket,dr as default};
