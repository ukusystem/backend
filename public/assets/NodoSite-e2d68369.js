import{a as _e,g as Se,s as k,r as u,b as we,j as e,e as re,f as ye,n as P,aU as nt,c as V,aV as ne,aW as Te,u as ot,aX as v,aY as it,l as oe,aZ as ke,aC as ie,B as b,Y as D,Z as T,H as y,h as E,q as O,ah as X,ai as te,ax as at,am as De,an as Z,I as R,a_ as J,a$ as Me,aQ as Ie,W as Re,X as Pe,b0 as B,b1 as $,b2 as lt,b3 as ct,A as w,S as dt,N as W,G as j,D as ae,b4 as ut,b5 as Le,p as mt,v as pt,w as ht,x as xt,z as gt,C as ft,b6 as jt,b7 as ge,b8 as bt,b9 as fe,ba as Ct,bb as vt}from"./index-cd9971db.js";import{C as K}from"./CardHeader-20f867d3.js";import{D as _t}from"./Divider-31dc6397.js";import{A as L}from"./Alert-ff771c2d.js";import{g as St,a as wt,P as yt,u as ee,b as le,c as Tt,d as U,f as je,e as kt,h as Dt,r as Fe,C as Mt,i as $e,j as Ae,k as It,s as Ee,v as Oe,l as a,m as ze,n as Rt,o as Pt,D as Lt}from"./useMobilePicker-82bf0998.js";import{P as Ft,a as N,r as $t,b as be,c as At,d as se}from"./date-time-utils-52a52ea5.js";import{T as Ye,D as Ve,S as Et}from"./StreamPlayer-7be24fd8.js";import{T as He,t as Ue}from"./Tooltip-36eebbbd.js";import{d as Ot,a as zt}from"./LastPage-e9fc500f.js";import{d as Yt,a as Vt,g as Ne}from"./getFormattedDateTime-65423d08.js";import{S as ce}from"./Select-14661ed5.js";import{M as A}from"./MenuItem-beff4536.js";import{S as Be}from"./ServerError-be89b6ca.js";import{d as Ht,a as Ut,S as Nt}from"./SensorsOffRounded-86e21e2c.js";import{b as Ge,a as qe,f as We,c as de,d as Y,T as _,e as ue}from"./PaperTable-cde5194d.js";import{d as Bt}from"./DownloadRounded-6170fe07.js";import{_ as Gt}from"./react-apexcharts.min-3122ad43.js";import{D as qt,a as Wt}from"./DialogContent-4778fabe.js";import{D as Qt}from"./DialogTitle-c32dba92.js";import{S as Xt}from"./Send-c176c981.js";import{B as Ce}from"./Button-ba927df9.js";import{L as Zt}from"./LimitedTextDisplay-4add76ec.js";import{M as Kt}from"./Link-f9ecbb2f.js";import{F as Jt}from"./FormControl-bc039e5e.js";import"./InputAdornment-4b43f1cb.js";import"./Popover-2b6b18f6.js";import"./InputLabel-12f69e81.js";import"./TextField-3a09ba66.js";import"./Chip-a58ea68f.js";function es(t){return _e("MuiCardActions",t)}Se("MuiCardActions",["root","spacing"]);const ts=t=>{const{classes:s,disableSpacing:n}=t;return ye({root:["root",!n&&"spacing"]},es,s)},ss=k("div",{name:"MuiCardActions",slot:"Root",overridesResolver:(t,s)=>{const{ownerState:n}=t;return[s.root,!n.disableSpacing&&s.spacing]}})({display:"flex",alignItems:"center",padding:8,variants:[{props:{disableSpacing:!1},style:{"& > :not(style) ~ :not(style)":{marginLeft:8}}}]}),rs=u.forwardRef(function(s,n){const r=we({props:s,name:"MuiCardActions"}),{disableSpacing:o=!1,className:i,...c}=r,m={...r,disableSpacing:o},d=ts(m);return e.jsx(ss,{className:re(d.root,i),ownerState:m,ref:n,...c})}),Qe=rs;function ns(t){return _e("MuiDialogContentText",t)}Se("MuiDialogContentText",["root"]);const os=t=>{const{classes:s}=t,r=ye({root:["root"]},ns,s);return{...s,...r}},is=k(P,{shouldForwardProp:t=>nt(t)||t==="classes",name:"MuiDialogContentText",slot:"Root",overridesResolver:(t,s)=>s.root})({}),as=u.forwardRef(function(s,n){const r=we({props:s,name:"MuiDialogContentText"}),{children:o,className:i,...c}=r,m=os(c);return e.jsx(is,{component:"p",variant:"body1",color:"textSecondary",ref:n,ownerState:c,className:re(m.root,i),...r,classes:m})}),ls=as,cs=V([e.jsx("circle",{cx:"12",cy:"12",r:"3.2"},"0"),e.jsx("path",{d:"M9 2 7.17 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2h-3.17L15 2zm3 15c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5"},"1")],"CameraAlt"),ds=V(e.jsx("path",{d:"M16.59 9H15V4c0-.55-.45-1-1-1h-4c-.55 0-1 .45-1 1v5H7.41c-.89 0-1.34 1.08-.71 1.71l4.59 4.59c.39.39 1.02.39 1.41 0l4.59-4.59c.63-.63.19-1.71-.7-1.71M5 19c0 .55.45 1 1 1h12c.55 0 1-.45 1-1s-.45-1-1-1H6c-.55 0-1 .45-1 1"}),"DownloadRounded"),us=V(e.jsx("path",{d:"m15.96 10.29-2.75 3.54-1.96-2.36L8.5 15h11zM3 5H1v16c0 1.1.9 2 2 2h16v-2H3zm18-4H7c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V3c0-1.1-.9-2-2-2m0 16H7V3h14z"}),"Filter"),ms=V(e.jsx("path",{d:"M23 8c0 1.1-.9 2-2 2-.18 0-.35-.02-.51-.07l-3.56 3.55c.05.16.07.34.07.52 0 1.1-.9 2-2 2s-2-.9-2-2c0-.18.02-.36.07-.52l-2.55-2.55c-.16.05-.34.07-.52.07s-.36-.02-.52-.07l-4.55 4.56c.05.16.07.33.07.51 0 1.1-.9 2-2 2s-2-.9-2-2 .9-2 2-2c.18 0 .35.02.51.07l4.56-4.55C8.02 9.36 8 9.18 8 9c0-1.1.9-2 2-2s2 .9 2 2c0 .18-.02.36-.07.52l2.55 2.55c.16-.05.34-.07.52-.07s.36.02.52.07l3.55-3.56C19.02 8.35 19 8.18 19 8c0-1.1.9-2 2-2s2 .9 2 2"}),"Timeline"),ps=V(e.jsx("path",{d:"M4 6H2v14c0 1.1.9 2 2 2h14v-2H4zm16-4H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2m-8 12.5v-9l6 4.5z"}),"VideoLibrary"),hs=V(e.jsx("path",{d:"M17 10.5V7c0-.55-.45-1-1-1H4c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.55 0 1-.45 1-1v-3.5l4 4v-11z"}),"Videocam");function xs(t){return wt("MuiTimePickerToolbar",t)}const G=St("MuiTimePickerToolbar",["root","separator","hourMinuteLabel","hourMinuteLabelLandscape","hourMinuteLabelReverse","ampmSelection","ampmLandscape","ampmLabel"]),gs=["ampm","ampmInClock","value","isLandscape","onChange","view","onViewChange","views","disabled","readOnly","className"],fs=t=>{const{isLandscape:s,classes:n,isRtl:r}=t;return kt({root:["root"],separator:["separator"],hourMinuteLabel:["hourMinuteLabel",s&&"hourMinuteLabelLandscape",r&&"hourMinuteLabelReverse"],ampmSelection:["ampmSelection",s&&"ampmLandscape"],ampmLabel:["ampmLabel"]},xs,n)},js=k(yt,{name:"MuiTimePickerToolbar",slot:"Root",overridesResolver:(t,s)=>s.root})({}),bs=k(Ft,{name:"MuiTimePickerToolbar",slot:"Separator",overridesResolver:(t,s)=>s.separator})({outline:0,margin:"0 4px 0 2px",cursor:"default"}),Cs=k("div",{name:"MuiTimePickerToolbar",slot:"HourMinuteLabel",overridesResolver:(t,s)=>[{[`&.${G.hourMinuteLabelLandscape}`]:s.hourMinuteLabelLandscape,[`&.${G.hourMinuteLabelReverse}`]:s.hourMinuteLabelReverse},s.hourMinuteLabel]})({display:"flex",justifyContent:"flex-end",alignItems:"flex-end",variants:[{props:{isRtl:!0},style:{flexDirection:"row-reverse"}},{props:{isLandscape:!0},style:{marginTop:"auto"}}]}),vs=k("div",{name:"MuiTimePickerToolbar",slot:"AmPmSelection",overridesResolver:(t,s)=>[{[`.${G.ampmLabel}`]:s.ampmLabel},{[`&.${G.ampmLandscape}`]:s.ampmLandscape},s.ampmSelection]})({display:"flex",flexDirection:"column",marginRight:"auto",marginLeft:12,[`& .${G.ampmLabel}`]:{fontSize:17},variants:[{props:{isLandscape:!0},style:{margin:"4px 0 auto",flexDirection:"row",justifyContent:"space-around",flexBasis:"100%"}}]});function _s(t){const s=ne({props:t,name:"MuiTimePickerToolbar"}),{ampm:n,ampmInClock:r,value:o,isLandscape:i,onChange:c,view:m,onViewChange:d,views:l,disabled:p,readOnly:h,className:x}=s,g=Te(s,gs),f=ee(),S=le(),C=ot(),z=!!(n&&!r&&l.includes("hours")),{meridiemMode:F,handleMeridiemChange:H}=Tt(o,n,c),Q=xe=>n?f.format(xe,"hours12h"):f.format(xe,"hours24h"),I=v({},s,{isRtl:C}),M=fs(I),he=e.jsx(bs,{tabIndex:-1,value:":",variant:"h3",selected:!1,className:M.separator});return e.jsxs(js,v({landscapeDirection:"row",toolbarTitle:S.timePickerToolbarTitle,isLandscape:i,ownerState:I,className:re(M.root,x)},g,{children:[e.jsxs(Cs,{className:M.hourMinuteLabel,ownerState:I,children:[U(l,"hours")&&e.jsx(N,{tabIndex:-1,variant:"h3",onClick:()=>d("hours"),selected:m==="hours",value:o?Q(o):"--"}),U(l,["hours","minutes"])&&he,U(l,"minutes")&&e.jsx(N,{tabIndex:-1,variant:"h3",onClick:()=>d("minutes"),selected:m==="minutes",value:o?f.format(o,"minutes"):"--"}),U(l,["minutes","seconds"])&&he,U(l,"seconds")&&e.jsx(N,{variant:"h3",onClick:()=>d("seconds"),selected:m==="seconds",value:o?f.format(o,"seconds"):"--"})]}),z&&e.jsxs(vs,{className:M.ampmSelection,ownerState:I,children:[e.jsx(N,{disableRipple:!0,variant:"subtitle2",selected:F==="am",typographyClassName:M.ampmLabel,value:je(f,"am"),onClick:h?void 0:()=>H("am"),disabled:p}),e.jsx(N,{disableRipple:!0,variant:"subtitle2",selected:F==="pm",typographyClassName:M.ampmLabel,value:je(f,"pm"),onClick:h?void 0:()=>H("pm"),disabled:p})]})]}))}function Xe(t,s){var c;const n=ee(),r=ne({props:t,name:s}),o=r.ampm??n.is12HourCycleInCurrentLocale(),i=u.useMemo(()=>{var m;return((m=r.localeText)==null?void 0:m.toolbarTitle)==null?r.localeText:v({},r.localeText,{timePickerToolbarTitle:r.localeText.toolbarTitle})},[r.localeText]);return v({},r,{ampm:o,localeText:i},Dt({views:r.views,openTo:r.openTo,defaultViews:["hours","minutes"],defaultOpenTo:"hours"}),{disableFuture:r.disableFuture??!1,disablePast:r.disablePast??!1,slots:v({toolbar:_s},r.slots),slotProps:v({},r.slotProps,{toolbar:v({ampm:o,ampmInClock:r.ampmInClock},(c=r.slotProps)==null?void 0:c.toolbar)})})}const Ze=u.forwardRef(function(s,n){var z,F,H,Q;const r=le(),o=ee(),i=Xe(s,"MuiDesktopTimePicker"),{shouldRenderTimeInASingleColumn:c,views:m,timeSteps:d}=$t(i),l=c?At:be,p=v({hours:l,minutes:l,seconds:l,meridiem:l},i.viewRenderers),h=i.ampmInClock??!0,x=c?[]:["accept"],f=((z=p.hours)==null?void 0:z.name)===be.name?m:m.filter(I=>I!=="meridiem"),S=v({},i,{ampmInClock:h,timeSteps:d,viewRenderers:p,format:Fe(o,i),views:c?["hours"]:f,slots:v({field:Ye,openPickerIcon:Mt},i.slots),slotProps:v({},i.slotProps,{field:I=>{var M;return v({},$e((M=i.slotProps)==null?void 0:M.field,I),Ae(i),{ref:n})},toolbar:v({hidden:!0,ampmInClock:h},(F=i.slotProps)==null?void 0:F.toolbar),actionBar:v({actions:x},(H=i.slotProps)==null?void 0:H.actionBar)})}),{renderPicker:C}=It({props:S,valueManager:Ee,valueType:"time",getOpenDialogAriaText:((Q=S.localeText)==null?void 0:Q.openTimePickerDialogue)??r.openTimePickerDialogue,validator:Oe});return C()});Ze.propTypes={ampm:a.bool,ampmInClock:a.bool,autoFocus:a.bool,className:a.string,closeOnSelect:a.bool,defaultValue:a.object,disabled:a.bool,disableFuture:a.bool,disableIgnoringDatePartForTimeValidation:a.bool,disableOpenPicker:a.bool,disablePast:a.bool,enableAccessibleFieldDOMStructure:a.any,format:a.string,formatDensity:a.oneOf(["dense","spacious"]),inputRef:ze,label:a.node,localeText:a.object,maxTime:a.object,minTime:a.object,minutesStep:a.number,name:a.string,onAccept:a.func,onChange:a.func,onClose:a.func,onError:a.func,onOpen:a.func,onSelectedSectionsChange:a.func,onViewChange:a.func,open:a.bool,openTo:a.oneOf(["hours","meridiem","minutes","seconds"]),orientation:a.oneOf(["landscape","portrait"]),readOnly:a.bool,reduceAnimations:a.bool,referenceDate:a.object,selectedSections:a.oneOfType([a.oneOf(["all","day","empty","hours","meridiem","minutes","month","seconds","weekDay","year"]),a.number]),shouldDisableTime:a.func,skipDisabled:a.bool,slotProps:a.object,slots:a.object,sx:a.oneOfType([a.arrayOf(a.oneOfType([a.func,a.object,a.bool])),a.func,a.object]),thresholdToRenderTimeInASingleColumn:a.number,timeSteps:a.shape({hours:a.number,minutes:a.number,seconds:a.number}),timezone:a.string,value:a.object,view:a.oneOf(["hours","meridiem","minutes","seconds"]),viewRenderers:a.shape({hours:a.func,meridiem:a.func,minutes:a.func,seconds:a.func}),views:a.arrayOf(a.oneOf(["hours","minutes","seconds"]).isRequired)};const Ke=u.forwardRef(function(s,n){var p,h;const r=le(),o=ee(),i=Xe(s,"MuiMobileTimePicker"),c=v({hours:se,minutes:se,seconds:se},i.viewRenderers),m=i.ampmInClock??!1,d=v({},i,{ampmInClock:m,viewRenderers:c,format:Fe(o,i),slots:v({field:Ye},i.slots),slotProps:v({},i.slotProps,{field:x=>{var g;return v({},$e((g=i.slotProps)==null?void 0:g.field,x),Ae(i),{ref:n})},toolbar:v({hidden:!1,ampmInClock:m},(p=i.slotProps)==null?void 0:p.toolbar)})}),{renderPicker:l}=Rt({props:d,valueManager:Ee,valueType:"time",getOpenDialogAriaText:((h=d.localeText)==null?void 0:h.openTimePickerDialogue)??r.openTimePickerDialogue,validator:Oe});return l()});Ke.propTypes={ampm:a.bool,ampmInClock:a.bool,autoFocus:a.bool,className:a.string,closeOnSelect:a.bool,defaultValue:a.object,disabled:a.bool,disableFuture:a.bool,disableIgnoringDatePartForTimeValidation:a.bool,disableOpenPicker:a.bool,disablePast:a.bool,enableAccessibleFieldDOMStructure:a.any,format:a.string,formatDensity:a.oneOf(["dense","spacious"]),inputRef:ze,label:a.node,localeText:a.object,maxTime:a.object,minTime:a.object,minutesStep:a.number,name:a.string,onAccept:a.func,onChange:a.func,onClose:a.func,onError:a.func,onOpen:a.func,onSelectedSectionsChange:a.func,onViewChange:a.func,open:a.bool,openTo:a.oneOf(["hours","minutes","seconds"]),orientation:a.oneOf(["landscape","portrait"]),readOnly:a.bool,reduceAnimations:a.bool,referenceDate:a.object,selectedSections:a.oneOfType([a.oneOf(["all","day","empty","hours","meridiem","minutes","month","seconds","weekDay","year"]),a.number]),shouldDisableTime:a.func,slotProps:a.object,slots:a.object,sx:a.oneOfType([a.arrayOf(a.oneOfType([a.func,a.object,a.bool])),a.func,a.object]),timezone:a.string,value:a.object,view:a.oneOf(["hours","minutes","seconds"]),viewRenderers:a.shape({hours:a.func,minutes:a.func,seconds:a.func}),views:a.arrayOf(a.oneOf(["hours","minutes","seconds"]).isRequired)};const Ss=["desktopModeMediaQuery"],ws=u.forwardRef(function(s,n){const r=ne({props:s,name:"MuiTimePicker"}),{desktopModeMediaQuery:o=Pt}=r,i=Te(r,Ss);return it(o,{defaultMatches:!0})?e.jsx(Ze,v({ref:n},i)):e.jsx(Ke,v({ref:n},i))}),ve={p:.5,"& .MuiCardHeader-action":{m:"auto auto",display:"flex"}},q=u.forwardRef(({border:t=!0,boxShadow:s,children:n,content:r=!0,contentSX:o={},darkTitle:i,elevation:c,secondary:m,shadow:d,sx:l={},title:p,isDivider:h=!1,codeHighlight:x,cardActions:g,...f},S)=>{const C=oe();return s=C.palette.mode==="dark"?s||!0:s,e.jsxs(ke,{elevation:c||0,ref:S,...f,sx:{display:"flex",flexDirection:"column",height:"100%",width:"100%",border:t?"1px solid":"none",borderRadius:2,borderColor:C.palette.mode==="dark"?C.palette.divider:C.palette.grey.A800,boxShadow:s&&(!t||C.palette.mode==="dark")?d||C.shadows[10]:"inherit",":hover":{boxShadow:s?d||C.shadows[10]:"inherit"},"& pre":{m:0,p:"16px !important",fontFamily:C.typography.fontFamily,fontSize:"0.75rem"},...l},children:[m&&!p&&e.jsx(K,{sx:ve,action:m}),p&&e.jsx(K,{sx:ve,title:e.jsx(P,{variant:"h5",children:p}),action:m}),h&&e.jsx(_t,{}),r&&e.jsx(ie,{sx:{flex:1,padding:.5,...o,"&:last-child":{paddingBottom:.5}},children:e.jsx(b,{sx:{width:"100%",height:"100%",position:"relative"},children:e.jsx(b,{sx:{width:"100%",height:"100%",position:"absolute"},children:n})})}),g&&e.jsx(Qe,{disableSpacing:!0,sx:{padding:.5},children:g})]})}),ys=({ctrl_id:t})=>{const[s,n]=u.useState(null),r=u.useRef(null);return u.useEffect(()=>(r.current||(r.current=D(`${T}/last_snapshot/${t}`)),r.current.on("last_snapshot",o=>{n(o)}),()=>{r.current&&(r.current.disconnect(),r.current=null)}),[t]),e.jsx(e.Fragment,{children:e.jsxs(q,{title:"Ultima Foto",children:[s!==null&&e.jsx(b,{component:"img",sx:{height:"100%",width:"100%",overflow:"hidden",borderRadius:"4px"},src:s}),s===null&&e.jsx(b,{component:"div",sx:{width:"100%",height:"100%",display:"grid",placeItems:"center"},children:e.jsx(L,{severity:"info",variant:"outlined",children:"Caputura no disponible"})})]})})},Ts=({timePicked:t,datePicked:s,setDatePicked:n,setTimePicked:r})=>e.jsxs(y,{direction:"row",spacing:2,alignItems:"center",children:[e.jsx(Ve,{value:s,onChange:o=>n(o),slotProps:{textField:{size:"small",sx:{maxWidth:150,"& .MuiOutlinedInput-root":{"& fieldset":{}}}}}}),e.jsx(ws,{views:["hours"],ampm:!1,defaultValue:t,onChange:o=>r(o),slotProps:{textField:{size:"small",sx:{maxWidth:85,"& .MuiOutlinedInput-root":{"& fieldset":{}}}},digitalClockSectionItem:{}}})]}),ks=k(({className:t,...s})=>e.jsx(He,{...s,classes:{popper:t}}))(({theme:t})=>({[`& .${Ue.tooltip}`]:{backgroundColor:t.palette.common.white,color:"rgba(0, 0, 0, 0.87)",boxShadow:t.shadows[1],fontSize:11}})),Ds=({camaras:t,ctrl_id:s})=>{const n=E(d=>d.stream),r=E(d=>d.controllerSiteState),[o,i]=u.useState(null),c=O(),m=(d,l)=>{if(l!==null&&r.controller!==void 0){const p=t.find(h=>h.ip===l);i(l),p&&c(X({ctrl_id:s,cmr_id:p.cmr_id,tc_id:p.tc_id,descripcion:p.descripcion}))}};return u.useEffect(()=>{if(t.length>0&&r.controller!==void 0){const d=n.cmr_id;if(d!==null){const l=t.find(p=>p.cmr_id===d);l?(i(l.ip),c(X({ctrl_id:s,cmr_id:l.cmr_id,tc_id:l.tc_id,descripcion:l.descripcion})),c(te({isSelected:!0}))):(i(t[0].ip),c(X({ctrl_id:s,cmr_id:t[0].cmr_id,tc_id:t[0].tc_id,descripcion:t[0].descripcion})),c(te({isSelected:!0})))}else i(t[0].ip),c(X({ctrl_id:s,cmr_id:t[0].cmr_id,tc_id:t[0].tc_id,descripcion:t[0].descripcion})),c(te({isSelected:!0}))}},[t]),u.useEffect(()=>()=>{c(at())},[]),e.jsx(e.Fragment,{children:e.jsx(De,{color:"primary",value:o,exclusive:!0,onChange:m,"aria-label":"Cameras",size:"small",children:t.map((d,l)=>e.jsx(Z,{value:d.ip,"aria-label":"Camara 1",sx:{padding:0},children:e.jsx(ks,{title:d.descripcion,arrow:!0,children:e.jsxs(y,{direction:"row",spacing:1,alignItems:"center",padding:{lg:1,xs:.5},children:[e.jsx(cs,{}),e.jsxs("div",{children:["Cam ",l+1]})]})})},d.ip))})})},Ms=()=>{const t=E(s=>s.stream);return e.jsx(e.Fragment,{children:e.jsx(b,{sx:{width:"100%",height:"100%",position:"relative"},children:t.cmr_id!==null&&t.ctrl_id!==null&&e.jsx(e.Fragment,{children:e.jsx(Et,{ctrl_id:t.ctrl_id,cmr_id:t.cmr_id,q:"q1"},t.ctrl_id+t.cmr_id+"q1")})})})},Je=u.forwardRef(({title:t,count:s,onChangeIndex:n,current_index:r},o)=>{const[i,c]=u.useState(1),m=x=>{c(x.target.value)},d=()=>{n(0)},l=()=>{const x=r-i<0?0:r-i;n(x)},p=()=>{const x=r+i>s-1?s-1:r+i;n(x)},h=()=>{n(s-1)};return e.jsx(b,{component:"div",sx:{display:"flex",alignItems:"center",justifyContent:"flex-end",gap:1},ref:o,children:s>=0&&e.jsxs(e.Fragment,{children:[e.jsxs(P,{component:"p",color:"white",sx:{userSelect:"none"},children:[t," :"]}),e.jsxs(ce,{id:"control-select",name:"control-select",value:i,onChange:m,size:"small",inputProps:{"aria-label":"Select RowsPerPage"},SelectDisplayProps:{style:{paddingTop:5,paddingBottom:5,borderColor:"white"}},sx:{color:"white","& .MuiOutlinedInput-notchedOutline":{borderColor:"white"},"& .MuiSvgIcon-root":{color:"white"}},children:[e.jsx(A,{value:1,children:1}),e.jsx(A,{value:10,children:10}),e.jsx(A,{value:20,children:20}),e.jsx(A,{value:50,children:50})]}),e.jsx(P,{component:"div",color:"white",sx:{userSelect:"none"},children:`${r+1} de ${s}`}),e.jsxs(b,{sx:{flexShrink:0,ml:2.5},children:[e.jsx(R,{onClick:d,disabled:r===0,"aria-label":"first page",children:e.jsx(Ot,{})}),e.jsx(R,{onClick:l,disabled:r===0,"aria-label":"previous page",children:e.jsx(Yt,{})}),e.jsx(R,{onClick:p,disabled:r===s-1,"aria-label":"next page",children:e.jsx(Vt,{})}),e.jsx(R,{onClick:h,disabled:r===s-1,"aria-label":"last page",children:e.jsx(zt,{})})]})]})})}),Is=async(t,s)=>{try{const r=await(await fetch(`${T}/api/v1/site/multimedia/download?filePath=${encodeURIComponent(t)}`,{credentials:"include"})).blob(),o=document.createElement("a");o.href=URL.createObjectURL(r),o.download=s,o.style.display="none",document.body.appendChild(o),o.click(),document.body.removeChild(o)}catch(n){console.error("Error downloading image:",n)}},Rs=({slides:t})=>{const[s,n]=u.useState([]),[r,o]=u.useState(0),i=()=>{if(s.length>0&&s[r]){const l=s[r],p=`downloaded-image-${l.fecha}.jpg`;Is(l.ruta,p)}},c=O(),m=l=>{l.currentTarget===l.target&&c(J())},d=l=>{o(l)};return u.useEffect(()=>{n(t),o(0)},[t]),e.jsx(e.Fragment,{children:e.jsx(b,{sx:{width:"100%",height:"100%",position:"absolute"},children:e.jsxs(b,{sx:{position:"relative",height:"100%",width:"100%"},children:[e.jsx(b,{component:"div",sx:{position:"absolute",bottom:0,left:0,width:"100%",background:"rgba(0, 0, 0, 0.3)",py:1,"&: hover":{}},children:e.jsxs(y,{spacing:1,direction:"row",alignItems:"center",justifyContent:"center",sx:{position:"relative"},onDoubleClickCapture:m,children:[e.jsx(Je,{title:"N° Fotos",count:s.length,current_index:r,onChangeIndex:d}),e.jsx(R,{"aria-label":"back",sx:{position:"absolute",bottom:"cacl(50% - 23px)",left:10,cursor:"pointer"},onClick:i,children:e.jsx(ds,{sx:{color:"#FD8D14",fontSize:30}})})]})}),s.length>0&&s[r]&&e.jsx(b,{component:"img",sx:{height:"100%",overflow:"hidden",width:"100%",borderRadius:"4px",userSelect:"none"},src:`${T+"/"+s[r].ruta}`,onDoubleClickCapture:m})]})})})},Ps="/assets/emptyData-e7a50cc8.svg",et=({children:t})=>e.jsxs(y,{spacing:1,alignItems:"center",children:[e.jsx("img",{src:Ps,alt:"",width:100}),e.jsx(P,{component:"p",variant:"body1",children:t&&t||"No data"})]}),Ls=({data:t})=>{const{cmr_id:s,ctrl_id:n,date:r,hour:o}=t,{isError:i,isSuccess:c,isLoading:m,data:d}=Me({ctrl_id:n,date:r,hour:o,tipo:0,cmr_id:s}),l=O(),p=h=>{h.currentTarget===h.target&&l(J())};return e.jsxs(b,{sx:{width:"100%",height:"100%",position:"relative",display:"flex",alignItems:"center",justifyContent:"center"},onDoubleClickCapture:p,children:[m&&e.jsx(Ie,{children:"Cargando Fotos"}),i&&e.jsx(Be,{children:"Error no se encontraron imagenes!"}),c&&d.length>0&&e.jsx(Rs,{slides:d}),c&&d.length==0&&e.jsx(et,{children:"No se encontraron fotos."})]})},Fs=({slides:t})=>{const[s,n]=u.useState([]),[r,o]=u.useState(0),i=O(),c=p=>{p.currentTarget===p.target&&i(J())},m=p=>{o(p)},d=u.useRef(null),l=u.useMemo(()=>d.current?`calc( 50% - ${d.current.getBoundingClientRect().width*.5}px )`:0,[d.current]);return u.useEffect(()=>{n(t),o(0)},[t]),e.jsx(e.Fragment,{children:e.jsx(b,{sx:{width:"100%",height:"100%",position:"absolute"},children:e.jsxs(b,{sx:{position:"relative",height:"100%",width:"100%"},children:[s.length>0&&s[r]&&e.jsx(b,{component:"video",sx:{height:"100%",overflow:"hidden",width:"100%",borderRadius:"4px"},controls:!0,src:`${T+"/"+s[r].ruta}`,onDoubleClickCapture:c,onClick:p=>{p.preventDefault(),p.detail==2&&p.stopPropagation()}}),e.jsx(b,{component:"div",sx:{position:"absolute",bottom:"7%",left:l},children:e.jsx(Je,{ref:d,title:"N° Videos",count:s.length,current_index:r,onChangeIndex:m})})]})})})},$s=({data:t})=>{const{cmr_id:s,ctrl_id:n,date:r,hour:o}=t,{isError:i,isSuccess:c,isLoading:m,data:d}=Me({ctrl_id:n,date:r,hour:o,tipo:1,cmr_id:s}),l=O(),p=h=>{h.currentTarget===h.target&&l(J())};return e.jsxs(b,{sx:{width:"100%",height:"100%",position:"relative",display:"flex",alignItems:"center",justifyContent:"center"},onDoubleClickCapture:p,children:[m&&e.jsx(Ie,{children:"Cargando videos"}),i&&e.jsx(Be,{children:"Error no se encontraron videos!"}),c&&d.length>0&&e.jsx(Fs,{slides:d}),c&&d.length==0&&e.jsx(et,{children:"No se encontraron videos."})]})},As=({option:t,handleChangeOption:s})=>e.jsxs(De,{color:"primary",value:t,exclusive:!0,onChange:s,"aria-label":"Options",size:"small",children:[e.jsx(Z,{value:"vivo","aria-label":"Vivo",children:e.jsxs(y,{direction:"row",alignItems:"center",spacing:1,children:[e.jsx(hs,{}),e.jsx("span",{children:" Vivo"})]})}),e.jsx(Z,{value:"video","aria-label":"Video",children:e.jsxs(y,{direction:"row",alignItems:"center",spacing:1,children:[e.jsx(ps,{}),e.jsx("span",{children:" Video"})]})}),e.jsx(Z,{value:"fotos","aria-label":"Fotos",children:e.jsxs(y,{direction:"row",alignItems:"center",spacing:1,children:[e.jsx(us,{}),e.jsx("span",{children:" Fotos"})]})})]});var me={},Es=Pe;Object.defineProperty(me,"__esModule",{value:!0});var tt=me.default=void 0,Os=Es(Re()),zs=e;tt=me.default=(0,Os.default)((0,zs.jsx)("path",{d:"M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2m-6 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2M9 8V6c0-1.66 1.34-3 3-3s3 1.34 3 3v2z"}),"LockRounded");var pe={},Ys=Pe;Object.defineProperty(pe,"__esModule",{value:!0});var st=pe.default=void 0,Vs=Ys(Re()),Hs=e;st=pe.default=(0,Vs.default)((0,Hs.jsx)("path",{d:"M12 13c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2m6-5h-1V6c0-2.76-2.24-5-5-5-2.28 0-4.27 1.54-4.84 3.75-.14.54.18 1.08.72 1.22.53.14 1.08-.18 1.22-.72C9.44 3.93 10.63 3 12 3c1.65 0 3 1.35 3 3v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2m0 11c0 .55-.45 1-1 1H7c-.55 0-1-.45-1-1v-8c0-.55.45-1 1-1h10c.55 0 1 .45 1 1z"}),"LockOpenRounded");const Us=t=>{const[s,n]=u.useState(null),[r,o]=u.useState(null),[i,c]=u.useState(null),m=u.useRef(null),[d,l]=u.useState(!1),[p,h]=u.useState(null);return u.useEffect(()=>(t!==void 0&&(m.current||(m.current=D(`${T}/controller_state/${t}`)),m.current.on("controller_info",x=>{const{modo:g,seguridad:f,conectado:S}=x;o(g),n(f),c(S)}),m.current.on("update_controller",x=>{const{conectado:g,modo:f,seguridad:S}=x;c(C=>g!==C?g:C),o(C=>f!==C?f:C),n(C=>S!==C?S:C)}),m.current.on("connect_error",x=>{l(!0),h(x.message)})),()=>{m.current&&(m.current.disconnect(),m.current=null),n(null),o(null),l(!1),h(null),c(null)}),[t]),{isError:d,error:p,socket:m,mode:r,security:s,connected:i}},Ns=k(({className:t,...s})=>e.jsx(He,{...s,classes:{popper:t}}))(({theme:t})=>({[`& .${Ue.tooltip}`]:{backgroundColor:t.palette.common.white,color:"rgba(0, 0, 0, 0.87)",boxShadow:t.shadows[3],fontSize:11}})),Bs=({ctrl_id:t})=>{const{mode:s,security:n,socket:r}=Us(t),o=()=>{r.current&&(n===$.Armado?r.current.emit("setSecurity",$.Desarmado):r.current.emit("setSecurity",$.Armado))};return e.jsx(e.Fragment,{children:s===B.Seguridad&&e.jsx(Ns,{title:n===$.Armado?"Armado":"Desarmado",placement:"left",children:e.jsx(R,{onClick:o,children:n===$.Armado?e.jsx(tt,{}):e.jsx(st,{})})})})},Gs=()=>{const t=E(s=>s.controllerSiteState);return e.jsx(e.Fragment,{children:e.jsx(y,{direction:"row",spacing:1,alignItems:"center",children:t.controller!==void 0&&(t.controller.conectado===lt.Conectado?e.jsxs(e.Fragment,{children:[e.jsx(Ht,{color:"success",fontSize:"large"}),e.jsx(P,{children:"Conectado"})]}):e.jsxs(e.Fragment,{children:[e.jsx(Ut,{color:"error",fontSize:"large"}),e.jsx(P,{children:"Desconectado"})]}))})})},qs=({ctrl_id:t})=>{const s=E(g=>g.stream),{isError:n,isSuccess:r,data:o}=ct({ctrl_id:t},{refetchOnMountOrArgChange:!0}),[i,c]=u.useState("vivo"),m=(g,f)=>{f!==null&&c(f)},[d,l]=u.useState(w()),[p,h]=u.useState(w()),x=u.useRef(null);return e.jsxs(dt,{children:[e.jsx(K,{ref:x,sx:{p:.5,"& .MuiCardHeader-action":{m:"auto auto",display:"flex"},overflow:"auto",margin:0},title:e.jsx(Gs,{}),action:e.jsx("div",{style:{width:"100%",height:"100%"},children:e.jsxs(y,{direction:"row",spacing:2,alignItems:"center",children:[(i==="fotos"||i==="video")&&e.jsx(Ts,{timePicked:p,datePicked:d,setDatePicked:l,setTimePicked:h}),r&&o.length>0&&e.jsx(Ds,{camaras:o,ctrl_id:t}),n&&e.jsx(L,{variant:"filled",severity:"error",children:"Error al cargar camaras."})]})})}),e.jsxs(ie,{sx:{flex:1,padding:.5,"&:last-child":{paddingBottom:.5}},children:[i==="vivo"&&s.ctrl_id!==null&&s.cmr_id!==null&&r&&o.length>0&&e.jsx(Ms,{},s.ctrl_id+s.cmr_id),i==="fotos"&&s.ctrl_id!==null&&s.cmr_id!==null&&e.jsx(Ls,{data:{cmr_id:s.cmr_id,ctrl_id:s.ctrl_id,date:d.format("YYYY-MM-DD"),hour:Number(p.format("HH"))}},s.ctrl_id+s.cmr_id),i==="video"&&s.ctrl_id!==null&&s.cmr_id!==null&&e.jsx($s,{data:{cmr_id:s.cmr_id,ctrl_id:s.ctrl_id,date:d.format("YYYY-MM-DD"),hour:Number(p.format("HH"))}},s.ctrl_id+s.cmr_id)]}),e.jsx(Qe,{disableSpacing:!0,sx:{padding:.5},children:e.jsxs(y,{width:"100%",direction:"row",alignItems:"center",spacing:2,justifyContent:"space-between",children:[e.jsx(As,{option:i,handleChangeOption:m}),e.jsx(Bs,{ctrl_id:t})]})})]})},Ws=({ctrl_id:t})=>{const[s,n]=u.useState([]),r=u.useRef(null),o=oe(),[i,c]=u.useState(B.Seguridad),[m,d]=u.useState($.Desarmado);return u.useEffect(()=>(r.current||(r.current=D(`${T}/pin_entrada/${t}`)),r.current.on("list_pines_entrada",l=>{n(l)}),r.current.on("controller_mode",l=>{c(l)}),r.current.on("controller_security",l=>{d(l)}),r.current.on("item_pin_entrada",l=>{n(p=>{if(l.activo==1){const h=p.filter(x=>x.pe_id!=l.pe_id);return h.unshift(l),h}return p})}),()=>{r.current&&(r.current.disconnect(),r.current=null)}),[t]),e.jsx(e.Fragment,{children:e.jsxs(ke,{sx:{display:"flex",flexDirection:"column",height:"100%",width:"100%",border:i===B.Seguridad?"2px solid":"1px solid",borderRadius:2,backgroundImage:"inherit",borderColor:i===B.Seguridad?m===$.Armado?"green":"darkgray":o.palette.mode==="dark"?o.palette.divider:o.palette.grey.A800,boxShadow:"inherit",":hover":{boxShadow:"inherit"},"& pre":{m:0,p:"16px !important",fontFamily:o.typography.fontFamily,fontSize:"0.75rem"}},children:[e.jsx(K,{title:"Site",sx:{p:.5,"& .MuiCardHeader-action":{m:"auto auto",display:"flex"}}}),e.jsx(ie,{sx:{flex:1,padding:.5,"&:last-child":{paddingBottom:.5}},children:e.jsx(b,{sx:{width:"100%",height:"100%",position:"relative"},children:e.jsx(b,{sx:{width:"100%",height:"100%",position:"absolute"},children:e.jsx(W,{sx:{width:"100%",height:"100%","& .simplebar-content":{width:"100%",height:"100%",display:"grid",placeItems:"center"}},children:e.jsxs(j,{container:!0,rowSpacing:1,columnSpacing:2,width:"100%",children:[s.length===0&&e.jsx(j,{size:{xs:12},sx:{display:"grid",placeItems:"center"},children:e.jsx(L,{severity:"warning",variant:"outlined",children:"Asignar al menos un pin de entrada"})}),s.map((l,p,h)=>{const x=e.jsxs(y,{direction:"row",spacing:1,alignItems:"center",justifyContent:"space-between",children:[e.jsx("div",{children:ae(l.descripcion,20)}),e.jsx(Nt,{state:i===B.Seguridad?l.estado===1?"warning":"active":l.estado===1?"active":"disable"})]});return h.length==1?e.jsxs(u.Fragment,{children:[e.jsx(j,{size:{xs:3}}),e.jsx(j,{size:{xs:12},children:x}),e.jsx(j,{size:{xs:3}})]},l.ctrl_id+l.pe_id):e.jsx(j,{size:{xs:12,lg:6},children:x},l.ctrl_id+l.pe_id)})]})})})})})]})})},Qs=k(Ge)(({theme:t})=>({border:"1px solid",borderRadius:2,borderColor:t.palette.mode==="dark"?t.palette.divider:t.palette.grey.A800,backgroundColor:t.palette.background.paper,boxShadow:" rgba(0, 0, 0, 0.2) 0px 2px 1px -1px, rgba(0, 0, 0, 0.14) 0px 1px 1px 0px, rgba(0, 0, 0, 0.12) 0px 1px 3px 0px",backgroundImage:t.palette.mode==="dark"?"linear-gradient(rgba(255, 255, 255, 0.05), rgba(255, 255, 255, 0.05))":"none"})),Xs=({ctrl_id:t})=>{const[s,n]=u.useState([]),r=u.useRef(null);return u.useEffect(()=>(r.current||(r.current=D(`${T}/modulo_energia/${t}`)),r.current.on("initial_list_energia",o=>{n(o)}),r.current.on("list_energia",(o,i)=>{i==="add"&&n(c=>c.some(d=>d.me_id===o.me_id)?c:[...c,o].sort((p,h)=>p.me_id-h.me_id)),i==="delete"&&n(c=>c.filter(d=>d.me_id!==o.me_id))}),()=>{r.current&&(r.current.disconnect(),r.current=null)}),[t]),e.jsx(e.Fragment,{children:e.jsxs(b,{component:"div",sx:{width:"100%",height:"100%",display:"grid",placeItems:"center"},children:[s.length===0&&e.jsx(L,{severity:"warning",variant:"outlined",children:"Asignar al menos un modulo de energia"}),s.length>0&&e.jsx(qe,{component:We,variant:"outlined",sx:{height:"100%",width:"100%",overflowY:"auto"},children:e.jsx(W,{sx:{width:"100%",height:"100%","& .simplebar-content":{width:"100%",height:"100%",display:"grid",placeItems:"center"}},children:e.jsxs(Qs,{"aria-label":"customized table",stickyHeader:!0,size:"small",sx:{position:"relative"},children:[e.jsx(de,{children:e.jsxs(Y,{children:[e.jsx(_,{children:"N°"}),e.jsx(_,{children:"Amp (A)"}),e.jsx(_,{children:"Volt (V)"}),e.jsx(_,{children:"Pot (W)"}),e.jsx(_,{children:"kWh"})]})}),e.jsx(ue,{children:r.current!==null&&s.map((o,i)=>r.current!==null?e.jsx(Zs,{index:i,dataEnergia:o,socket:r.current},o.ctrl_id+o.me_id):null)})]})})})]})})},Zs=({dataEnergia:t,index:s,socket:n})=>{const[r,o]=u.useState(t);return n.on("energia",i=>{i.me_id===t.me_id&&o(i)}),e.jsxs(Y,{children:[e.jsx(_,{component:"th",scope:"row",children:s+1}),e.jsx(_,{children:r.amperaje}),e.jsx(_,{children:r.voltaje}),e.jsx(_,{children:r.potenciaw}),e.jsx(_,{children:r.potenciakwh})]})},Ks=({date:t,registerData:s,info:n})=>{const[r,o]=u.useState({configs:{chart:{height:350,type:"line",zoom:{enabled:!1},background:"#121212",id:"temperature-graph-chart",toolbar:{show:!0,export:{png:{filename:`grafica_temperatura_${encodeURIComponent(n.nodo)}_${encodeURIComponent(n.st_id)}_${encodeURIComponent(n.ubicacion)}_${encodeURIComponent(w(t,"YYYY-MM-DD").unix())}`},svg:{filename:`grafica_temperatura_${encodeURIComponent(n.nodo)}_${encodeURIComponent(n.st_id)}_${encodeURIComponent(n.ubicacion)}_${encodeURIComponent(w(t,"YYYY-MM-DD").unix())}`}}}},dataLabels:{enabled:!1},stroke:{curve:"straight"},grid:{row:{colors:["#1e1e1e","transparent"],opacity:.5}},xaxis:{type:"datetime",tickAmount:24,min:new Date(w(t,"YYYY-MM-DD").startOf("day").toISOString()).getTime(),max:new Date(w(t,"YYYY-MM-DD").add(1,"day").startOf("day").toISOString()).getTime(),labels:{formatter:function(l,p){return w(p).format("HH:mm")},style:{colors:"#8c8c8c",cssClass:"apexcharts-xaxis-label"}},title:{text:"Tiempo ( h )",style:{color:"#8c8c8c"}},tooltip:{enabled:!1,formatter:(l,p)=>w(l).format("HH:mm:ss")}},yaxis:{min:0,decimalsInFloat:2,title:{text:"Temperatura ( °C )",style:{color:"#8c8c8c"}},labels:{style:{colors:"#8c8c8c",cssClass:"apexcharts-yaxis-label"}}},tooltip:{enabled:!0,x:{show:!0,formatter(l,p){return w(l).format("HH:mm:ss")}},y:{}}}}),i=oe(),c=i.palette.mode,[m,d]=u.useState([]);return u.useEffect(()=>{o(l=>{const p=c=="dark"?i.palette.text.secondary:i.palette.text.primary;return{configs:{...l.configs,chart:{...l.configs.chart,background:i.palette.background.default},grid:{row:{colors:[i.palette.background.paper,"transparent"],opacity:.5}},xaxis:{...l.configs.xaxis,labels:{...l.configs.xaxis?l.configs.xaxis.labels:{},style:{...l.configs.xaxis&&l.configs.xaxis.labels?l.configs.xaxis.labels.style:{},colors:p,cssClass:"apexcharts-xaxis-label"}},title:{...l.configs.xaxis?l.configs.xaxis.title:{},style:{color:p}}},yaxis:{...l.configs.yaxis,title:{text:"Temperatura ( °C )",style:{color:p}},labels:{style:{colors:p,cssClass:"apexcharts-yaxis-label"}}}}}})},[c]),u.useEffect(()=>{d([{name:"temperatura",data:s}]),o(l=>({configs:{...l.configs,xaxis:{...l.configs.xaxis,min:new Date(w(t,"YYYY-MM-DD").startOf("day").toISOString()).getTime(),max:new Date(w(t,"YYYY-MM-DD").add(1,"day").startOf("day").toISOString()).getTime()}}}))},[s]),u.useEffect(()=>{o(l=>({configs:{...l.configs,chart:{...l.configs.chart,toolbar:{show:!1,export:{png:{filename:`grafica_temperatura_${encodeURIComponent(n.nodo)}_${encodeURIComponent(n.st_id)}_${encodeURIComponent(n.ubicacion)}_${encodeURIComponent(w(t,"YYYY-MM-DD").unix())}`},svg:{filename:`grafica_temperatura_${encodeURIComponent(n.nodo)}_${encodeURIComponent(n.st_id)}_${encodeURIComponent(n.ubicacion)}_${encodeURIComponent(w(t,"YYYY-MM-DD").unix())}`}}}}}}))},[n,t]),e.jsx(e.Fragment,{children:e.jsx(Gt,{options:r.configs,series:m,type:"line",width:"100%",height:500})})};function Js(t,s){const n=ApexCharts.getChartByID(t);n&&(s==="png"?n.exports.exportToPng():s==="svg"&&n.exports.exportToSVG())}const er=({open:t,setOpen:s,data:n})=>{const[r,o]=u.useState(w()),{nodo:i,ctrl_id:c,st_id:m,serie:d,ubicacion:l}=n,p=()=>{s(!1)},h=u.useRef(null);u.useEffect(()=>(t?h.current||(h.current=D(`${T}/sensor_temperatura/${c}/${m}`)):h.current&&(h.current.disconnect(),h.current=null),()=>{h.current&&(h.current.disconnect(),h.current=null)}),[t,n]);const[x,{data:g,isSuccess:f}]=ut(),S=()=>{x({ctrl_id:c,st_id:m,date:r.format("YYYY-MM-DD")})};return e.jsx(e.Fragment,{children:e.jsxs(qt,{fullWidth:!0,maxWidth:"lg",open:t,onClose:p,sx:{"& .MuiDialog-paper":{backgroundColor:"background.paper",backgroundImage:"inherit"}},children:[e.jsx(Qt,{children:e.jsx(P,{component:"div",variant:"h5",children:"Gráfica Temperatura"})}),e.jsxs(Wt,{children:[e.jsxs(ls,{children:["Nodo: ",i," , Ubicacion: ",l," , Serie: ",d]}),e.jsxs(y,{direction:"row",justifyContent:"end",alignItems:"center",spacing:2,marginBottom:2,children:[e.jsx(Ve,{value:r,onChange:C=>{o(C)},slotProps:{textField:{size:"small",sx:{maxWidth:150}}}}),e.jsx(R,{"aria-label":"get register",onClick:S,color:"primary",children:e.jsx(Xt,{})})]}),e.jsx(Ks,{date:r.format("YYYY-MM-DD"),registerData:f&&g?g:[],info:n})]}),e.jsxs(Lt,{children:[e.jsx(Ce,{variant:"contained",onClick:()=>{Js("temperature-graph-chart","png")},startIcon:e.jsx(Bt,{}),children:"Descargar"}),e.jsx(Ce,{variant:"contained",color:"error",onClick:p,children:"Cerrar"})]})]})})},tr=({ctrl_id:t})=>e.jsx(e.Fragment,{children:e.jsx(b,{sx:{width:"100%",height:"100%"},children:e.jsx(W,{sx:{width:"100%",height:"100%","& .simplebar-content":{width:"100%",height:"100%",display:"grid",placeItems:"center"}},children:e.jsx(sr,{ctrl_id:Number(t)})})})}),sr=({ctrl_id:t})=>{const{xregion:s,xnodo:n}=Le(),[r,o]=u.useState([]),i=u.useRef(null),[c,m]=u.useState(!1),[d,l]=u.useState(null),p=h=>{l(h),m(!0)};return u.useEffect(()=>(i.current||(i.current=D(`${T}/sensor_temperatura/${t}`)),i.current.on("initial_list_temperature",h=>{o(h)}),i.current.on("list_temperature",(h,x)=>{x==="add"&&o(g=>g.some(S=>S.st_id===h.st_id)?g:[...g,h].sort((z,F)=>z.st_id-F.st_id)),x==="delete"&&o(g=>g.filter(S=>S.st_id!==h.st_id))}),()=>{i.current&&(i.current.disconnect(),i.current=null)}),[t]),e.jsxs(e.Fragment,{children:[e.jsxs(j,{container:!0,rowSpacing:1,columnSpacing:2,sx:{width:"100%"},children:[r.length===0&&e.jsx(j,{size:{xs:12},sx:{display:"grid",placeItems:"center"},children:e.jsx(L,{severity:"warning",variant:"outlined",children:"Asignar al menos un sensor de temperatura"})}),i.current!==null&&r.map((h,x,g)=>{if(i.current===null)return null;const f=e.jsxs(y,{direction:"row",spacing:1,alignItems:"center",justifyContent:"space-between",children:[e.jsx(rr,{dataViewer:h,socket:i.current}),e.jsx(R,{size:"small","aria-label":"Temperature Graph",color:"primary",onClick:()=>p({...h,nodo:n,region:s,ctrl_id:t}),children:e.jsx(ms,{fontSize:"small"})})]});return g.length==1?e.jsxs(j,{container:!0,sx:{width:"100%"},children:[e.jsx(j,{size:{xs:3}}),e.jsx(j,{size:{xs:6},children:f}),e.jsx(j,{size:{xs:3}})]},h.ctrl_id+h.st_id):e.jsx(j,{size:{xs:12,lg:6},children:f},h.ctrl_id+h.st_id)})]}),d&&c&&e.jsx(er,{open:c,setOpen:m,data:d})]})},rr=({dataViewer:t,socket:s})=>{const[n,r]=u.useState(t);return s.on("temperature",o=>{t.st_id===o.st_id&&r(o)}),e.jsx(e.Fragment,{children:e.jsxs(y,{direction:"row",spacing:1,alignItems:"center",justifyContent:"space-between",sx:{flex:1},children:[e.jsx("span",{children:`${ae(n.ubicacion,15)}:`}),e.jsxs(b,{children:[n.actual,"°C"]})]})})},nr=({ctrl_id:t,region:s})=>{const n=mt(),r=O(),[o,i]=u.useState("accesos"),c=m=>{i(m.target.value)};return e.jsx(q,{title:e.jsxs(ce,{size:"small",value:o,onChange:c,placeholder:"select-tipo-prioridad",inputProps:{id:"select-prioridad"},children:[e.jsx(A,{value:"accesos",children:"Accesos"}),e.jsx(A,{value:"alarmas",children:"Alarmas"})]}),secondary:e.jsx(Kt,{component:"button",underline:"none",onClick:()=>{r(pt(s)),r(ht(t)),r(xt(o=="accesos"?"acceso":"entrada")),r(gt(w().startOf("day").format("YYYY-MM-DD HH:mm:ss"))),r(ft(w().endOf("day").format("YYYY-MM-DD HH:mm:ss"))),n("/logs")},children:"Ver Mas"}),children:e.jsx(qe,{component:We,variant:"outlined",sx:{height:"100%",width:"100%",overflowY:"auto"},children:e.jsxs(W,{sx:{width:"100%",height:"100%","& .simplebar-content":{width:"100%",height:"100%",display:"grid",placeItems:"center"}},children:[o=="accesos"&&e.jsx(or,{ctrl_id:t}),o=="alarmas"&&e.jsx(ir,{ctrl_id:t})]})})})},rt=k(Ge)(({theme:t})=>({border:"1px solid",borderRadius:2,borderColor:t.palette.mode==="dark"?t.palette.divider:t.palette.grey.A800,backgroundColor:t.palette.background.paper,boxShadow:" rgba(0, 0, 0, 0.2) 0px 2px 1px -1px, rgba(0, 0, 0, 0.14) 0px 1px 1px 0px, rgba(0, 0, 0, 0.12) 0px 1px 3px 0px",backgroundImage:t.palette.mode==="dark"?"linear-gradient(rgba(255, 255, 255, 0.05), rgba(255, 255, 255, 0.05))":"none"})),or=({ctrl_id:t})=>{const[s,n]=u.useState([]),r=u.useRef(null);return u.useEffect(()=>(r.current||(r.current=D(`${T}/registro_acceso/${t}`)),r.current.on("list_registros_acceso",o=>{n(o)}),r.current.on("new_registro_acceso",o=>{n(i=>{const c=[o,...i];return c.length>5&&c.splice(5),c})}),()=>{r.current&&(r.current.disconnect(),r.current=null)}),[t]),e.jsxs(e.Fragment,{children:[s.length===0&&e.jsx(L,{severity:"info",variant:"outlined",children:"Sin registros de acceso."}),s.length>0&&e.jsxs(rt,{size:"small","aria-label":"a dense table",stickyHeader:!0,sx:{position:"relative"},children:[e.jsx(de,{children:e.jsxs(Y,{children:[e.jsx(_,{children:"Contrata"}),e.jsx(_,{children:"Autorización"}),e.jsx(_,{children:"Fecha"})]})}),e.jsx(ue,{children:s.map((o,i)=>{const{autorizacion:c,fecha:m,contrata:d}=o,l=Ne(m);return e.jsxs(Y,{children:[e.jsx(_,{children:d?e.jsx(Zt,{text:d,maxLength:15,insertDots:!0}):"sin-contrata"}),e.jsx(_,{children:c==1?"Autorizado":c==0?"Denegado":c}),e.jsx(_,{children:l})]},i)})})]})]})},ir=({ctrl_id:t})=>{const[s,n]=u.useState([]),r=u.useRef(null);return u.useEffect(()=>(r.current||(r.current=D(`${T}/registro_entrada/${t}`)),r.current.on("list_registros_entrada",o=>{n(o)}),r.current.on("new_registro_entrada",o=>{n(i=>{const c=[o,...i];return c.length>5&&c.splice(5),c})}),()=>{r.current&&(r.current.disconnect(),r.current=null)}),[t]),e.jsxs(e.Fragment,{children:[s.length===0&&e.jsx(L,{severity:"info",variant:"outlined",children:"Sin registros de alarma."}),s.length>0&&e.jsxs(rt,{size:"small","aria-label":"a dense table",stickyHeader:!0,sx:{position:"relative"},children:[e.jsx(de,{children:e.jsxs(Y,{children:[e.jsx(_,{children:"Pin"}),e.jsx(_,{children:"Estado"}),e.jsx(_,{children:"Fecha"})]})}),e.jsx(ue,{children:s.map((o,i)=>{const{pin:c,estado:m,fecha:d}=o,l=Ne(d);return e.jsxs(Y,{children:[e.jsx(_,{children:c}),e.jsx(_,{children:m==0?"Desactivado":m==1?"Activado":m}),e.jsx(_,{children:l})]},i)})})]})]})};const ar="/assets/Lead_Light_Icon-1d1b19d6.svg",lr="/assets/Green_Light_Icon-460ad5bb.svg",cr=({ctrl_id:t})=>{const s=u.useRef(null),[n,r]=u.useState([]),[o,i]=u.useState(""),c=n.find(d=>String(d.es_id)==o),m=d=>{i(d.target.value)};return u.useEffect(()=>{n.length>0&&o==""&&i(String(n[0].es_id)),n.find(l=>String(l.es_id)==o)==null&&(n.length>0?i(String(n[0].es_id)):i(""))},[n]),u.useEffect(()=>(s.current||(s.current=D(`${T}/pines_salida/${t}`)),s.current.on("equipos_salida",d=>{r(d)}),s.current.on("list_pines_salida",(d,l)=>{r(p=>p.find(({es_id:x})=>x===l.es_id)===void 0?[l,...p].sort((g,f)=>g.es_id-f.es_id):p)}),()=>{s.current&&(s.current.disconnect(),s.current=null)}),[t]),e.jsx(e.Fragment,{children:e.jsx(q,{title:"Control",secondary:e.jsx(Jt,{size:"small",sx:{maxWidth:200},children:n.length>0&&e.jsx(ce,{id:"control-select",name:"control-select",value:o,onChange:m,size:"small",inputProps:{"aria-label":"Select Control"},children:n.map(d=>e.jsx(A,{value:d.es_id,children:d.actuador},d.es_id))})}),children:e.jsxs(b,{sx:{width:"100%",height:"100%",position:"relative"},children:[n.length===0&&e.jsx(b,{component:"div",sx:{width:"100%",height:"100%",display:"grid",placeItems:"center"},children:e.jsx(L,{severity:"warning",variant:"outlined",children:"Asignar al menos un pin de salida"})}),c&&s.current&&e.jsx(dr,{ctrl_id:t,equipo_salida:c,socketRef:s.current},c.es_id)]})})})},dr=({equipo_salida:t,socketRef:s})=>{const[n,r]=u.useState([]);return s.on("list_pines_salida",(o,i)=>{t.es_id==i.es_id&&r(o)}),u.useEffect(()=>{s.emit("initial_list_pines_salida",t.es_id)},[t.es_id]),e.jsx(e.Fragment,{children:e.jsx("div",{style:{height:"100%",width:"100%",position:"absolute",top:0,left:0},children:e.jsx(W,{sx:{width:"100%",height:"100%","& .simplebar-content":{width:"100%",height:"100%",display:"grid",placeItems:"center"}},children:e.jsx("div",{className:"grid-container-pinsal-list",children:n.map(o=>e.jsx(ur,{pinSalItem:o,socketRef:s},o.ps_id))})})})})},ur=({pinSalItem:t,socketRef:s})=>{const[n,r]=u.useState(t);return u.useEffect(()=>{s.emit("initial_item_pin_salida",t.es_id,t.ps_id),s.on("item_pin_salida",o=>{t.ps_id==o.ps_id&&r(o)})},[t.ps_id]),e.jsx(e.Fragment,{children:e.jsxs("div",{className:"grid-item-pinsal",children:[e.jsx("span",{children:`${ae(n.descripcion,20)}:`}),n.es_id===21&&e.jsxs(e.Fragment,{children:[n.estado===1&&e.jsx("img",{src:lr,alt:"Green Indicator"}),n.estado===0&&e.jsx("img",{src:ar,alt:"Lead Indicator"})]}),n.es_id!==21&&e.jsxs("div",{className:"button-group",children:[e.jsx("button",{className:"button_item",onClick:()=>{const{ctrl_id:o,pin:i,es_id:c}=n;s.emit("orden_pin_salida",{action:0,ctrl_id:o,es_id:c,pin:i})},style:{backgroundColor:n.orden==0?"#d9d9d9":"transparent",color:n.orden==0?"black":"#1668dc"},children:"A"}),e.jsx("button",{className:"button_item",onClick:()=>{const{ctrl_id:o,pin:i,es_id:c}=n;s.emit("orden_pin_salida",{action:1,ctrl_id:o,es_id:c,pin:i})},style:{backgroundColor:n.orden==1?"#49aa19":"transparent",color:n.orden==1?"white":"#1668dc"},children:"ON"}),e.jsx("button",{className:"button_item",onClick:()=>{const{ctrl_id:o,pin:i,es_id:c}=n;s.emit("orden_pin_salida",{action:-1,ctrl_id:o,es_id:c,pin:i})},style:{backgroundColor:n.orden==-1?"#a61d24":"transparent",color:n.orden==-1?"white":"#1668dc"},children:"OFF"})]})]})})},Vr=()=>{const{xctrl_id:t}=Le(),s=O(),n=u.useRef(null),r=E(i=>i.multimediaSlice),o=E(i=>i.controllerSiteState);return u.useEffect(()=>(t!==void 0&&(s(jt({openItem:[`nodo-${t}`]})),n.current||(n.current=D(`${T}/controller_state/${t}`)),n.current.on("controller_info",i=>{s(ge(i))}),n.current.on("update_region",i=>{s(bt(i))}),n.current.on("update_controller",i=>{s(ge(i))}),n.current.on("error_message",i=>{s(fe(i.message))}),n.current.on("connect",()=>{s(Ct())}),n.current.on("connect_error",i=>{s(fe(`Socket connect error: ${i.message}`))})),()=>{n.current&&(n.current.disconnect(),n.current=null),s(vt())}),[t]),e.jsxs(b,{sx:{width:"100%",height:"100%",padding:1,overflowY:"auto"},children:[o.isError&&e.jsx("div",{children:o.error??"Ocurrio un error al obtener el controlador"}),o.isSuccess&&o.controller!==void 0&&e.jsx(j,{container:!0,sx:{width:"100%",height:"100%",overflowY:"auto"},rowGap:1,children:e.jsxs(e.Fragment,{children:[e.jsx(j,{size:{xs:12},sx:{height:r.isExpandMultimedia?"100%":"calc(66.7% - 4px)"},children:e.jsxs(j,{container:!0,columnSpacing:1,sx:{height:"100%"},children:[e.jsx(j,{size:{xs:r.isExpandMultimedia?12:8},children:e.jsx(qs,{ctrl_id:o.controller.ctrl_id})}),!r.isExpandMultimedia&&e.jsx(j,{size:{xs:4},sx:{height:"100%"},children:e.jsxs(j,{container:!0,sx:{width:"100%",height:"100%"},gap:1,children:[e.jsx(j,{size:{xs:12},sx:{width:"100%"},children:e.jsx(q,{title:"Temperaturas",children:e.jsx(tr,{ctrl_id:o.controller.ctrl_id})})}),e.jsx(j,{size:{xs:12},sx:{width:"100%"},children:e.jsx(q,{title:"Energia",children:e.jsx(Xs,{ctrl_id:o.controller.ctrl_id})})}),e.jsx(j,{size:{xs:12},sx:{width:"100%"},children:e.jsx(cr,{ctrl_id:o.controller.ctrl_id})})]})})]})}),!r.isExpandMultimedia&&e.jsx(j,{size:{xs:12},sx:{height:"calc(33.3% - 4px)"},children:e.jsxs(j,{container:!0,columnSpacing:1,sx:{height:"100%"},children:[e.jsx(j,{size:{xs:4},children:e.jsx(ys,{ctrl_id:o.controller.ctrl_id})}),e.jsx(j,{size:{xs:4},children:e.jsx(nr,{ctrl_id:o.controller.ctrl_id,region:o.controller.region})}),e.jsx(j,{size:{xs:4},children:e.jsx(Ws,{ctrl_id:o.controller.ctrl_id})})]})})]})},o.controller.ctrl_id)]})};export{Vr as NodoSite,Vr as default};
