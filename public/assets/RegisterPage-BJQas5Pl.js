import{j as e,S as ne,s as fe,ay as re,a7 as we,az as C,aa as R,u as je,a as Ce,a8 as ve,aA as _e,r as v,l as f,ab as M,ac as V,aB as u,ad as k,ae as y,B as z,T as A,af as se,aC as ae,aD as oe,aE as le,aF as Me,aG as Se,aH as de,aI as ce,m as ue,L as q,i as X,v as De,aJ as He,h as he,aK as Ie,o as Fe,aL as Ve,aM as ke,aN as pe,aO as ge,aP as me,aQ as Ye,aR as Pe,aS as Re}from"./index-D9tpZ6Qh.js";import{S as $e}from"./SearchIcon-C4VRBtiF.js";import{g as Ee}from"./groupByKey-nGMiMvM1.js";import{L as ee}from"./ListItemButton-Pv68Be0T.js";import{S as Te}from"./Switch-BRFzShnW.js";const Le=({...s})=>e.jsx(ne,{...s,children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:[e.jsx("mask",{id:"mask0_2799_6986",style:{maskType:"alpha"},maskUnits:"userSpaceOnUse",x:"0",y:"0",width:"24",height:"24",children:e.jsx("rect",{width:"24",height:"24",fill:"#D9D9D9"})}),e.jsx("g",{mask:"url(#mask0_2799_6986)",children:e.jsx("path",{d:"M10 18V16H14V18H10ZM6 13V11H18V13H6ZM3 8V6H21V8H3Z",fill:"currentColor"})})]})}),Be=({...s})=>e.jsx(ne,{...s,children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:e.jsx("path",{d:"M10.5 11.25H7.5C7.30109 11.25 7.11032 11.329 6.96967 11.4697C6.82902 11.6103 6.75 11.8011 6.75 12V16.5C6.75 16.6989 6.82902 16.8897 6.96967 17.0303C7.11032 17.171 7.30109 17.25 7.5 17.25H10.5M15.75 11.25H12.75C12.5511 11.25 12.3603 11.329 12.2197 11.4697C12.079 11.6103 12 11.8011 12 12V13.5C12 13.6989 12.079 13.8897 12.2197 14.0303C12.3603 14.171 12.5511 14.25 12.75 14.25H14.25C14.4489 14.25 14.6397 14.329 14.7803 14.4697C14.921 14.6103 15 14.8011 15 15V16.5C15 16.6989 14.921 16.8897 14.7803 17.0303C14.6397 17.171 14.4489 17.25 14.25 17.25H11.25M17.25 10.5C17.25 11.25 18.75 17.25 18.75 17.25H20.25C20.25 17.25 21.75 11.25 21.75 10.5M16.5 20.25V21.75H3V2.25H12M12 2.25V6.75H16.5M12 2.25H12.75L16.5 6V6.75M16.5 6.75V9",stroke:"currentColor",strokeWidth:"1.5",strokeLinejoin:"round"})})}),Oe=({...s})=>e.jsx(ne,{...s,children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:e.jsx("path",{d:"M21.17 3.25C21.39 3.25 21.5867 3.33333 21.76 3.5C21.92 3.66 22 3.85333 22 4.08V19.92C22 20.1467 21.92 20.34 21.76 20.5C21.5867 20.6667 21.39 20.75 21.17 20.75H7.83C7.61 20.75 7.41333 20.6667 7.24 20.5C7.08 20.34 7 20.1467 7 19.92V17H2.83C2.61 17 2.41333 16.92 2.24 16.76C2.08 16.5867 2 16.39 2 16.17V7.83C2 7.61 2.08 7.41333 2.24 7.24C2.41333 7.08 2.61 7 2.83 7H7V4.08C7 3.85333 7.08 3.66 7.24 3.5C7.41333 3.33333 7.61 3.25 7.83 3.25M7 13.06L8.18 15.28H9.97L8 12.06L9.93 8.89H8.22L7.13 10.9L7.09 10.96L7.06 11.03C6.88667 10.6767 6.7 10.32 6.5 9.96C6.33333 9.60667 6.15667 9.25 5.97 8.89H4.16L6.05 12.08L4 15.28H5.78M13.88 19.5V17H8.25V19.5M13.88 15.75V12.63H12V15.75M13.88 11.38V8.25H12V11.38M13.88 7V4.5H8.25V7M20.75 19.5V17H15.13V19.5M20.75 15.75V12.63H15.13V15.75M20.75 11.38V8.25H15.13V11.38M20.75 7V4.5H15.13V7H20.75Z",fill:"currentColor"})})});function Y(s,n=!1){const l=new Date(s),o=l.getDate().toString().padStart(2,"0"),p=(l.getMonth()+1).toString().padStart(2,"0"),d=l.getFullYear(),h=l.getHours().toString().padStart(2,"0"),c=l.getMinutes().toString().padStart(2,"0"),m=l.getSeconds().toString().padStart(2,"0");return n?`${d}-${p}-${o} ${h}:${c}:${m}`:`${o}/${p}/${d} ${h}:${c}:${m}`}const ze=fe(re)(({theme:s})=>({borderRadius:"8px 8px 0 0 ",border:"none",backgroundColor:s.palette.background.paper,backgroundImage:"none",boxShadow:"none",color:s.palette.text.primary})),P=fe(we)(({theme:s})=>({borderRadius:10,width:"100%",backgroundColor:s.palette.tertiary.opacityDark,"&.Mui-focused":{outline:"none",border:"none",boxShadow:"none"},"&.MuiOutlinedInput-root":{color:s.palette.text.primary,"& fieldset":{border:"none"},"&:hover fieldset":{border:"none"},"&.Mui-focused fieldset":{border:"none"},fontWeight:500},"& .MuiSelect-icon":{color:s.palette.text.primary}})),te=[{value:C.Acceso,name:"Accesos"},{value:C.Energia,name:"Energias"},{value:C.Entrada,name:"Entradas"},{value:C.EstadoCamara,name:"Estados camara"},{value:C.MicroSD,name:"MicroSD"},{value:C.Peticion,name:"Peticiones"},{value:C.Salida,name:"Salidas"},{value:C.Seguridad,name:"Seguridades"},{value:C.Temperatura,name:"Temperaturas"},{value:C.Ticket,name:"Tickets"}],xe=[...Array(24).keys()].map(s=>{const n=R().hour(s).startOf("hour");return{value:n.format("h:mm A"),name:n.format("h:mm A")}}),Ae=({children:s})=>{const n=je(),{ctrl_id:l,rgn_id:o,register_type:p,startDate:d,endDate:h,startTime:c,endTime:m,limit:_,prevIdResponse:U,filters:ye,register_data:D,nextId:ie,previusId:S,countDataResponse:G,lastCountData:W}=Ce(t=>t.registerStore),{isSuccess:$,data:H}=ve(),[E]=_e(),T=t=>{n(u({rgn_id:t.target.value,ctrl_id:void 0}))},L=t=>{n(u({ctrl_id:t.target.value}))},B=t=>{const r=te.find(i=>String(i.value)===String(t.target.value));n(u({register_type:t.target.value,register_type_name:r==null?void 0:r.name}))},Q=t=>{n(u({startTime:t.target.value}))},Z=t=>{n(u({endTime:t.target.value}))},j=v.useMemo(()=>$&&H?Ee(H,"rgn_id"):{},[$,H]),I=async t=>{try{const{ctrl_id:r,end_date:i,limit:a,start_date:K,type:O,p_action:b,cursor:x,other_params:g,end_time:w,start_time:be}=t;let N=`/register?type=${O}&ctrl_id=${r}&start_date=${encodeURIComponent(R(`${K} ${be}`,"DD/MM/YYYY h:mm A").format("YYYY-MM-DD HH:mm:ss"))}&end_date=${encodeURIComponent(R(`${i} ${w}`,"DD/MM/YYYY h:mm A").format("YYYY-MM-DD HH:mm:ss"))}&limit=${a}&p_action=${b}`,J=`/register?type=${O}&ctrl_id=${r}&start_date=${encodeURIComponent(K)}&end_date=${encodeURIComponent(i)}&limit=${a}&p_action=${b}&cursor=${x}`;g&&(N=N+g,J=J+g);const F=await E({url:typeof x=="number"?J:N}).unwrap();n(u({register_data:F})),n(ae(F.meta.prev_id)),n(oe(F.meta.next_id)),n(le(F.meta.result_count)),x==null&&n(u({maxCursorId:F.meta.prev_id}))}catch(r){n(u({register_data:null})),n(ae(null)),n(oe(null)),n(le(0)),console.error("Error al obtener registros:",r)}};return v.useEffect(()=>{h!==null&&m!==null&&c!==null&&d!==null&&o!==void 0&&l!==void 0&&p!==void 0&&I({ctrl_id:l,end_date:h,end_time:m,start_time:c,start_date:d,type:p,p_action:"init",limit:_})},[m,h,c,d,o,l,p]),v.useEffect(()=>{h!==null&&m!==null&&d!==null&&c!==null&&o!==void 0&&l!==void 0&&p!==void 0&&U!==null&&I({ctrl_id:l,end_date:h,end_time:m,start_time:c,start_date:d,type:p,p_action:"lim",limit:_,cursor:D==null?void 0:D.meta.prev_id})},[_]),e.jsxs(e.Fragment,{children:[e.jsxs(f,{direction:"row",spacing:1,children:[e.jsxs(f,{spacing:1,width:200,children:[e.jsx(M,{htmlFor:"group_site",sx:{display:"none"},children:"Grupo de sitio"}),e.jsxs(P,{displayEmpty:!0,value:o??"",onChange:T,inputProps:{id:"group_site"},renderValue:t=>{if(t.length===0)return e.jsx(e.Fragment,{children:"Grupo de sitio"});const r=j[t]?j[t][0]:void 0;return e.jsx(e.Fragment,{children:r==null?void 0:r.region.region})},IconComponent:({...t})=>o?e.jsx(V,{onClick:r=>{r.stopPropagation(),n(u({rgn_id:void 0,ctrl_id:void 0}))}}):e.jsx(k,{...t}),sx:{width:200},MenuProps:{PaperProps:{style:{maxHeight:200,width:200}}},children:[e.jsx(y,{disabled:!0,value:"",children:e.jsx(e.Fragment,{children:"Grupo de sitio"})}),Object.entries(j).map(([t,r])=>e.jsx(y,{value:t,children:e.jsx(z,{sx:{overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis",width:"100%"},children:r[0].region.region})},t))]})]}),e.jsxs(f,{spacing:1,width:200,children:[e.jsx(M,{htmlFor:"site_item",sx:{display:"none"},children:"Sitio"}),e.jsxs(P,{disabled:o===void 0||o==="",displayEmpty:!0,value:l??"",onChange:L,inputProps:{id:"site_item"},renderValue:t=>{if(t.length===0)return e.jsx(e.Fragment,{children:"Sitio"});let r;return o!==void 0&&j[o]&&(r=j[o].find(i=>String(i.ctrl_id)===String(t))),e.jsx(e.Fragment,{children:r==null?void 0:r.nodo})},IconComponent:({...t})=>l?e.jsx(V,{onClick:r=>{r.stopPropagation(),n(u({ctrl_id:void 0}))}}):e.jsx(k,{...t}),sx:{width:200},MenuProps:{PaperProps:{style:{maxHeight:200,width:200}}},children:[e.jsx(y,{disabled:!0,value:"",children:e.jsx(e.Fragment,{children:"Sitio"})}),o!==void 0&&j[o]&&j[o].map(t=>e.jsx(y,{value:String(t.ctrl_id),children:e.jsx(z,{sx:{overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis",width:"100%"},children:t.nodo})},String(t.ctrl_id)))]})]}),e.jsxs(f,{spacing:1,width:200,children:[e.jsx(M,{htmlFor:"register_type_select",sx:{display:"none"},children:"Tipo registro"}),e.jsxs(P,{displayEmpty:!0,value:p??"",onChange:B,inputProps:{id:"register_type_select"},renderValue:t=>{if(t.length===0)return e.jsx(e.Fragment,{children:"Tipo registro"});const r=te.find(i=>String(i.value)===String(t));return e.jsx(e.Fragment,{children:r?r.name:"No controlado"})},IconComponent:({...t})=>p?e.jsx(V,{onClick:r=>{r.stopPropagation(),n(u({register_type:void 0,register_type_name:void 0}))}}):e.jsx(k,{...t}),sx:{width:200},MenuProps:{PaperProps:{style:{maxHeight:200,width:200}}},children:[e.jsx(y,{disabled:!0,value:"",children:e.jsx(e.Fragment,{children:"Tipo de registro"})}),te.map((t,r)=>e.jsx(y,{value:t.value,children:t.name},r))]})]}),e.jsxs(f,{direction:"row",spacing:1,alignItems:"center",children:[e.jsx(A,{variant:"body1",children:"Desde:"}),e.jsxs(f,{spacing:1,width:200,children:[e.jsx(M,{htmlFor:"statet-date-select-register",sx:{display:"none"},children:"Fecha Inicial"}),e.jsx(se,{views:["month","year","day"],format:"DD/MM/YYYY",value:d?R(d,"DD/MM/YYYY"):null,onChange:t=>{t&&n(u({startDate:t.format("DD/MM/YYYY")}))},slotProps:{textField:{size:"medium",id:"statet-date-select-register",sx:t=>({borderRadius:"10px",backgroundColor:t.palette.tertiary.opacityDark,"& .MuiInputBase-root.MuiOutlinedInput-root":{fontWeight:500,color:t.palette.text.primary,border:"none","& fieldset":{border:"none"},"&:hover fieldset":{border:"none"},"&.Mui-focused fieldset":{border:"none"},boxShadow:"none"},"& .MuiInputBase-input":{minWidth:120}})}}})]}),e.jsxs(f,{spacing:1,width:120,children:[e.jsx(M,{htmlFor:"start-time-select-register",sx:{display:"none"},children:"Hora"}),e.jsxs(P,{disabled:d===null||d==="",displayEmpty:!0,value:c??"",onChange:Q,inputProps:{id:"start-time-select-register"},renderValue:t=>t.length===0?e.jsx(e.Fragment,{children:"H"}):e.jsx(e.Fragment,{children:t}),IconComponent:({...t})=>c?e.jsx(V,{onClick:r=>{r.stopPropagation(),n(u({startTime:void 0}))}}):e.jsx(k,{...t}),sx:{width:120},MenuProps:{PaperProps:{style:{maxHeight:200,width:120}}},children:[e.jsx(y,{disabled:!0,value:"",children:e.jsx(e.Fragment,{children:"Hora"})}),xe.map(t=>e.jsx(y,{value:t.value,children:t.name},t.value))]})]})]}),e.jsxs(f,{direction:"row",spacing:1,alignItems:"center",children:[e.jsx(A,{variant:"body1",children:"Hasta:"}),e.jsxs(f,{spacing:1,width:200,children:[e.jsx(M,{htmlFor:"end-date-select-register",sx:{display:"none"},children:"Fecha Final"}),e.jsx(se,{disabled:d===null,views:["month","year","day"],format:"DD/MM/YYYY",value:h?R(h,"DD/MM/YYYY"):null,onChange:t=>{t&&n(u({endDate:t.format("DD/MM/YYYY")}))},slotProps:{textField:{size:"medium",id:"end-date-select-register",sx:t=>({borderRadius:"10px",backgroundColor:t.palette.tertiary.opacityDark,"& .MuiInputBase-root.MuiOutlinedInput-root":{fontWeight:500,color:t.palette.text.primary,border:"none","& fieldset":{border:"none"},"&:hover fieldset":{border:"none"},"&.Mui-focused fieldset":{border:"none"},boxShadow:"none"},"& .MuiInputBase-input":{minWidth:120}})}}})]}),e.jsxs(f,{spacing:1,width:120,children:[e.jsx(M,{htmlFor:"end-time-select-register",sx:{display:"none"},children:"Hora"}),e.jsxs(P,{disabled:d===null||c===null||h===null,displayEmpty:!0,value:m??"",onChange:Z,inputProps:{id:"end-time-select-register"},renderValue:t=>t.length===0?e.jsx(e.Fragment,{children:"H"}):e.jsx(e.Fragment,{children:t}),IconComponent:({...t})=>m?e.jsx(V,{onClick:r=>{r.stopPropagation(),n(u({endTime:null}))}}):e.jsx(k,{...t}),sx:{width:120},MenuProps:{PaperProps:{style:{maxHeight:200,width:120}}},children:[e.jsx(y,{disabled:!0,value:"",children:e.jsx(e.Fragment,{children:"Hora"})}),xe.map(t=>e.jsx(y,{value:t.value,children:t.name},t.value))]})]})]})]}),s]})};function Ue(s){return s.length===0?[]:s.map(n=>({accessorKey:n,header:()=>e.jsx("span",{children:n})}))}const Ge=()=>{const[s,n]=v.useState({});je();const[l]=Me(),{endDate:o,startDate:p,rgn_id:d,ctrl_id:h,register_type:c,register_type_name:m,register_data:_,table_columns:U,filters:ye}=Ce(r=>r.registerStore),D=v.useMemo(()=>Ue(U),[c]),ie=v.useMemo(()=>_===null?[]:_.data.map(i=>{const a={...i};return a.fecha&&(a.fecha=Y(a.fecha,!0)),a.fechacomienzo&&(a.fechacomienzo=Y(a.fechacomienzo,!0)),a.fechatermino&&(a.fechatermino=Y(a.fechatermino,!0)),a.fechaestadofinal&&(a.fechaestadofinal=Y(a.fechaestadofinal,!0)),a.fechacreacion&&(a.fechacreacion=Y(a.fechacreacion,!0)),a}),[_]),S=Se({data:ie,columns:D,getCoreRowModel:Pe(),getFilteredRowModel:Re(),onColumnVisibilityChange:n,state:{columnVisibility:s}}),[G,W]=v.useState(null),$=r=>{W(r.currentTarget)},H=()=>{W(null)},E=!!G,T=E?"filter-table-button":void 0,[L,B]=v.useState(null),Q=r=>{B(r.currentTarget)},Z=()=>{B(null)},j=!!L,I=j?"download-table-button":void 0,t=async({tipo:r})=>{try{const i=S.getState().columnVisibility,a=Object.keys(i).reduce((b,x)=>{let g=b;return i[x]||(g=g+`&col_delete=${x}`),g},""),O=S.getState().columnFilters.reduce((b,x)=>{let g=b;return g=g+`&${x.id}=${encodeURIComponent(x.value)}`,g},"");if(o!==null&&p!==null&&d!==void 0&&h!==void 0&&c!==void 0){const b=`/register/download/${r}?type=${c}&ctrl_id=${h}&start_date=${encodeURIComponent(p)}&end_date=${encodeURIComponent(o)}`+O+a,x=`reporte_${c}_${Date.now()}.${r==="excel"?"xlsx":r}`,g=await l({url:b}).unwrap(),w=document.createElement("a");w.href=g,w.download=x,w.style.display="none",document.body.appendChild(w),w.click(),document.body.removeChild(w)}}catch(i){console.error("Error al descargar el archivo",i)}};return e.jsx(e.Fragment,{children:e.jsxs(Ae,{children:[e.jsxs(f,{spacing:1,direction:"row",justifyContent:"space-between",children:[e.jsxs(f,{direction:"row",spacing:1,alignItems:"center",children:[e.jsx(A,{variant:"h5",children:m}),e.jsx(de,{"aria-describedby":T,onClick:$,children:e.jsx(Le,{})}),e.jsx(de,{children:e.jsx($e,{})}),e.jsx(ce,{id:T,open:E,anchorEl:G,onClose:H,anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},children:e.jsx(re,{children:e.jsx(ue,{dense:!0,children:S.getAllLeafColumns().map(r=>e.jsx(q,{disablePadding:!0,children:e.jsxs(ee,{sx:{cursor:"inherit"},children:[e.jsx(Te,{checked:r.getIsVisible(),onChange:()=>{r.getIsVisible()?(r.toggleVisibility(!1),r.setFilterValue(void 0)):r.toggleVisibility(!0)},id:`switch-${r.id}-id`}),e.jsx(X,{primary:r.id.toUpperCase()})]})},r.id))})})})]}),e.jsx(De,{variant:"contained",color:"primary","aria-describedby":I,onClick:Q,startIcon:e.jsx(He,{}),disabled:!0,children:"Descargar"}),e.jsx(ce,{id:I,open:j,anchorEl:L,onClose:Z,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},children:e.jsx(re,{children:e.jsxs(ue,{children:[e.jsx(q,{disablePadding:!0,children:e.jsxs(ee,{sx:{cursor:"inherit"},onClick:()=>{t({tipo:"excel"})},children:[e.jsx(he,{children:e.jsx(Oe,{})}),e.jsx(X,{primary:"Descargar Excel"})]})}),e.jsx(q,{disablePadding:!0,children:e.jsxs(ee,{sx:{cursor:"inherit"},onClick:()=>{t({tipo:"csv"})},children:[e.jsx(he,{children:e.jsx(Be,{})}),e.jsx(X,{primary:"Descargar CSV"})]})})]})})})]}),e.jsx(z,{sx:{flex:1,overflow:"hidden",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(Ie,{component:ze,sx:{height:"100%",display:"flex",flexDirection:"column",overflowY:"auto"},children:e.jsx(Fe,{sx:{maxWidth:"100%",maxHeight:"100%"},children:e.jsxs(Ve,{size:"small",stickyHeader:!0,"aria-label":"sticky table",sx:r=>({"& .MuiTableCell-root":{borderColor:"divider"},"& tbody tr:hover":{backgroundColor:"tertiary.opacityLight"},"& thead .MuiTableCell-root":{backgroundColor:r.palette.mode==="light"?"#EEEFEF":"#2E4142"}}),children:[e.jsx(ke,{sx:{position:"sticky",top:0,zIndex:1e3,textTransform:"capitalize"},children:S.getHeaderGroups().map(r=>e.jsx(pe,{children:r.headers.map(i=>e.jsx(ge,{colSpan:i.colSpan,children:i.isPlaceholder?null:e.jsx("div",{children:me(i.column.columnDef.header,i.getContext())})},i.id))},r.id))}),e.jsx(Ye,{children:S.getCoreRowModel().rows.map(r=>e.jsx(pe,{children:r.getVisibleCells().map(i=>e.jsx(ge,{children:me(i.column.columnDef.cell,i.getContext())},i.id))},r.id))})]})})})})]})})},Je=()=>e.jsx(e.Fragment,{children:e.jsxs(z,{sx:{maxWidth:1600,width:"100%",height:"100%",overflow:"hidden",mx:"auto",p:{xs:2,sm:3},display:"flex",flexDirection:"column",gap:2},children:[e.jsx(A,{variant:"h4",children:"Registro de eventos"}),e.jsx(Ge,{})]})});export{Je as default};
